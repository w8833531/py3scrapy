{"url_object_id": "965c6835ed4cba16fd9cb2cfda0a99a2", "url": "http://blog.jobbole.com/111556/", "title": "15位身份证补全为18位身份证算法", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/9184208f96827c412ab7d3570590ef76.jpg"], "create_date": "2017-06-25", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/10158wsj/p/7050736.html\">我心自在</a>   </div><p>最近在参与一个银行项目-某银行安防系统-反洗钱需求的开发，银行项目的离不开身份证号码，身份证号码作为我国公民的唯一标识，有这非同寻常的意义，由于业务的要求15位的身份证号码无法命中，所以需要补全为18位，一开始自己想着加个年份的前两位，后面再加个X不就行了嘛，后来代码写不下去了，上网查了资料，才知道自己想的是多么天真，还是比较复杂的，折腾了一下午终于有了眉目。</p>\n<h2>一、15位身份证和18位身份证号码结构介绍</h2>\n<p>要进行身份证号码的验证，首先需要了解我国身份证号码的编码规则。我国身份证号码多由若干位数字或者数字与字母混合组成。早期身份证由15位数字构成，这主要是在1980年以前发放的身份证，后来考虑到千年虫问题，因为15位的身份证号码只能为1900年1月1日到1999年12月31日出生的人编号，所以又增加了18位身份证号码编号规则。</p>\n<p>1     2     3     4     5     6     7     8     9     10   11   12   13   14   15</p>\n<p>A     A     A     A     A     A     Y     Y     M    M    D     D     N    N    S</p>\n<p>前六位AAAAAA是身份证编码对象的所在地（出生地）的编码，该号码可由国家统计局公布的相关标准中得到。YY表示出生年的后两位，MM和DD表示出生月和日，不足两位的高位补0，NNS为顺序号，无法确定。S为性别识别码，男性为奇数，女性为偶数。了解了这些，再来写代码就变得容易多了。</p>\n<h2>二、算法实现</h2>\n<p>了解了身份证号码的规则后，我们就可以推断出，身份证的15位转化位需要两步。首先把15位身份证号补全为17位，然后再补全最后一位。但是最后一位是数字还是字母X？这里又出现了问题。我们知道，身份证的最后一位为校验位，那么最后一位是怎么得到的呢？原来，最后一位是由数字1-9组成，超过9的比如11就用字母X表示，否则号码就变成了19位。了解了这些，经过整理得出身份证补全算法实现思想如下：</p>\n<p><strong>step1</strong>、将15位身份证号码加入出生年变为17位</p>\n<p><strong>step2</strong>、将step1得到的身份证17位数分别乘以不同的系数。从第1位到第17位的系数分别为：7-9-10-5-8-4-2-1-6-3-7-9-10-5-8-4-2.</p>\n<p><strong>step3</strong>、将这17位数字和系数相乘的结果相加</p>\n<p><strong>step4</strong>、将step3的结果除以11，得出余数</p>\n<p>由于数字的特殊性，这些余数只可能是0-10这11个数字，身份证最后一位的对应数字为1-0-X-9-8-7-6-5-4-3-2.。例上面的余数结果为3那么对应身份证号码的最后一位就是9，如果是10，身份证最后一位便是2。</p>\n<p>代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fb8a0f05e6935344883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void main(String[] args) {\r\n        System.out.println(transIDCard15to18(\"370986890623212\"));\r\n        System.out.println(transIDCard15to18(\"370725881105149\"));\r\n    }\r\n    /* 18位标准身份证号\r\n     * 方法用途：15位身份证转化为18位标准证件号\r\n     */\r\n    public static String transIDCard15to18(String IdCardNO){\r\n        String cardNo=null;\r\n        if(null!=IdCardNO&amp;&amp;IdCardNO.trim().length()==15){\r\n            IdCardNO=IdCardNO.trim();\r\n            StringBuffer sb=new StringBuffer(IdCardNO);\r\n            sb.insert(6, \"19\");\r\n            sb.append(transCardLastNo(sb.toString()));\r\n            cardNo=sb.toString();\r\n        }\r\n        return cardNo;\r\n    }\r\n    /* 方法用途：15位补全‘19’位后的身份证号码\r\n     */\r\n    private static String transCardLastNo(String newCardId){\r\n        char[] ch=newCardId.toCharArray();\r\n        int m=0;\r\n        int [] co={7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2};\r\n        char [] verCode=new char[]{'1','0','X','9','8','7','6','5','4','3','2'};\r\n        for (int i = 0; i &lt; newCardId.length(); i++) {\r\n            m+=(ch[i]-'0')*co[i];\r\n        }\r\n        int residue=m%11;\r\n        return String.valueOf(verCode[residue]);\r\n         \r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-594fb8a0f05e6935344883-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb8a0f05e6935344883-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"370986890623212\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"370725881105149\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 18位标准身份证号</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-6\"><span class=\"crayon-c\">     * 方法用途：15位身份证转化为18位标准证件号</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-7\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">!=</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">StringBuffer </span><span class=\"crayon-v\">sb</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuffer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"19\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transCardLastNo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 方法用途：15位补全‘19’位后的身份证号码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-20\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">transCardLastNo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toCharArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">verCode</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'X'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'9'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'8'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'7'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'6'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">+=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">verCode</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">residue</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb8a0f05e6935344883-31\"><span class=\"crayon-h\">         </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb8a0f05e6935344883-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p>测试结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/4de63d1dfe6ae7d0e16eb62169a51728.png\"><img class=\"alignnone wp-image-111567 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/4de63d1dfe6ae7d0e16eb62169a51728.png\" alt=\"1153367-20170619213856382-410871354\" width=\"760\" height=\"154\"></a></p>\n<h2>三、总结</h2>\n<p>身份证号码补全虽然简单，但是前提需要了解我国公民的身份证构成原理才能正确验证，今天将这个学习过程分享给大家，希望对大家有所帮助，学习是个永无止境的过程，只有不断学习才能有进步！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111556\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111556votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111556\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/506f77aba037cb2bd78064b80470760038a6d491.jpg"}
{"url_object_id": "f65b12bcb444cfbc3d0109311fbdd75c", "url": "http://blog.jobbole.com/111509/", "title": "我是如何开始踏上 bash 脚本编程之路的？", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "create_date": "2017-06-19", "praise_nums": 2, "fav_nums": 1, "comment_nums": 1, "tags": "IT技术,Bash", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/5/how-i-learned-bash-scripting\">Sandra Mccann</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8617-1.html\">Linux中国/xllc</a>   </div><p>我前几天写了一个脚本。对于一些人来说，这句话听起来没什么了不起的。而对于另一些人来说，这句话意义重大。要知道，我不是一个程序员，而是一个作家。</p>\n<h3 id=\"toc_1\">我需要解决什么？</h3>\n<p>我的问题相当简单：我需要将工程文件进行分类。这些文件可以从一个网站 URL 以 .zip 的格式下载。当我正手工将它们拷贝到我的电脑桌面，并移动到一个已按照我文件分类的需要进行了结构化的目录时，一位作家同事给我提了建议：<em>“不就是写个脚本的事吗？”</em></p>\n<p>我心想：<em>“就写个脚本？”</em>——说得好像这是世界上最容易做的事情一样。</p>\n<h3 id=\"toc_2\">Google 是如何解救我的？</h3>\n<p>同事的问题促使我思考，并且经过思考后，我进行了 Google 搜索。</p>\n<p><strong>Linux 上使用的是什么脚本编程语言？</strong></p>\n<p>这是我第一个 Google 搜索的准则。也许很多人心里会想：“她太笨了！”是的，我很笨。不过，这的确使我走上了一条解决问题的道路。最常见的搜索结果是 Bash 。嗯，我听说过 Bash 。呃，我要分类的文件中有一个里面就有 Bash，那无处不在的 <code>#!/bin/bash</code> 。我重新看了下那个文件，我知道它的用途，因为我需要将它分类。</p>\n<p>这引导我进行了下一个 Google 搜索。</p>\n<p><strong>如何从一个 URL 下载 zip 文件？</strong></p>\n<p>那确实是我的基本任务。我有一个带有 .zip 文件的 URL ，它包含有所有我需要分类的文件，所以我寻求万能的 Google 的帮助。搜索到的精华内容和其它一些结果引导我使用 Curl 。但最重要的是：我不仅找到了 Curl ，其中一条置顶的搜索结果还展示了一个使用 Curl 去下载并解压 .zip 文件的 Bash 脚本。这超出了我本来想寻求的答案，但那也使我意识到在 Google 搜索具体的请求可以得到我写这个脚本需要的信息。所以，在这个收获的推动下，我写了最简单的脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc4a7517dc208250186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\ncurl http://rather.long.url | tar -xz -C my_directory --strip-components=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517dc208250186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517dc208250186-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc4a7517dc208250186-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517dc208250186-2\"><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//rather.long.url | tar -xz -C my_directory --strip-components=1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我迫不及待地运行看看。但我发现一个问题： URL 是会变的，根据我要访问的文件的分组不同而不同。我有新的问题需要解决，这使我进行了下一轮搜索。</p>\n<p><strong>参数如何传递给 Bash 脚本？</strong></p>\n<p>我需要以不同的 URL 和不同的最终目录来运行此脚本。 Google 向我展示了如何使用 <code>$1</code>、<code>$2</code> 等等来替换我在命令行中运行脚本时输入的内容。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc4a7517e5474287649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbash myscript.sh http://rather.long.url my_directory</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517e5474287649-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc4a7517e5474287649-1\"><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">myscript</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//rather.long.url my_directory</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这就好多了。一切如我所愿，灵活，实用。最重要的是我只要输入一条简短的命令就可以节省 30 分钟无聊的复制、粘贴工作。这个早上的时间花得值得。</p>\n<p>然后我发现还有一个问题：我很健忘，并且我知道我几个月才运行一次这个脚本。这留给我两个疑问：</p>\n<ul>\n<li>我要如何记得运行脚本时输入什么（URL 先，还是目录先）？</li>\n<li>如果我被货车撞了，其它作家如何知道该怎样运行我的脚本？</li>\n</ul>\n<p>我需要一个使用说明 —— 如果我使用不正确，则脚本会提示。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc4a7517e9387606081\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nusage: bash yaml-fetch.sh &lt;'snapshot_url'&gt; &lt;directory&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517e9387606081-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc4a7517e9387606081-1\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">yaml</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fetch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-s\">'snapshot_url'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">directory</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>否则，则直接运行脚本。我的下一个搜索是：</p>\n<p><strong>如何在 Bash 脚本里使用 “if/then/else”?</strong></p>\n<p>幸运的是，我已经知道编程中 <code>if/then/else</code> 的存在。我只要找出如何使用它的方法。在这个过程中，我也学到了如何在 Bash 脚本里使用 <code>echo</code> 打印。我的最终成果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc4a7517ed097803055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\nURL=$1\r\nDIRECTORY=$2\r\nif [ $# -eq 0 ];\r\n then\r\n echo \"usage: bash yaml-fetch.sh &lt;'snapshot_url'&gt; &lt;directory&gt;\".\r\n else\r\n# 如果目录不存在则创建它\r\n echo 'create directory'\r\n mkdir $DIRECTORY\r\n # 下载并解压 yaml 文件\r\n echo 'fetch and untar the yaml files'\r\n curl $URL | tar -xz -C $DIRECTORY --strip-components=1\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594fc4a7517ed097803055-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc4a7517ed097803055-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-2\"><span class=\"crayon-v\">URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-3\"><span class=\"crayon-v\">DIRECTORY</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-p\"># -eq 0 ];</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"usage: bash yaml-fetch.sh &lt;'snapshot_url'&gt; &lt;directory&gt;\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-8\"><span class=\"crayon-p\"># 如果目录不存在则创建它</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'create directory'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">DIRECTORY</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 下载并解压 yaml 文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'fetch and untar the yaml files'</span></div><div class=\"crayon-line\" id=\"crayon-594fc4a7517ed097803055-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">DIRECTORY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">strip</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc4a7517ed097803055-14\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">Google 和脚本编程如何颠覆我的世界？</h3>\n<p>好吧，这稍微有点夸大，不过现在是 21 世纪，学习新东西（特别是稍微简单的东西）比以前简单多了。我所学到的（除了如何写一个简短的、自动分类的 Bash 脚本之外）是如果我有疑问，那么有很大可能性是其它人在之前也有过相同的疑问。当我困惑时，我可以问下一个问题，再下一个问题。最后，我不仅拥有了脚本，还拥有了可以一直拥有并可以简化其它任务的新技能，这是我之前所没有的。</p>\n<p>别止步于第一个脚本（或者编程的第一步）。这是一个技能，和其它的技能并无不同，有大量的信息可以在这一路上帮助你。你无需阅读大量的书或参加一个月的课程。你可以像婴儿学步那样简单地开始写脚本，然后掌握技能并建立自信。人们总有写成千上万行代码的需求，并对它进行分支、合并、修复错误。但是，通过简单的脚本或其它方式来自动化、简单化任务的需求也一样强烈。这样的一个小脚本和小小的自信就能够让你启程脚本编程之路。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111509\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111509votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111509\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "78d28f7dbe719356ad7e22862dbab59e", "url": "http://blog.jobbole.com/111525/", "title": "大数据搜索选开源还是商业软件？ElasticSearch 对比 Splunk", "front_image_url": ["https://static.oschina.net/uploads/space/2017/0614/102156_SGGq_1450051.png"], "create_date": "2017-06-20", "praise_nums": 1, "fav_nums": 4, "comment_nums": 0, "tags": "IT技术,ElasticSearch,Splunk", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/taogang/blog/983586\">naughty</a>   </div><p>本文就架构，功能，产品线，概念等方面就ElasticSearch和Splunk做了一下全方位的对比，希望能够大家在制定大数据搜索方案的时候有所帮助。</p>\n<h2 id=\"h2_0\">简介</h2>\n<p><strong>ElasticSearch</strong> （<a href=\"https://www.elastic.co/\" rel=\"nofollow\">1</a>）（<a href=\"https://en.wikipedia.org/wiki/Elasticsearch\" rel=\"nofollow\">2</a>）是一个基于Lucene的开源搜索服务。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于<a href=\"http://baike.baidu.com/item/%E4%BA%91%E8%AE%A1%E7%AE%97\" target=\"_blank\" rel=\"nofollow\">云计算</a>中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>\n<p><strong>ELK</strong>是<a href=\"https://www.elastic.co/jp/products/elasticsearch\" rel=\"nofollow\">ElasticSearch</a>，<a href=\"https://www.elastic.co/jp/products/logstash\" rel=\"nofollow\">Logstash</a>，<a href=\"https://www.elastic.co/jp/products/kibana\" rel=\"nofollow\">Kibana</a>的缩写，分别提供搜索，数据接入和可视化功能，构成了Elastic的应用栈。</p>\n<p><strong>Splunk</strong> 是大数据领域第一家在纳斯达克上市公司，<a href=\"https://www.splunk.com/zh-hans_cn\" rel=\"nofollow\">Splunk</a>提供一个机器数据的引擎。使用 Splunk 可收集、索引和利用所有应用程序、服务器和设备（物理、虚拟和云中）生成的快速移动型计算机数据 。从一个位置搜索并分析所有实时和历史数据。 使用 Splunk 处理计算机数据，可让您在几分钟内（而不是几个小时或几天）解决问题和调查安全事件。监视您的端对端基础结构，避免服务性能降低或中断。以较低成本满足合规性要求。关联并分析跨越多个系统的复杂事件。获取新层次的运营可见性以及 IT 和业务智能。</p>\n<p>根据最新的<a href=\"https://db-engines.com/en/ranking\" rel=\"nofollow\">数据库引擎排名</a>显示，Elastic，Solr和Splunk分别占据了数据库搜索引擎的前三位。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/102156_SGGq_1450051.png\" width=\"942\" height=\"642\"></p>\n<p>从<a href=\"https://db-engines.com/en/ranking_trend\" rel=\"nofollow\">趋势</a>上来看，Elastic和Splunk上升明显，Elastic更是表现出了非常强劲的势头。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/102436_w14n_1450051.png\" width=\"963\" height=\"534\"></p>\n<h2 id=\"h2_1\">基本概念</h2>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/_basic_concepts.html\" rel=\"nofollow\"><strong>Elastic</strong></a></p>\n<ul>\n<li>准实时(NRT)<br>\nElasticsearch是一个准实时性的搜索平台，从数据索引到数据可以被搜索存在一定的时延。</li>\n<li>索引（Index）<br>\n索引是有共同特性的文档的集合，索引有自己的名字，可以对索引执行搜索，更新，删除等操作。</li>\n<li>类型（Type）<br>\n每个索引可以包含一个或者多个类型，类型可以看作一个索引数据的逻辑分组，通常我们会把拥有相同字段的文档定义为同一个类型。</li>\n<li>文档（Document）<br>\n文档是索引信息的基本单元。Elastic中文档表现为JSON对象，文档物理存贮在索引中，并需要被制定一个类型。因为表现为JSON， 很自然的，文档是由一个个的字段（Feilds）组成，每个字段是一个名值对（Name Value Pair）</li>\n<li>评分（score）<br>\nElastic是基于<a href=\"https://lucene.apache.org/\" rel=\"nofollow\">Lucene</a>构建的，所以搜索的结果会有一个<a href=\"http://blog.chenlb.com/2009/08/lucene-scoring-architecture.html\" rel=\"nofollow\">打分</a>。来评价搜索结果和查询的相关性。</li>\n</ul>\n<p>下图是一个Elastic的搜索在Kibana中看到的例子，原始的数据是一个简单的日志文件：</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/143016_SOUq_1450051.png\" width=\"465\" height=\"187\"></p>\n<p>我们通过logstash索引到Elasticsearch后，就可以搜索了。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/135259_AEE0_1450051.png\" width=\"1222\" height=\"712\"></p>\n<p><a href=\"https://www.splunk.com/content/dam/splunk2/pdfs/solution-guides/splunk-quick-reference-guide.pdf\" rel=\"nofollow\"><strong>Splunk</strong></a></p>\n<ul>\n<li>实时性<br>\nSplunk同样是准实时的，Splunk的实时搜索（<a href=\"http://docs.splunk.com/Documentation/SplunkCloud/6.6.0/Search/RealtimesearchesandreportsinSplunkWeb\" rel=\"nofollow\">Realtime Search</a>）可以提供不间断的搜索结果的数据流。</li>\n<li>事件（Event）<br>\n对应于Elastic的文档，Splunk的数据索引的基本单元是事件，每一个事件包含了一组值，字段，时间戳。Splunk的事件可以是一段文本，一个配置文件，一段日志或者JSON对象。</li>\n<li>字段（Fields）<br>\n字段是可以被搜索的名值对，不同的事件可能拥有不同的字段。Splunk支持索引时（index time）和搜索时（search time）的字段抽取（fields extraction）</li>\n<li>索引（Indexes）<br>\n类似Elastic的索引，所有的事件物理存储在索引上，可以把索引理解为一个数据库的表。</li>\n<li>知识对象（Knowledge Object）<br>\nSplunk的知识对象提供对数据进一步的解释，分类，增强等功能，包括：字段（fields），字段抽取（fields extraction），事件类型（event type），事务（transaction），查找（lookups），标签（tags），别名（aliases），数据模型（data model）等等。</li>\n</ul>\n<p>下图是一个Splunk的搜索在Splunk客户端看到的和前一个例子同样的日志数据的搜索结果。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/135439_CcWN_1450051.png\" width=\"924\" height=\"809\"></p>\n<p>从基本概念上来看，Elasticsearch和Splunk基本一致。从例子中我们可以看到很多的共性，事件／文档，时间戳，字段，搜索，时间轴图等等。其中有几个主要的差别：</p>\n<ul>\n<li>Elastic不支持搜索时的字段抽取，也就是说Elastic的文档中的所有字段在索引时已经固定了，而Splunk支持在搜索时，动态的抽取新的字段</li>\n<li>Elastic的搜索是基于评分机制的，搜索的结果有一个打分，而Splunk没有对搜索结果评分</li>\n<li>Splunk的知识对象可以提供对数据更高级，更灵活的管理能力。</li>\n</ul>\n<h2 id=\"h2_2\">用户接口</h2>\n<p>ElasticSearch提供REST API来进行</p>\n<ul>\n<li>集群的管理，监控，健康检查</li>\n<li>索引的管理（CURD）</li>\n<li>搜索的执行，包括排序，分页，过滤，脚本，聚合等等高级的搜索功能。</li>\n</ul>\n<p>Elasticsearch 本身并没有提供任何UI的功能，搜索可以用Kibana，但是没有管理UI还是让人不爽的，好在开源的好处就是会有很多的开发者来构建缺失的功能：</p>\n<ul>\n<li><a href=\"http://www.elastichq.org/\" rel=\"nofollow\">ElasticHQ</a></li>\n<li><a href=\"https://github.com/lmenezes/cerebro\" rel=\"nofollow\">cerebro</a> (推荐，界面干净，我喜欢)</li>\n<li><a href=\"https://github.com/appbaseio/dejavu/tree/dev\" rel=\"nofollow\">dejavu</a></li>\n</ul>\n<p>另一选择就是安装X-Pack，这个是要收费的。</p>\n<p>Splunk作为企业软件，管理及访问接口比较丰富，除了REST API 和命令行接口，Splunk的UI非常友好易用，基本上所有的功能都能通过集成的UI来使用。同时提供以下接口</p>\n<ul>\n<li>REST API</li>\n<li>Splunk UI</li>\n<li>CLI</li>\n</ul>\n<h2 id=\"h2_3\">功能</h2>\n<h3 id=\"h3_4\">数据接入和获取</h3>\n<p><strong>Elastic</strong>栈使用Logstash和Beats来进行数据的消化和获取。</p>\n<p><a href=\"https://github.com/elastic/logstash\" rel=\"nofollow\">Logstash</a>用jruby实现，有点像一个数据管道，把输入的数据进行处理，变形，过滤，然后输出到其它地方。Logstash 设计了自己的 DSL，包括有区域，注释，数据类型(布尔值，字符串，数值，数组，哈希)，条件判断，字段引用等。</p>\n<p>Logstash的数据管道包含三个步骤，Input，Filter和Output，每一步都可以通过plugin来扩展。另外Input和Output还支持配置Codecs，完成对输入输出数据的编解码工作。</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201706/19170803_cGoS.png\" alt=\"\"></p>\n<p>Logstash支持的常见的Input包含File，syslog，beats等。Filter中主要完成数据的变形处理，可以增删改字段，加标签，等等。作为一个开源软件，Output不仅仅支持ElasticSearch，还可以和许多其它软件集成和目标，Output可以是文件，graphite，数据库，Nagios，S3，Hadoop等。</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201706/19170811_3g2R.jpg\" alt=\"\"></p>\n<p>在实际运用中，logstash 进程会被分为两个不同的角色。运行在应用服务器上的，尽量减轻运行压力，只做读取和转发，这个角色叫做 shipper；运行在独立服务器上，完成数据解析处理，负责写入 Elasticsearch 的角色，叫 indexer。</p>\n<p>logstash 作为无状态的软件，配合消息队列系统，可以很轻松的做到线性扩展</p>\n<p><a href=\"https://github.com/elastic/beats\" rel=\"nofollow\">Beats</a>是 Elastic 从 packetbeat 发展出来的数据收集器系统。beat 收集器可以直接写入 Elasticsearch，也可以传输给 Logstash。其中抽象出来的 libbeat，提供了统一的数据发送方法，输入配置解析，日志记录框架等功能。</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201706/19170345_gLzF.png\" alt=\"\"></p>\n<p>开源社区已经贡献了<a href=\"https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html\" rel=\"nofollow\">许多的beats</a>种类。</p>\n<p>因为Beats是使用Golang编写的，效率上很不错。</p>\n<p><strong>Splunk</strong>使用Farwarder和Add-ons来进行数据的消化和获取。</p>\n<p>Splunk内置了对文件，syslog，网络端口等input的处理。当配置某个节点为Forwarder的时候，Splunk Forwarder可以作为一个数据通道把数据发送到配置好的indexer去。这时候，它就类似logstash。这里一个主要的区别就是对数据字段的抽取，Elastic必须在logstash中通过filter配置或者扩展来做，也就是我们所说的Index time抽取，抽取后不能改变。Splunk支持Index time的抽取，但是更多时候，Splunk 在index time并不抽取而是等到搜索是在决定如何抽取字段。</p>\n<p>对于特定领域的数据获取，Splunk是用<a href=\"https://www.splunk.com/en_us/products/apps-and-add-ons.html\" rel=\"nofollow\">Add-on</a>的形式。Splunk 的App市场上有超过600个不同种类的Add-on。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/172840_Kc9n_1450051.png\" alt=\"\" width=\"788\" height=\"624\"></p>\n<p>用户可以通过特定的Add-on或者自己开发Add-on来获取特定的数据。</p>\n<p>对于大数据的数据采集，大家也可以参考我的<a href=\"https://my.oschina.net/taogang/blog/524385\" rel=\"nofollow\">另一篇博客</a>。</p>\n<h3 id=\"h3_5\">数据管理和存储</h3>\n<p>ElasticSearch的数据存贮模型来自于Lucene，基本原理是实用了倒排表。大家可以参考<a href=\"http://www.infoq.com/cn/articles/analysis-of-elasticsearch-cluster-part01\" rel=\"nofollow\">这篇文章</a>。</p>\n<p>Splunk的核心同样是倒排表，推荐大家看这篇去年Splunk Conf上的介绍，<a href=\"https://conf.splunk.com/files/2016/slides/behind-the-magnifying-glass-how-search-works.pdf\" rel=\"nofollow\">Behind the Magnifying Glass: How Search Works</a></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/173140_pJqA_1450051.png\" alt=\"\" width=\"2062\" height=\"890\"></p>\n<p>Splunk的Event存在许多Buckets中，多个Buckets构成逻辑分组的索引分布在Indexer上。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/175300_F8F0_1450051.png\" width=\"2134\" height=\"836\"></p>\n<p>每个Bucket中都是倒排表的结构存储数据，原始数据通过gzip压缩。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/191746_kL6q_1450051.png\" width=\"2066\" height=\"1052\"></p>\n<p>搜索时，利用Bloom filter定位数据所在的bucket。</p>\n<p>在对数据的存储管理上，Elastic 和Splunk都是利用了倒排表。Splunk对数据进行压缩，所以存储空间的占用要少很多，尤其考虑到大部分数据是文本，压缩比很高的，当然这会损失一部分性能用于数据的解压。</p>\n<h3 id=\"h3_6\">数据分析和处理</h3>\n<p>对数据的处理分析，ElasticSearch主要使用 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search.html\" rel=\"nofollow\">Search API</a>来实现。而Splunk则提供了非常强大的<a href=\"https://www.splunk.com/en_us/resources/search-processing-language.html\" rel=\"nofollow\">SPL</a>，相比起ES的Search API，Splunk的SPL要好用很多，可以说SPL就是非结构化数据的SQL。无论是利用SPL来开发分析应用，还是直接在Splunk UI上用SPL来处理数据，SPL都非常易用。开源社区也在试图为Elastic增加类似SPL的DSL来改善数据处理的易用性。例如：</p>\n<ul>\n<li><a href=\"https://github.com/chenryn/ESPL\" rel=\"nofollow\">https://github.com/chenryn/ESPL</a></li>\n</ul>\n<p>从这篇<a href=\"https://discuss.elastic.co/t/elastic-vs-splunk-query-feature-comparison-join-pipe-table-dedup-eval-chart-rex/23552\" rel=\"nofollow\">反馈</a>可以看出，ES的search还有许多的不足。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/194302_paug_1450051.png\" width=\"2234\" height=\"1066\"></p>\n<p>作为对此的响应，Elastic推出了<a href=\"https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-getting-started.html\" rel=\"nofollow\">painless script</a>，该功能还处于实验阶段。</p>\n<h3 id=\"h3_7\">数据展现和可视化</h3>\n<p>Kibana是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。使用Kibana，可以通过各种图表进行高级数据分析及展示。</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201706/19171453_gqaE.jpg\" alt=\"\"></p>\n<p>Splunk集成了非常方便的数据可视化和仪表盘功能，对于SPL的结果，可以非常方便的通过UI的简单设置进行可视化的分析，导出到仪表盘。</p>\n<p><img src=\"https://static.oschina.net/uploads/img/201706/19171456_fsKK.jpg\" alt=\"\"></p>\n<p>下图的比较来自<a href=\"https://www.itcentralstation.com/products/comparisons/kibana_vs_splunk\" rel=\"nofollow\">https://www.itcentralstation.com/products/comparisons/kibana_vs_splunk</a></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/193547_Wwq6_1450051.png\" width=\"1982\" height=\"750\"></p>\n<p>在数据可视化的领域的<a href=\"https://www.itcentralstation.com/categories/data-visualization#top_rated\" rel=\"nofollow\">排名</a>，Splunk仅仅落后于Tableau而已</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0619/194139_q14k_1450051.png\" width=\"2010\" height=\"1314\"></p>\n<h3 id=\"h3_8\">扩展性</h3>\n<p>从扩展性的角度来看，两个平台都拥有非常好的扩展性。</p>\n<p>Elastic栈作为一个开源栈，很容易通过Plugin的方式扩展。包括：</p>\n<ul>\n<li><a href=\"https://www.elastic.co/guide/en/elasticsearch/plugins/current/index.html\" rel=\"nofollow\">ElasticSearch Plugin </a></li>\n<li><a href=\"https://www.elastic.co/guide/en/kibana/current/kibana-plugins.html\" rel=\"nofollow\">Kibana Plugin</a></li>\n<li><a href=\"https://www.elastic.co/guide/en/logstash/current/working-with-plugins.html\" rel=\"nofollow\">Logstash Plugin</a></li>\n<li><a href=\"https://www.elastic.co/guide/en/beats/libbeat/current/new-beat.html\" rel=\"nofollow\">Beats Platform</a></li>\n</ul>\n<p>Splunk提供一系列的扩展点支持应用和Add-on的开发， 在<a href=\"http://dev.splunk.com/\" rel=\"nofollow\">http://dev.splunk.com/</a>可以找到更多的信息和文档。包括：</p>\n<ul>\n<li><a href=\"http://dev.splunk.com/webframework\" rel=\"nofollow\">Web Framework</a></li>\n<li><a href=\"http://dev.splunk.com/sdks\" rel=\"nofollow\">SDK</a></li>\n<li><a href=\"http://dev.splunk.com/view/python-sdk/SP-CAAAER3\" rel=\"nofollow\">Modular Input</a></li>\n<li>… …</li>\n</ul>\n<p>比起Elastic的Plugin，Splunk的扩展概念上比较复杂，开发一个App或者Add-on的门槛都要相对高一些。做为一个数据平台，Splunk应该在扩展性上有所改进，使得扩展变的更为容易和简单。</p>\n<h2 id=\"h2_9\">架构</h2>\n<p><strong>Elastic Stack</strong></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/104019_J5fb_1450051.png\" width=\"1152\" height=\"431\"></p>\n<p>如上图所示，ELK是一套栈，Logstash提供数据的消化和获取，Elasticsearch对数据进行存储，索引和搜索，而Kibana提供数据可视化和报表的功能。</p>\n<p><strong>Splunk</strong></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/103709_fR14_1450051.png\" width=\"699\" height=\"700\"></p>\n<p>Splunk的架构主要有三个角色：</p>\n<ul>\n<li>Indexer<br>\nIndexer提供数据的存储，索引，类似Elasticsearch的作用</li>\n<li>Search Head<br>\nSearch Head负责搜素，客户接入，从功能上看，一部分是Kibana，因为Splunk的UI是运行在Search Head上的，提供所有的客户端和可视化的功能，还有一部分，是提供分布式的搜索功能，包含对搜索的分发到Indexer和搜索结果的合并，这一部分功能对应在Elasticsearch上。</li>\n<li>Forwarder<br>\nSplunk的Forwarder负责数据接入，类似Logstash</li>\n</ul>\n<p>除了以上的三个主要的角色，Splunk的架构中还有：Deployment Server，License Server，Master Cluster Node，Deployer等。</p>\n<p>Splunk和ELK的基本架构非常类似，但是ELK的架构更为简单和清楚，Logstash负责数据接入，Kibana负责数据展现，所有的复杂性在Elasticsearch中。Splunk的架构更为复杂一些，角色的类型也更多一些。</p>\n<p>如果装单机版本，Splunk更容易，因为所有的功能一次性就装好了，而ELK则必须分别安装E/L/K，从这一点上来看，Splunk有一定的优势。</p>\n<h2 id=\"h2_10\">分布集群和扩展性</h2>\n<p><strong>ElasticSearch</strong></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/105032_zDW9_1450051.png\" width=\"607\" height=\"254\"></p>\n<p>ElasticSearch是为分布式设计的，有很好的扩展性，在一个典型的分布式配置中，每一个节点（node）可以配制成不同的角色，如上图所示：</p>\n<ul>\n<li>Client Node，负责API和数据的访问的节点，不存储／处理数据</li>\n<li>Data Node，负责数据的存储和索引</li>\n<li>Master Node， 管理节点，负责Cluster中的节点的协调，不存储数据。</li>\n</ul>\n<p>每一种角色可以通过ElasticSearch的配置文件或者环境变量来配置。每一种角色都可以很方便的Scale，因为Elastic采用了对等性的设计，也就是所有的角色是平等的，（Master Node会进行Leader Election，其中有一个是领导者）这样的设计使得在集群环境的伸缩性非常好，尤其是在容器环境，例如Docker Swarm或者Kubernetes中使用。</p>\n<p>参考：</p>\n<ul>\n<li><a href=\"https://elk-docker.readthedocs.io/#elasticsearch-cluster\" rel=\"nofollow\">https://elk-docker.readthedocs.io/#elasticsearch-cluster</a></li>\n<li><a href=\"https://github.com/pires/kubernetes-elasticsearch-cluster\" rel=\"nofollow\">https://github.com/pires/kubernetes-elasticsearch-cluster</a></li>\n</ul>\n<p><strong>Splunk</strong></p>\n<p>Splunk作为企业级的分布式机器数据的平台，拥有强大的分布式配置，包括跨数据中心的集群配置。Splunk提供两种集群，Indexer集群和Search Head集群。</p>\n<p>Splunk <a href=\"http://docs.splunk.com/Documentation/Splunk/6.6.1/Indexer/Basicclusterarchitecture\" rel=\"nofollow\">Indexer集群</a></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/104459_RNyl_1450051.png\" width=\"590\" height=\"525\"></p>\n<p>如上图所示，Splunk的indexer集群主要由三种角色：</p>\n<ul>\n<li>Master Node，Master Node负责管理和协调整个的集群，类似ES的Master。但是只有一个节点，不支持多Master（最新版本6.6）。Master Node负责\n<ul>\n<li>协调Peer Node之间的数据复制</li>\n<li>告诉Search Head数据在哪里</li>\n<li>Peer Node的配置管理</li>\n<li>Peer Node故障时的故障恢复</li>\n</ul>\n</li>\n<li>Peer Nodes，负责数据索引，类似ES的Data Node，Peer Node负责\n<ul>\n<li>存储索引数据</li>\n<li>发送／接收复制数据到其他Peer节点</li>\n<li>响应搜索请求</li>\n</ul>\n</li>\n<li>Search Head，负责数据的搜索和客户端API访问，类似ES的Client Node，但不完全相同。Search Head负责发送搜索请求到Peer Nodes，并对搜索的结果进行合并。</li>\n</ul>\n<p>有人会问，那Master是不是集群中的单点故障？What if Master node goes down？Splunk的回答是否。即使Master 节点出现故障，Peer Nodes仍然可以正常工作，除非，同时有Peer Node出现故障。</p>\n<ul>\n<li><a href=\"http://docs.splunk.com/Documentation/Splunk/6.6.1/Indexer/Whathappenswhenamasternodegoesdown\" rel=\"nofollow\">http://docs.splunk.com/Documentation/Splunk/6.6.1/Indexer/Whathappenswhenamasternodegoesdown</a></li>\n<li><a href=\"https://answers.splunk.com/answers/129446/why-does-master-node-continue-to-be-single-point-of-failure-in-clustering.html\" rel=\"nofollow\">https://answers.splunk.com/answers/129446/why-does-master-node-continue-to-be-single-point-of-failure-in-clustering.html</a></li>\n</ul>\n<p>Splunk <a href=\"http://docs.splunk.com/Documentation/Splunk/6.6.1/DistSearch/SHCarchitecture%C2%A0\" rel=\"nofollow\">Search Header 集群</a></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/121621_KPDw_1450051.png\" width=\"646\" height=\"408\"></p>\n<p>Search Head集群是由一组Search Head组成，它们共享配置，搜索任务等状态。该Cluster主要有以下角色：</p>\n<ul>\n<li>Deployer， 负责分发状态和应用到peers</li>\n<li>Cluster Member，其中有一个是Captain，负责协调。Cluster Memeber之间会互相通信，来保证状态一致。Load Balancer是个可选项，可以负责Search的接入。</li>\n<li>Search Peers，负责数据索引的 Indexer Nodes</li>\n</ul>\n<p>另外Splunk还曾经提供过一个功能叫做<a href=\"http://docs.splunk.com/Documentation/Splunk/6.6.1/DistSearch/Configuresearchheadpooling\" rel=\"nofollow\">Search Head Pooling</a>，不过现在已经Depecated了。</p>\n<p>Indexer集群可以和Search Head集群一起配置，构成一个分布式的Splunk配置。</p>\n<p>相比较ES的相对比较简单的集群配置，Splunk的集群配置比较复杂，ES中所有每一个节点可以灵活的配置角色，并且可以相对比较容易的扩展，利用例如Kubernetes的Pod的复制可以很容易的扩展每一个角色。扩展Splunk相对比较困难，要做到动态的伸缩，需要比较复杂的配置。大家可以参考<a href=\"https://github.com/outcoldman/docker-splunk-cluster\" rel=\"nofollow\">这里</a>，在容器环境里配置一个Splunk的集群需要比较多的布置，例如在这个<a href=\"https://github.com/outcoldman/docker-splunk-cluster/blob/master/examples/docker/cluster-master.env_file\" rel=\"nofollow\">Master的配置</a>中，用户需要考虑：</p>\n<ul>\n<li>如何配置License</li>\n<li>修改缺省的用户名口令</li>\n<li>为每一个Search Head配置Search Head Cluster</li>\n<li>等待Splunk进程成功启动</li>\n<li>配置业务发现</li>\n<li>安装应用</li>\n<li>… …</li>\n</ul>\n<p>并且集群的扩展很难直接利用容器编排平台提供的扩展接口，这一点Splunk还有很多提高的空间。</p>\n<h2 id=\"h2_11\">产品线</h2>\n<p><strong>Elastic</strong></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/103316_ysvG_1450051.png\" width=\"859\" height=\"436\"></p>\n<p>Elastic的产品线除了大家熟悉的ELK（ElasticSearch，Logstash，Kikana），主要包含</p>\n<ul>\n<li><a href=\"https://www.elastic.co/guide/en/beats/libbeat/current/index.html\" rel=\"nofollow\">Beats</a> Beats是一个开源组件，提供一个代理，把本地抓到的数据传送到ElasticSearch</li>\n<li><a href=\"https://www.elastic.co/guide/en/cloud/current/index.html\" rel=\"nofollow\">Elastic Cloud</a>， Elasti提供的云服务</li>\n<li><a href=\"https://www.elastic.co/guide/en/x-pack/current/index.html\" rel=\"nofollow\">X-Pack</a>， Elastic的扩展组件，提供安全，告警，监控，机器学习和图处理能力。主要功能需要付费使用。</li>\n</ul>\n<p><strong>Splunk</strong></p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/103236_KuNa_1450051.png\" width=\"1742\" height=\"756\"></p>\n<p>Splunk的产品线包括</p>\n<ul>\n<li>Splunk Enterprise</li>\n<li>Splunk Cloud， Splunk运营的云服务，跑在AWS上</li>\n<li>Splunk Light，Splunk Light版本，功能有所精简，面向中小企业</li>\n<li>Hunk， Splunk on Hadoop</li>\n<li>Apps ／ Add-ons,  Splunk提供大量的应用和数据获取的扩展，可以参考 <a href=\"http://apps.splunk.com/\" rel=\"nofollow\">http://apps.splunk.com/</a></li>\n<li>Splunk ITSI （IT Service Intelligence）， Splunk为IT运维专门开发的产品</li>\n<li>Splunk ES （Enterprise Security）， Splunk为企业安全开发的产品，这个是Splunk 公司的拳头产品，连续被<a href=\"http://www.gartner.com/it-glossary/security-information-and-event-management-siem/\" rel=\"nofollow\">Gartner</a>评为<a href=\"https://en.wikipedia.org/wiki/Security_information_and_event_management\" rel=\"nofollow\">SIEM</a>领域的领导者，挑战了该行业的传统巨鳄IBM，HP</li>\n<li>Splunk UBA （User Behavior Analytic）， UBA是Splunk在15年<a href=\"https://www.splunk.com/en_us/investor-relations/acquisitions/caspida.html\" rel=\"nofollow\">收购的Caspidia</a>带来的基于机器学习的安全产品。</li>\n</ul>\n<p>从产品线的角度来看，Splunk除了提供基本平台，在IT运维和安全领域都有自己的拳头产品。Elastic缺乏某个领域的应用。</p>\n<h2 id=\"h2_12\">价格</h2>\n<p>价格是大家非常关心的一个因素</p>\n<p>Elastic的基本组件都是开源的，参看<a href=\"https://www.elastic.co/cloud/as-a-service/subscriptions\" rel=\"nofollow\">下表</a>，X-pack中的一些高级功能需要付费使用。包含安全，多集群，报表，监控等等。</p>\n<p><a href=\"https://www.elastic.co/subscriptions#request-info\" rel=\"nofollow\"><img src=\"https://static.oschina.net/uploads/space/2017/0614/112815_X1nv_1450051.png\" width=\"879\" height=\"656\"></a></p>\n<p>云服务的<a href=\"https://www.elastic.co/cloud/as-a-service/pricing\" rel=\"nofollow\">价格</a>参考下图，ES的云是按照所使用的资源来收费，从这里选取的区域可以看出，ES的云也是运行在AWS上的。下图中的配置每月需要花费200美元左右。（不同区域的收费不同）</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/122208_0lhg_1450051.png\" width=\"1235\" height=\"838\"></p>\n<p>同时，除了Elastic自己，还有许多其他公司也提供Elastic Search的云服务，例如Bonsai，Qbox.io等。</p>\n<p><a href=\"https://www.slant.co/topics/170/~best-hosted-elasticsearch-services\" rel=\"nofollow\"><img src=\"https://static.oschina.net/uploads/space/2017/0614/122320_NH3b_1450051.png\" width=\"599\" height=\"715\"></a></p>\n<p><strong>Splunk</strong></p>\n<p>Splunk Enterprise是按照数据每日的流量按年或者无限制事件付费，每天1GB的话，每年是2700美元，每个月也是差不多200块。如果每天的数据量少于500M，可以使用Splunk提供的免费License，只是不能用安全，分布式等高级功能，500M可以做很多事情了。</p>\n<p><a href=\"https://www.splunk.com/en_us/products/pricing.html\" rel=\"nofollow\"><img src=\"https://static.oschina.net/uploads/space/2017/0614/112050_q0Dx_1450051.png\" width=\"1169\" height=\"568\"></a></p>\n<p>云服务的价格就要便宜多了，每天5GB，每年只要2430元，每个月不到200块。当然因为计费的方式不同，和Elastic的云就不好比较了。另外因为是在AWS上，中国的用户，呵呵了。</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0614/121744_0ol0_1450051.png\" width=\"1168\" height=\"541\"></p>\n<h2 id=\"h2_13\">总结</h2>\n<p>大数据的搜索平台已经成为了众多企业的标配，Elastic栈和Splunk是其中最为优秀和流行的选择。两者都有各自的优点和值得改进的地方。希望本文能够在你的大数据平台的选型上，有所帮助。也希望大家来和我交流，共同成长。</p>\n<h2 id=\"h2_14\">参考文档</h2>\n<p>ELK</p>\n<ul>\n<li>ElasticSearch 参考文档<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html\" rel=\"nofollow\">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></li>\n<li>Github上收集的ElasticSearch相关开源软件列表 <a href=\"https://github.com/dzharii/awesome-elasticsearch\" rel=\"nofollow\">https://github.com/dzharii/awesome-elasticsearch</a></li>\n<li>知乎ElaticSearch专题 <a href=\"https://www.zhihu.com/topic/19899427/hot\" rel=\"nofollow\">https://www.zhihu.com/topic/19899427/hot</a></li>\n<li>中文书 <a href=\"https://github.com/chenryn/ELKstack-guide-cn\" rel=\"nofollow\">https://github.com/chenryn/ELKstack-guide-cn</a></li>\n<li>中文书 <a href=\"https://www.gitbook.com/book/wizardforcel/mastering-elasticsearch/details\" rel=\"nofollow\">https://www.gitbook.com/book/wizardforcel/mastering-elasticsearch/details</a></li>\n</ul>\n<p>Splunk</p>\n<ul>\n<li>Splunk 文档 <a href=\"https://docs.splunk.com/Documentation\" rel=\"nofollow\">https://docs.splunk.com/Documentation</a></li>\n<li>Splunk电子书 <a href=\"https://www.splunk.com/web_assets/v5/book/Exploring_Splunk.pdf\" rel=\"nofollow\">https://www.splunk.com/web_assets/v5/book/Exploring_Splunk.pdf</a></li>\n<li>Splunk 开发文档 <a href=\"http://dev.splunk.com/getstarted\" rel=\"nofollow\">http://dev.splunk.com/getstarted</a></li>\n<li>Splunk 应用市场 <a href=\"http://apps.splunk.com/\" rel=\"nofollow\">http://apps.splunk.com/</a></li>\n<li>Splunk 快速参考 <a href=\"https://www.splunk.com/content/dam/splunk2/pdfs/solution-guides/splunk-quick-reference-guide.pdf\" rel=\"nofollow\">https://www.splunk.com/content/dam/splunk2/pdfs/solution-guides/splunk-quick-reference-guide.pdf</a></li>\n</ul>\n<p>其它</p>\n<ul>\n<li><a href=\"https://www.upguard.com/articles/splunk-vs-elk\" rel=\"nofollow\">https://www.upguard.com/articles/splunk-vs-elk</a></li>\n<li><a href=\"https://db-engines.com/en/system/Elasticsearch%3BSplunk\" rel=\"nofollow\">https://db-engines.com/en/system/Elasticsearch%3BSplunk</a></li>\n<li><a href=\"https://www.searchtechnologies.com/blog/log-analytics-tools-open-source-vs-commercial\" rel=\"nofollow\">https://www.searchtechnologies.com/blog/log-analytics-tools-open-source-vs-commercial</a></li>\n<li><a href=\"http://www.learnsplunk.com/splunk-vs-elk-stack.html\" rel=\"nofollow\">http://www.learnsplunk.com/splunk-vs-elk-stack.html</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111525\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111525votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111525\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e81f66bb819f021a1b7b51d3573617097a9d860d.jpg"}
{"url_object_id": "d8f9f8f08d6737cb4a3e4987ebbc04cb", "url": "http://blog.jobbole.com/111497/", "title": "自学的程序员如何找到好工作？", "front_image_url": ["http://wx1.sinaimg.cn/large/7cc829d3gy1fgqaiwbj8uj20nj0d3757.jpg"], "create_date": "2017-06-19", "praise_nums": 4, "fav_nums": 1, "comment_nums": 5, "tags": "开发,职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://brianknapp.me/how-do-self-taught-developers-actually-get-jobs/\">Brian Knapp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：2016 年有位年轻的程序员在 Quora 上提问求助：</p>\n<blockquote><p>我今年 17 岁，从 14 岁开始编程。我主要关注 Java 语言，并在 AP 计算机科学这门课上拿了 5 分。我相当精通 Java（比如语法、主要类、GUI/JFrame 等），HTML5 和 CSS3 也不错。我感觉自己缺乏很多有用的技能，来帮助我在人才市场上推销自己（比如数据库的工作原理，以及我应该使用哪些工具），我很好奇其他人是如何学习这些东西的。我打算去大学拿一个软件开发的学位，但我开始感到有点沮丧，觉得读大学的目的就是为了工作。现在有哪些我应该上的课程，或者应该做的事情吗？</p></blockquote>\n<p><img id=\"pic\" class=\"\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgqaiwbj8uj20nj0d3757.jpg\" width=\"620\" height=\"345\"></p>\n<h3>下面是 Brain Knapp 的回答分享︰</h3>\n<p>我认为你的看法错了。你觉得你需要上课，让别人来教你，告诉你答案。从根本上讲，自学的程序员能够做不一样的事情。</p>\n<p>自学的程序员和自学的吉他手有很多共同点。我不知道你是否玩过吉他，所以我将向你解释如何自学吉他。</p>\n<p>首先，这一切的开始是由于某人与某个吉他手产生了共鸣。大多数突然想要自学吉他的人，是想要成为另一个吉他手。之后，他们下定决心——“我也可以成为一个吉他手 ”，于是去了当地的乐器店，买了一把二手吉他（因为二手吉他更便宜，但也很酷）。</p>\n<p>接下来可能会有两种情况，要不买一本“吉他入门”或类似的书籍开始自学，要不打开 YouTube，开始学习如何弹奏自己喜爱的歌。那些尝试学习弹奏喜欢的歌的自学者，往往学得更好。</p>\n<p>当年轻的吉他手主动地学习某首歌时，他们往往需要观看视频、打印曲谱、练习和弦等等。然后，根据拿到的视频和曲谱，他们会坐下来尝试重新演绎歌曲。</p>\n<p>经过数小时的练习，不断重复和弦、独奏、节拍等，他们将能够以自己的形式表演那首歌。它不再是原来那首歌，但也够酷。</p>\n<p>然后，他们会拿起另一首歌，重复这个过程。一路走来，他们不断学习节拍、技术以及其他的东西，甚至都没有意识到学习的内容。在知道专业名词和理论前，他们已经懂得如何操作。</p>\n<p><span style=\"color: #000000\">最终，弹吉他变成了一种“直觉”，学习一首新歌也变得习以为常且不再痛苦。吉他的“语言”变得像你我说话那样容易。</span></p>\n<p>这一切的发生，背后是数千小时的艰苦练习。即使每天只练习一小时，也需要耗费数年。</p>\n<p><strong>那么，这和自学的程序员有什么关系呢？</strong></p>\n<p><span style=\"color: #000000\">事实上，真正成就自学的程序员的，就是他们会自己创建东西，很多东西。</span>要成为一个具有卓越技能的出色程序员，你必须创建东西，写代码。</p>\n<p>上课学习理论知识固然是好的，但很多教授不能跳出条条框框的束缚，以自己的方式编程。就算他们努力尝试，也做不出别人愿意用的应用程序。</p>\n<p>这并不是说他们不了解教授的知识，而是说，作为一名教授，他们掌握的技能是研究和理论性理解，而不是写代码和为客户提供价值。</p>\n<p><strong>你看到区别了吗？</strong></p>\n<p>我合作过的最好的程序员，他们的工作方式就是做东西，做很多东西，并且几乎一直这样。</p>\n<p>例如，现在几乎每个人都使用 WordPress。在 WordPress 出现很久之前，我就用 PHP 和 MySQL 创建了 3 到 5 个不同的内容管理系统。我写过游戏、移动应用程序、框架，还有 SAAS 应用程序。</p>\n<p>没人付钱让我做这些事情。我做这些事纯粹是出于好玩、学习或好奇的目的。</p>\n<p>我已经好几年都没有上过课了，即使上了，我也不觉得这会对我的事业有任何帮助。然而，如果我决定坐下来，从头开始创建我自己的计算机语言或操作系统，我打赌我一定能在过程中学到很多有趣的东西。</p>\n<p>是的，我可以带着那些想法上课，但在创建东西，犯下错误，以及真正“体会到”这一切的经历中，相比读一本书或听一次讲座，我能收获更多。</p>\n<p>因此，我给你的建议（如果你做到了，相比没有做的那些人而言，会带给你巨大的优势），就是：</p>\n<p><strong><span style=\"color: #ff0000\">解决一个你想解决的问题</span>。</strong>创建一个用于某件事的软件，解决一些你本人或他人想要通过软件解决的问题。每天为这个软件写代码，晚上写，周末也写，每天都写。即使你每天只花了 15 分钟写代码，也没关系。</p>\n<p>最终，你将得到一个能用的软件，这很不错。</p>\n<p><span style=\"color: #ff0000\"><strong>然后，你再重复这一过程。做一个其他的东西。不断地做。花费大量的时间，通过创建更多的东西来提升你的技能。</strong></span></p>\n<p>做东西的同时，注意在你的网站上保存工作，并将其放在一个作品集中。每次你结束了一个项目，就将它上传到 Hacker News、Reddit 或其他什么网站，并发条关于它的博文。</p>\n<p>你现在仅仅 17 岁，当你 20 岁的时候，你已经轻松地将两千多小时用于锻炼技能，你的个人作品集中也有了大概十到二十多个软件，你学习到的经验是那些仅仅上课的人无法比拟的。</p>\n<p>更重要的是，你已经清楚地告诉别人，你能够独立地写代码，解决问题并给世界带来一些新东西。这是最难能可贵的一点，也是公司在不断追求的一点。</p>\n<p><span style=\"color: #ff0000\"><strong>一旦你找到了工作，请继续在业余时间创建东西，并提升你的工作技能</strong></span>。你的提升速度将比你的同事更快，因为他们在下班回家后看电视，而不是学习、成长或创建东西。他们拿到了薪水就回家享受去了。</p>\n<p>你做的越多，你学的也越多；你学的越多，你的价值就越高；你的价值越高，你就越容易找到工作，你的工资也就更高，这是一个良性循环。</p>\n<p>所以，去做些东西出来。现在就开始写代码吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111497\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111497votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111497\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 15 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/47088ef57f09c838c2a3bc97ec1b49801c291a32.jpg"}
{"url_object_id": "2139dbe97ca8c52f95ad3657fd02203b", "url": "http://blog.jobbole.com/111535/", "title": "我眼中的项目经理", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/08/25e260d52cd3cc8e5ae1638dd3ab4271.jpg"], "create_date": "2017-06-21", "praise_nums": 1, "fav_nums": 2, "comment_nums": 1, "tags": "职场,程序员,职场,项目经理", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/ljhdo/p/5068072.html\">Vic Liu</a>   </div><div>\n<h3>把想法变成项目，服务于业务</h3>\n<p>在项目组待的时间久了，渐渐地跟微软的项目经理Michael熟悉起来了，跟他有过很多次深入的聊天，向他请教过很多关于人生，理想，技术上的问题，不得不说，项目经理是我神往的角色。虽然我没有亲身经历过，但是我认为做项目经理很有意思，把一个想法变成项目，服务于业务，这是我期望的工作。 佛者说：“一花一世界，一叶一菩提”，不得不说，修行是一个技术活，面对同一个世界，眼界的不同，能够看到的事物也是不同的；同样一句话，阅历不同，理解也会不同。那我就说说我眼中的项目经理，与常人不同的是，他们总是更进一步，想的更多，做的更多。</p>\n<p>在每天的Daily Scrum会议上，Michael照例追踪分配给每个人的Task的完成情况，并分配新的Task。这种一成不变的例行汇报，听的多了，就有点习以为常了，左耳朵进，右耳朵出，当然，起码得“留一点痕迹”，至少得知道自己新的Task。在项目不是很复杂的时候，即使做不同样的事情，也大概知道彼此做事的内容。可是有一次，在同事小林汇报工作时，即使我集中十二分的注意力，也听不懂小林说话的内容，但是，Michael却能瞬间找到关键点，那一刻，我才知道什么叫“默契”，我能感受到小林的开心，因为有人很懂她。</p>\n<p>我请教过这个问题，Michael说：“这是由于‘信息不对称’导致的，因为我负责整个项目的进度和业务，跟所有的开发工程师（Developer）都有交集，交流比较多，知道他们在做什么，能听懂他们说的话，这很正常，不用诧异。”我觉得信息不对称，固然是一个重要的原因，但是，不是最主要的。我曾经在汇报工作时，对于数据库中出现的一个问题，提出了一个解决方案，由于这个想法是临时想出来的，我在描述解决方案时，没有组织好语言，说的磕磕绊绊，我认为我没有说清除，但是，Michael却出乎我意料之外的理解了，并把我的不成熟的想法完善了，当时，我意识到，有人懂我，是多么的开心，也理解了同事小林当时喜悦的心情。这是信息不对称，善于沟通所不能解释的，我认为，熟悉业务，善于思考，对项目经理来说，才是最重要的特质。</p>\n<h3>换位思考</h3>\n<p>还有一件事，由于同事小陈离职了，我开始接手PowerBI报表，在跟业务分析小组的同事共事时，我发现他们身上有一个显著的个性，就是：<strong>站在老板的立场上思考问题，组织语言和汇报工作。</strong>在我第一次无意识地向老板直接汇报工作时，我犯了很多技术出身的开发人员经常忽视的错误，那就是不自觉地在报告中掺杂了太多的开发术语，没有意识到，我面对的客户是一位不懂技术，但深谙业务的老板。沈姐是业务分析小组实际上的Leader，她跟我说：“你不能那样向老板回邮件，老板不懂技术，只懂业务，你要翻译成他们能够理解的内容，他们才知道，你已经把问题解决了，不然，他们又会发邮件问你。”</p>\n<p>有了沈姐的开导，我开始意识到，在工作上，必须具有换位思考的意识：站在老板的角度上来看待问题，但意识到，不代表你就能做到，这是一个技术活。当老板再次发送邮件，提出新的业务需求时，我又犯错了，这次的错误，是由于信息不对称导致的，也跟我缺少历练有关。老板在邮件中，说到：“请提供报表数据，用于分析组织者（Organizer）每个月在活动中的贡献（Contribution）。”由于在业务逻辑中，组织者（Organizer）是管理者角色的一种，除了Organizer，还有Co-Organizer，Event-Organizer，Assistant-Organizer等管理者角色，我提供的报表数据仅仅是Organizer角色每个月的贡献。Michael在Review代码时，认真对我说：“Vic，老板不知道我们具体的角色分类，老板想知道的，其实是所有组织者在每个月的贡献，要站在老板的角度上，处理问题。给老板的报表，每一个数据上的细节都必须做到有理有据，即使数据对不上，不align，也必须要有合理的解释。”这次教训非常深刻，我意识到，老板是特殊的存在，必须理解老板的意思，同时，也必须把自己的意思传达给老板，这中间需要由一个词汇的转换，怎样做到？站在老板的角度上，思考问题，处理问题，刚开始做的不好，不要紧，必须要有这个意识（Sense）和觉悟。</p>\n<h3>项目经理是整个项目组的大脑</h3>\n<p>这样说一点也不为过，至少在我们项目组是这样的，其他成员具备的是执行力，也就是按时完成任务的能力。这里抛出一个问题：给你一个团队，你要如何带？在两年多的时间里，Michael带领我们团队做过很多新的项目，而每个新的项目都不是凭空想出来的。之所以这么说，是因为，我也曾经有过相同的想法，但是，我没有意识到这个想法的价值，在脑海中思考过之后，没有把想法“变现”的意识，导致轻易把想法抛弃；一旦Michael提出类似的新项目之后，我发觉：“我曾经也有过这个想法，只不过，我没有继续深入下去，没有更进一步去丰富这个想法 ……”</p>\n<p>反省不能解决问题，或许，这才是项目经理应该具备的优秀性格：不是想不到，而是善于发现想法的价值。Michael把抽象的想法，变成文档上的设想，经过丰富之后，变成有价值的具体项目，这就是创建价值，简化业务的过程。Michael说：“我想实现的新项目，实际上就是为了优化业务流程，做到化繁为简，而为了实现这个目的，必须化简为繁。比如，为了便于发现更多有影响力的人物（Influencer），必须整合所有的数据资源，从各个数据源中分析数据，这是我们的主要业务需求，为了简化这个流程，可以把这套业务流程扩大化，自动化，做一个更为复杂的引擎来替代手工，一旦这个繁的引擎做出来，业务流程就会变的非常简单。”抓住主要业务搞优化，实现项目的增值和技术的迭代，这其实也是他的一种管理思想，极简工作：先解决主要矛盾，再解决次要矛盾，根据业务需求，调整优先级。</p>\n<h3>项目经理很忙的</h3>\n<p>实际上，我观察到Michael的工作，1/3是在开会。不仅跟开发者开会，而且跟老板开会。我们的老板是外国人，Michael的英语相当不错，上海人，软实力杠杠滴，从小到大接受的教育，是我们这些屌丝所不能想象的。跟老板开会的内容，大致是谈论业务需求，演示新的项目，Michael说：“老板是非常聪明的，非常熟悉业务，对于新的项目，老板只要看到demo，自然会想到如何使用，不需要过多的文字说明”，好吧，高级别的老板，我也没有接触过，能坐到那个位置上，肯定有过人之处。跟开发者开会，Michael主要是演示项目，把控项目的进度和分配任务。</p>\n<p>Michael在任务的管控上，没有绝对的收和放，而是：前期放任，定时检查，最后是测试和验收。不过，他的管理风格还是比较自由的，他说：“我分配一个任务交给你们来做，你们想怎么做，就怎么做，只要实现业务需求就行。我的任务不是告诉你们如何去做，而是，告诉你们怎么做最简单，哪些是当前的业务上能够满足的，哪些是当前不需要做的。”</p>\n<h3>项目经理很忙的</h3>\n<p>但是，Michael能够记住很多非常细节的业务逻辑，不得不佩服他得记忆力，是不是项目经理的记忆力都很好？Michael说：“首先，这些关键的业务逻辑是我设置的，我当然记得比较牢，其次，我能记住的，实际上是关键的业务逻辑，经常遇到，那些特殊的设置，我也是需要阅读代码才知道。”我觉得，跟普通的开发工程师不同，项目经理更擅长处理业务上的问题。身价一万和身价十万的差距，没有想象中那么大，通过努力，日积月累，我也能做项目经理。阿Q一下，梦想还是要有的，万一实现了。</p>\n<h3>关于加薪</h3>\n<p>这是一个非常具有挑战性的问题，除非你在项目组中是不可替代的，否则，你就只能拿着offer，或者跳槽来提升身价，但是，那些项目经理是如何从普通的开发工程师，一步步被提拔上去的呢？运营经理范老板给出一份答案：创造额外的价值，注意，是额外的价值，而不仅仅是本职工作。在公司的动员大会上，有一句很流行的话：要想成为项目经理，必须先干项目经理的活。当然这些话都出自高层之口，尽管，事实上，大多数Leader都是空降的，仍然会有人心灵淹死在鸡汤中。很多开发工程师，包括我，天真地认为，只要做好本职工作，提升技术实力，就能获得公司的认可和嘉奖，获得升职和加薪的机会，就像运营经理说的那样，“这是技术人员的一条路线，稳定而平缓，但是，如果想快速提升，走一条陡峭的上升路线，必须创造额外的价值，当你为公司创造额外价值的时候，公司也会给你提供更好的发展空间。”其实，道理都是相通的，打铁还需自身硬，公司不会给你机会试炼，而会给你空间发挥，前提是你必须比身边的人优秀，才有能力抓住机会。</p>\n<p>这一个个小故事，都是真实的，给我很多启发，在人生的道路上，能够聆听到成功者的教诲，是最难能可贵的，谢谢！</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111535\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111535votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111535\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/1ded311d6e5e90e971d375817a4f5efb8e7096f1.jpg"}
{"url_object_id": "42369d324412b391499279a170e4ca36", "url": "http://blog.jobbole.com/111480/", "title": "一步步实现 Redis 搜索引擎", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/08/redis-logo.png"], "create_date": "2017-06-19", "praise_nums": 1, "fav_nums": 4, "comment_nums": 1, "tags": "IT技术,Redis", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md\">jasonGeng88</a>   </div><div>\n<h2>场景</h2>\n</div>\n<p>大家如果是做后端开发的，想必都实现过列表查询的接口，当然有的查询条件很简单，一条 SQL 就搞定了，但有的查询条件极其复杂，再加上库表中设计的各种不合理，导致查询接口特别难写，然后加班什么的就不用说了（<em>不知各位有没有这种感受呢~</em>）。</p>\n<p>下面以一个例子开始，这是某购物网站的搜索条件，如果让你实现这样的一个搜索接口，你会如何实现？（<em>当然你说借助搜索引擎，像 Elasticsearch 之类的，你完全可以实现。但我这里想说的是，如果要你自己实现呢？</em>）</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_01.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_01.png\" alt=\"\"></a></p>\n<p>从上图中可以看出，搜索总共分为6大类，每大类中又分了各个子类。这中间，各大类条件之间是取的交集，各子类中有单选、多选、以及自定义的情况，最终输出符合条件的结果集。</p>\n<p>好了，既然需求很明确了，我们就开始来实现。</p>\n<h2><a id=\"user-content-实现1\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B01\"></a>实现1</h2>\n<p>率先登场是小A同学，他是写 SQL 方面的“专家”。小A信心满满的说：“不就是一个查询接口吗？看着条件很多，但凭着我丰富的 SQL 经验，这点还是难不倒我的。”</p>\n<p>于是乎就写出了下面这段代码（这里以 MYSQL 为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fb44ed2ba8137860606\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect ... from table_1\r\nleft join table_2\r\nleft join table_3\r\nleft join (select ... from table_x where ...) tmp_1\r\n...\r\nwhere ...\r\norder by ...\r\nlimit m,n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2ba8137860606-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2ba8137860606-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2ba8137860606-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2ba8137860606-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2ba8137860606-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2ba8137860606-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2ba8137860606-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2ba8137860606-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fb44ed2ba8137860606-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table_1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2ba8137860606-2\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join </span><span class=\"crayon-e\">table_2</span></div><div class=\"crayon-line\" id=\"crayon-594fb44ed2ba8137860606-3\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join </span><span class=\"crayon-e\">table_3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2ba8137860606-4\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table_x </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">_</span>1</div><div class=\"crayon-line\" id=\"crayon-594fb44ed2ba8137860606-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2ba8137860606-6\"><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594fb44ed2ba8137860606-7\"><span class=\"crayon-e\">order </span><span class=\"crayon-i\">by</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2ba8137860606-8\"><span class=\"crayon-i\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>代码在测试环境跑了一把，结果好像都匹配上了，于是准备上预发。这一上预发，问题就开始暴露出来。预发为了尽可能的逼真线上环境，所以数据量自然而然要比测试大的多。所以这么一个复杂的 SQL，它的执行效率可想而知。测试同学果断把小A的代码给打了回来。</p>\n<h2><a id=\"user-content-实现2\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B02\"></a>实现2</h2>\n<p>总结了小A失败的教训，小B开始对SQL进行了优化，先是通过了<code>explain</code>关键字进行SQL性能分析，对该加索引的地方都加上了索引。同时将一条复杂SQL拆分成了多条SQL，计算结果在程序内存中进行计算。</p>\n<p>伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fb44ed2bb3692613591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$result_1 = query('select ... from table_1 where ...');\r\n$result_2 = query('select ... from table_2 where ...');\r\n$result_3 = query('select ... from table_3 where ...');\r\n...\r\n\r\n$result = array_intersect($result_1, $result_2, $result_3, ...);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2bb3692613591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2bb3692613591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2bb3692613591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2bb3692613591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fb44ed2bb3692613591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fb44ed2bb3692613591-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fb44ed2bb3692613591-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'select ... from table_1 where ...'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2bb3692613591-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'select ... from table_2 where ...'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594fb44ed2bb3692613591-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'select ... from table_3 where ...'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2bb3692613591-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594fb44ed2bb3692613591-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fb44ed2bb3692613591-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_intersect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这种方案从性能上明显比第一种要好很多，可是在功能验收的时候，产品经理还是觉得查询速度不够快。小B自己也知道，每次查询都会向数据库查询多次，而且有些历史原因，部分条件是做不到单表查询的，所以查询等待的时间是避免不了的。</p>\n<h2><a id=\"user-content-实现3\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B03\"></a>实现3</h2>\n<p>小C从上面的方案中看到了优化的空间。他发现小B在思路上是没问题的，将复杂条件拆分，计算各个子维度的结果集，最后将所有的子结果集进行一个汇总合并，得到最终想要的结果。</p>\n<p>于是他突发奇想，能否事先将各个子维度的结果集给缓存起来，这要查询的时候直接去取想要的子集，而不用每次去查库计算。</p>\n<p>这里小C采用 <a href=\"https://redis.io/\">Redis</a> 来存储缓存数据，用它的主要原因是，它提供了多种数据结构，并且在 Redis 中进行集合的交并集操作是一件很容易的事情。</p>\n<p>具体方案，如图所示：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_02.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_02.png\" alt=\"\"></a></p>\n<p>这里每个条件都事先将计算好的结果集ID存入对应的key中，选用的数据结构是集合（Set）。查询操作包括：</p>\n<ul>\n<li>子类单选：直接根据条件 key，获取对应结果集；</li>\n<li>子类多选：根据多个条件 Key，进行并集操作，获取对应结果集；</li>\n<li>最终结果：将获取的所有子类结果集进行交集操作，得到最终结果；</li>\n</ul>\n<p><em><strong>这其实就是所谓的<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\">反向索引</a>。</strong></em></p>\n<p>这里会发现，漏了一个价格的条件。从需求中可知，价格条件是个区间，并且是无穷举的。所以上述的这种穷举条件的 Key-Value 方式是做不到的。这里我们采用 Redis 的另一种数据结构进行实现，有序集合（Sorted Set）：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_03.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_03.png\" alt=\"\"></a></p>\n<p>将所有商品加入 Key 为价格的有序集合中，值为商品ID，每个值对应的分数为商品价格的数值。这样在 Redis 的有序集合中就可以通过<code>ZRANGEBYSCORE</code>命令，根据分数（价格）区间，获取相应结果集。</p>\n<p>至此，方案三的优化已全部结束，将数据的查询与计算通过缓存的手段，进行了分离。在每次查找时，只需要简单的查找 Redis 几次就能得出结果。查询速度上符合了验收的要求。</p>\n<h2><a id=\"user-content-扩展\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%89%A9%E5%B1%95\"></a>扩展</h2>\n<h3><a id=\"user-content-分页\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%88%86%E9%A1%B5\"></a>分页</h3>\n<p>这里你或许发现了一个严重的功能缺陷，列表查询怎么能没有分页。是的，我们马上来看 Redis 是如何实现分页的。</p>\n<p>分页主要涉及排序，这里简单起见，就以创建时间为例。</p>\n<p>如图所示：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_04.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_04.png\" alt=\"\"></a></p>\n<p>图中蓝色部分是以创建时间为分值的商品有序集合，蓝色下方的结果集即为条件计算而得的结果，通过<code>ZINTERSTORE</code>命令，赋结果集权重为0，商品时间结果为1，取交集而得的结果集赋予创建时间分值的新有序集合。对新结果集的操作即能得到分页所需的各个数据：</p>\n<ul>\n<li>页面总数为：<code>ZCOUNT</code>命令</li>\n<li>当前页内容：<code>ZRANGE</code>命令</li>\n<li>若以倒序排列：<code>ZREVRANGE</code>命令</li>\n</ul>\n<h3><a id=\"user-content-数据更新\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0\"></a>数据更新</h3>\n<p>关于索引数据更新的问题，有两种方式来进行。一种是通过商品数据的修改，来即时触发更新操作，一种是通过定时脚本来进行批量更新。这里要注意的是，关于索引内容的更新，如果暴力的删除 Key，再重新设置 Key。因为 Redis 中两个操作不会是原子性进行的，所以中间可能存在空白间隙，建议采用仅移除集合中失效元素，添加新元素的方式进行。</p>\n<h3><a id=\"user-content-性能优化\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96\"></a>性能优化</h3>\n<p>Redis 是内存级操作，所以单次的查询会很快。但是如果我们的实现中会进行多次的 Redis 操作，Redis 的多次连接时间可能是不必要时间消耗。通过使用<code>MULTI</code>命令，开启一个事务，将 Redis 的多次操作放在一个事务中，最后通过<code>EXEC</code>来进行原子性执行（<em><strong>注意：这里所谓的事务，只是将多个操作在一次连接中执行，如果执行过程中遇到失败，是不会回滚的</strong></em>）。</p>\n<h2><a id=\"user-content-总结\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%80%BB%E7%BB%93\"></a>总结</h2>\n<p>这里只是一个采用 Redis 优化查询搜索的一个简单 Demo，和现有的开源搜索引擎相比，它更轻量，学习成本也相应低些。其次，它的一些思想与开源搜索引擎是类似的，如果再加上词语解析，也可以实现类似全文检索的功能。</p>\n<p>最后，未完，待续。。。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111480\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111480votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111480\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0a03ec3e1ce1b668b8db0234731fac4915b1064d.jpg"}
{"url_object_id": "28c734bfc805d9104aada552c0c94048", "url": "http://blog.jobbole.com/111518/", "title": "让程序员跨界做设计，脑洞开的万万想不到", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/7a91ae8776d0953ac776284a7d92e861.jpg"], "create_date": "2017-06-19", "praise_nums": 3, "fav_nums": 0, "comment_nums": 5, "tags": "趣文小说,趣文", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/85952/th-worst-volume-control-design-contest\">开源中国社区/王练</a>   </div><p>如果程序员来做设计，世界会变成什么样子？</p>\n<p>著名社交新闻网站 Reddit 最近举办了一个“最糟糕音量键设计大赛”，起因是一个程序员在 Reddit 晒出了自己设计的一款“不同寻常”的音量控制键，并号召大家加入到设计当中来。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgqlqodsdlg20d407s40w.gif\" width=\"472\" height=\"280\"></p>\n<p>程序员们分别按照自己的想法，重新设计了电脑的音量大小按键，比如这样的：</p>\n<blockquote><p>我也不知道音量大小是多少，全都是凭运气来调整的，想要改音量的时候就 roll 一下</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqoib21g20dy06z76y.gif\" width=\"502\" height=\"251\"></p>\n<blockquote><p>快把音量调到50！等等，等等，我再晃一下，刚刚晃过了…</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgqlqpgt5fg20ir06wqv5.gif\" width=\"675\" height=\"248\"></p>\n<p>愤怒的小鸟？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqpwtikg20dw06y41h.gif\" width=\"500\" height=\"250\"></p>\n<p>单身几十年的手速终于排上用场了</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgqlqqzjgeg20fm0dg7wh.gif\" width=\"562\" height=\"484\"></p>\n<p>学渣的末日</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqra6u8g20dm02yglm.gif\" width=\"490\" height=\"106\"></p>\n<p>论“鼠标手”是怎么炼成的</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgqlqrtsxyg20ie0aemzf.gif\" width=\"662\" height=\"374\"></p>\n<p>给我一天时间，我能画个蒙娜丽莎出来</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqs8ecsg20go0ctdqu.gif\" width=\"600\" height=\"461\"></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111518\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111518votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111518\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e4ef10899dd499cd91f9102bff717ea3d2311bfc.jpg"}
{"url_object_id": "a374e125ab3d41e57b4634a2be532439", "url": "http://blog.jobbole.com/111506/", "title": "给非英语母语的人从事开源项目的若干建议", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/b94146f42c8e0ca2b0f04ed89b59053c.jpg"], "create_date": "2017-06-19", "praise_nums": 1, "fav_nums": 4, "comment_nums": 0, "tags": "IT技术,开源,英语", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/1/non-native-speakers-take-open-source-communities\">opensource.com</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8619-1.html\">Linux中国/zhousiyu325</a>   </div><p>大多数的开源项目的主要语言都是英语，但是开源项目的用户和贡献者却遍布全球。非英语母语的人在参与这个生态系统时会面临许多沟通和文化上的挑战。</p>\n<p>在这篇文章中，作为不以英语为母语的 OpenStack 的贡献者的我们将会分享一些所面临挑战——如何去克服它们，还有一些好的方案，它们能够减轻不以英语为母语且刚开始从事的人的焦虑。我们的总部在日本、巴西和中国，每天都会与世界各地的大型 OpenStack 社区合作。</p>\n<p>OpenStack 的官方语言是英语，这意味着我们是作为非英语为母语的人士来进行交流。</p>\n<h3 id=\"toc_1\">挑战</h3>\n<p>非英语为母语的人士在开源社区工作时会面临具体沟通挑战：它们与有限的语言技能和文化差异有关。</p>\n<h4 id=\"toc_2\">语言技能</h4>\n<p>让我们来关注在阅读、写作、听力和口语背后的具体语言技能。</p>\n<p><strong>阅读</strong>：这是最简单也是最重要的技能。最简单是因为：如果你不明白写了什么，你有机会再次阅读它，或者需要的话可以多次阅读。如果你遇到了一个不常见的短语、表达式或者缩写，你可以使用一个词典或者翻译器。在另一方面，它是最重要的技能是因为：对大多数开源项目而言，主要的交流方式都是邮件列表和 IRC。</p>\n<p><strong>写作</strong>：英语语法是一个问题，尤其是对句子结构不同的语言而言。这可能会在用电子邮件进行通信和通过 IRC 频道进行通信时产生问题。对一些人来说，写出又长又漂亮的句子比较困难，而普遍依赖于简单句子，这是因为这些易于书写和理解。</p>\n<p><strong>听力</strong>：这对非英语为母语的人来说比阅读和写作更加困难。通常，英语为母语的人之间的对话在非常快的，这就使得那些仍然处于刚从事阶段的人很难理解他们的讨论，同时也限制了他们参与到讨论当中。此外，试图理解一个遍布全球的社区的各种口音也增加了复杂性。有意思的是，美国人的发音往往比其他的容易理解。</p>\n<p><strong>口语</strong>：口语比听力更加的困难，因为参与者的词汇量可能会比较有限。而且，英语的音素和语法通常与那些母语不是英语的人的母语相差很大，这就使得互动更加的难以理解。</p>\n<h4 id=\"toc_3\">文化差异</h4>\n<p>在开源社区与其他人交流时，每种文化都有它自己不同的规范。例如，日本人通常不会明确的说好的或者不，他们认为这是尊重别人的一种方式，可以避免彼此间的争论。这通常与其他的文化大不一样，可能会对所表达的内容造成误解。</p>\n<p>在中国文化中，人们倾向于只是说好的，而不是说不，或者试图商讨。在一个像 OpenStack 这样的分布于全球的社区里，这通常会导致在表达意见时缺乏自信。另外，中国人喜欢首先列出事实，然后在后面给出结论，而这会对来自其他文化中的人造成困惑，因为这不是他们所期望的。</p>\n<p>例如，巴西人可能会认为讨论是以类似的方式进行的；然而，其他文化的反应会很直接和简短，这听起来可能会有点粗鲁。</p>\n<h3 id=\"toc_4\">克服障碍</h3>\n<p>语言技能方面的挑战要比文化差异方面的挑战容易克服。文化差异需要被受到尊重，然而英语技能却总是可以被改善的。</p>\n<p>为了刷新你的语言技能，你应该尽可能多地接触该语言。不要担心你的局限，只管尽自己所能，你终将会得到改善。</p>\n<p>尽可能多的阅读，因为这有助于你积累词汇。通过日常的聊天和邮件列表进行交流也很有帮助。一些工具，如实时字典和翻译器，对这些平台非常有用。</p>\n<p>与别人或者你自己交谈可以帮助你更自如地频繁地说话。进行一对一的对话来表达你的想法比在更大的群体中讨论更容易。</p>\n<h3 id=\"toc_5\">新手的融入</h3>\n<p>来自新手和母语者的一些举措可能会对学习过程产生积极的影响。</p>\n<h4 id=\"toc_6\">新手</h4>\n<p>说出和写下你的意见，并且提出你的问题；参与其中总是一个练习你的英语的很好的机会。不要害怕。</p>\n<p>对于会议，确保你提前准备过，这样你将会对会议主题比较熟悉，而且会对自己要表达的意见更加的自信。</p>\n<p>与英语为母语的人结交朋友，多和他们讨论来提高你的英语技能。</p>\n<p>用英语写博客和技术文章也是不错的主意。</p>\n<h4 id=\"toc_7\">给英语为母语的人士的建议</h4>\n<p>请说话慢一点儿，同时使用一些简单的单词和句子。如果你发现了非英语为母语的人使用英语中的一些错误请不要嘲笑他们，尝试鼓励新来的人表达自己的意见，让他们非常舒适地表达意见。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111506\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111506votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111506\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/dd36e1ac9db2af41888b4a17b76a865bb91d4510.jpg"}
{"url_object_id": "9c36e71c307939b4d10f479fb6f902f3", "url": "http://blog.jobbole.com/111514/", "title": "Linux 中高效编写 Bash 脚本的 10 个技巧", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201706/17/192227q13jnz3eeqq5pb53.png"], "create_date": "2017-06-19", "praise_nums": 1, "fav_nums": 6, "comment_nums": 0, "tags": "IT技术,Bash,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.tecmint.com/useful-tips-for-writing-bash-scripts-in-linux/\">Aaron Kili</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8618-1.html\">Linux中国/ch-cn</a>   </div><p>Shell 脚本编程 是你在 Linux 下学习或练习编程的最简单的方式。尤其对 系统管理员要处理着自动化任务，且要开发新的简单的实用程序或工具等（这里只是仅举几例）更是必备技能。</p>\n<p>本文中，我们将分享 10 个写出高效可靠的 bash 脚本的实用技巧，它们包括：</p>\n<h3 id=\"toc_1\">1、 脚本中多写注释</h3>\n<p>这是不仅可应用于 shell 脚本程序中，也可用在其他所有类型的编程中的一种推荐做法。在脚本中作注释能帮你或别人翻阅你的脚本时了解脚本的不同部分所做的工作。</p>\n<p>对于刚入门的人来说，注释用 <code>#</code> 号来定义。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33cf2887339097\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# TecMint 是浏览各类 Linux 文章的最佳站点</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33cf2887339097-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33cf2887339097-1\"><span class=\"crayon-p\"># TecMint 是浏览各类 Linux 文章的最佳站点</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">2、 当运行失败时使脚本退出</h3>\n<p>有时即使某些命令运行失败，bash 可能继续去执行脚本，这样就影响到脚本的其余部分（会最终导致逻辑错误）。用下面的行的方式在遇到命令失败时来退出脚本执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33cfc854205968\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 如果命令运行失败让脚本退出执行\r\nset -o errexit \r\n# 或\r\nset -e</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33cfc854205968-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33cfc854205968-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33cfc854205968-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33cfc854205968-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33cfc854205968-1\"><span class=\"crayon-p\"># 如果命令运行失败让脚本退出执行</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33cfc854205968-2\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errexit</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33cfc854205968-3\"><span class=\"crayon-p\"># 或</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33cfc854205968-4\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">3、 当 Bash 用未声明变量时使脚本退出</h3>\n<p>Bash 也可能会使用能导致起逻辑错误的未声明的变量。因此用下面行的方式去通知 bash 当它尝试去用一个未声明变量时就退出脚本执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d00441213380\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 若有用未设置的变量即让脚本退出执行\r\nset -o nounset\r\n# 或\r\nset -u</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d00441213380-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d00441213380-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d00441213380-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d00441213380-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d00441213380-1\"><span class=\"crayon-p\"># 若有用未设置的变量即让脚本退出执行</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d00441213380-2\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nounset</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d00441213380-3\"><span class=\"crayon-p\"># 或</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d00441213380-4\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">4、 使用双引号来引用变量</h3>\n<p>当引用时（使用一个变量的值）用双引号有助于防止由于空格导致单词分割开和由于识别和扩展了通配符而导致的不必要匹配。</p>\n<p>看看下面的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d04033769531\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n# 若命令失败让脚本退出\r\nset -o errexit \r\n# 若未设置的变量被使用让脚本退出\r\nset -o nounset\r\necho \"Names without double quotes\" \r\necho\r\nnames=\"Tecmint FOSSMint Linusay\"\r\nfor name in $names; do\r\n  echo \"$name\"\r\ndone\r\necho\r\necho \"Names with double quotes\" \r\necho\r\nfor name in \"$names\"; do\r\n  echo \"$name\"\r\ndone\r\nexit 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d04033769531-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d04033769531-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-2\"><span class=\"crayon-p\"># 若命令失败让脚本退出</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-3\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errexit</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-4\"><span class=\"crayon-p\"># 若未设置的变量被使用让脚本退出</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-5\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nounset</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-6\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Names without double quotes\"</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-7\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-8\"><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Tecmint FOSSMint Linusay\"</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-9\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$name\"</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-11\"><span class=\"crayon-e\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-12\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-13\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Names with double quotes\"</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-14\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-15\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$names\"</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$name\"</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d04033769531-17\"><span class=\"crayon-e\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d04033769531-18\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>保存文件并退出，接着如下运行一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d08953312486\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./names.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d08953312486-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d08953312486-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p class=\"article_img\"><img class=\"aligncenter\" title=\"在脚本中用双引号\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201706/17/192227q13jnz3eeqq5pb53.png\" alt=\"在脚本中用双引号\"></p>\n<p class=\"article_img_desc\" style=\"text-align: center;\"><em>在脚本中用双引号</em></p>\n<h3 id=\"toc_5\">5、 在脚本中使用函数</h3>\n<p>除了非常小的脚本（只有几行代码），总是记得用函数来使代码模块化且使得脚本更可读和可重用。</p>\n<p>写函数的语法如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d0c555441199\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction check_root(){\r\n  command1; \r\n  command2;\r\n}\r\n# 或\r\ncheck_root(){\r\n  command1; \r\n  command2;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0c555441199-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d0c555441199-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0c555441199-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d0c555441199-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0c555441199-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d0c555441199-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0c555441199-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d0c555441199-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0c555441199-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d0c555441199-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d0c555441199-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">command1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d0c555441199-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">command2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d0c555441199-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d0c555441199-5\"><span class=\"crayon-p\"># 或</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d0c555441199-6\"><span class=\"crayon-e\">check_root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d0c555441199-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">command1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d0c555441199-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">command2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-594ee82b33d0c555441199-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>写成单行代码时，每个命令后要用终止符号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d0f301302680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncheck_root(){ command1; command2; }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d0f301302680-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d0f301302680-1\"><span class=\"crayon-e\">check_root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">6、 字符串比较时用 <code>=</code> 而不是 <code>==</code></h3>\n<p>注意 <code>==</code> 是 <code>=</code> 的同义词，因此仅用个单 <code>=</code> 来做字符串比较，例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d13176243892\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvalue1=”tecmint.com”\r\nvalue2=”fossmint.com”\r\nif [ \"$value1\" = \"$value2\" ]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d13176243892-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d13176243892-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d13176243892-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d13176243892-1\"><span class=\"crayon-v\">value1</span><span class=\"crayon-o\">=</span>”<span class=\"crayon-v\">tecmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d13176243892-2\"><span class=\"crayon-v\">value2</span><span class=\"crayon-o\">=</span>”<span class=\"crayon-v\">fossmint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span>”</div><div class=\"crayon-line\" id=\"crayon-594ee82b33d13176243892-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$value1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$value2\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"toc_7\">7、 用 <code>$(command)</code> 而不是老旧的 <code><code>command</code></code> 来做代换</h3>\n<p><a class=\"ext\" href=\"https://www.tecmint.com/assign-linux-command-output-to-variable/\" target=\"_blank\" rel=\"external nofollow\">命令代换</a> 是用这个命令的输出结果取代命令本身。用 <code>$(command)</code> 而不是引号 <code><code>command</code></code> 来做命令代换。</p>\n<p>这种做法也是 <a class=\"ext\" href=\"https://www.tecmint.com/shellcheck-shell-script-code-analyzer-for-linux/\" target=\"_blank\" rel=\"external nofollow\">shellcheck tool</a> （可针对 shell 脚本显示警告和建议）所建议的。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d17426507977\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=`echo “$UID”`\r\nuser=$(echo “$UID”)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d17426507977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d17426507977-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d17426507977-1\"><span class=\"crayon-v\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">$</span><span class=\"crayon-i\">UID</span>”<span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d17426507977-2\"><span class=\"crayon-v\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">$</span><span class=\"crayon-i\">UID</span>”<span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">8、 用 <code>readonly</code> 来声明静态变量</h3>\n<p>静态变量不会改变；它的值一旦在脚本中定义后不能被修改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d1a920336523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nreadonly passwd_file=”/etc/passwd”\r\nreadonly group_file=”/etc/group”</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d1a920336523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d1a920336523-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d1a920336523-1\"><span class=\"crayon-e\">readonly </span><span class=\"crayon-v\">passwd_file</span><span class=\"crayon-o\">=</span>”<span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">passwd</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d1a920336523-2\"><span class=\"crayon-e\">readonly </span><span class=\"crayon-v\">group_file</span><span class=\"crayon-o\">=</span>”<span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">group</span>”</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"toc_9\">9、 环境变量用大写字母命名，而自定义变量用小写</h3>\n<p>所有的 bash 环境变量用大写字母去命名，因此用小写字母来命名你的自定义变量以避免变量名冲突：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee82b33d1e468527235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 定义自定义变量用小写，而环境变量用大写\r\nnikto_file=”$HOME/Downloads/nikto-master/program/nikto.pl”\r\nperl “$nikto_file” -h  “$1”</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d1e468527235-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee82b33d1e468527235-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee82b33d1e468527235-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee82b33d1e468527235-1\"><span class=\"crayon-p\"># 定义自定义变量用小写，而环境变量用大写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee82b33d1e468527235-2\"><span class=\"crayon-v\">nikto_file</span><span class=\"crayon-o\">=</span>”<span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nikto</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">program</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nikto</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pl</span>”</div><div class=\"crayon-line\" id=\"crayon-594ee82b33d1e468527235-3\"><span class=\"crayon-i\">perl</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nikto</span><span class=\"crayon-sy\">_</span>file”<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\">  </span>“<span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span>”</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_10\">10、 总是对长脚本进行调试</h3>\n<p>如果你在写有数千行代码的 bash 脚本，排错可能变成噩梦。为了在脚本执行前易于修正一些错误，要进行一些调试。通过阅读下面给出的指南来掌握此技巧：</p>\n<ol>\n<li><a href=\"https://linux.cn/article-8028-1.html\">如何在 Linux 中启用 Shell 脚本调试模式</a></li>\n<li><a href=\"https://linux.cn/article-8045-1.html\">如何在 Shell 脚本中执行语法检查调试模式</a></li>\n<li><a href=\"https://linux.cn/article-8120-1.html\">如何在 Shell 脚本中跟踪调试命令的执行</a></li>\n</ol>\n<p>本文到这就结束了，你是否有一些其他更好的 bash 脚本编程经验想要分享？若是的话，在下面评论框分享出来吧。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111514\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111514votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111514\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/aba8a39617598b9aa209e097640c72a63135a000.jpg"}
{"url_object_id": "34b73297603f02703efe586131a737a7", "url": "http://blog.jobbole.com/111529/", "title": "数据可视化产生生产力", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-data-visualization.png"], "create_date": "2017-06-22", "praise_nums": 1, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,可视化,数据", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>数据可视化就是借助于图形化手段，清晰有效地进行信息传达与沟通。许多人会着眼于“可视化”，认为数据可视化就是将一系列看上去很炫、很复杂的图表展示在页面上。其实不然，虽然可视化脱离不了各种图表类型，但并不意味着要以增加用户理解难度为代价去实现复杂的功能；或者为了看上去绚丽多彩而失去其最根本的意义：<strong>传达与沟通</strong>。</p>\n<h3>数据可视化产生生产力</h3>\n<p>数据可视化之所以会大受欢迎，其原因不仅在于能带给用户良好的的视觉效果，更因为它能够产生生产力，形成数据驱动闭环，主要包含以下几个阶段：</p>\n<ul>\n<li>技术人员运用技术手段将需求分析、基础数据整合、数据计算等操作结合到一起进行数据可视化，实时监控数据的变化情况。</li>\n<li>用户能够使用这些可视化图表，进行分析、对比等操作，定位业务问题。之后再结合业务变动提出新的需求。</li>\n<li>技术人员将用户访问数据与新的业务需求结合，重新进行数据整合、分析、计算，循环往复下去。</li>\n</ul>\n<p>如下图所示：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-data-visualization.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-data-visualization.png\" alt=\"\" width=\"940\" height=\"712\"></a></p>\n<p>图1. 数据驱动闭环</p>\n<p>实现用数据可视化的方式不断驱动业务的提升，产生生产力、创造收益。</p>\n<h3>如何使数据可视化产生生产力？</h3>\n<p>满足这一目的的前提在于－－“创造出都能读懂、易于操作、能够提前预警的图表”，关键因素有以下几点：</p>\n<h4>1、选择合适的图表类型</h4>\n<p>选择图表的时候，许多人认为基本图表太过简单，不够高端大气，因而更倾向选择复杂的图表类型。实际上越简单的图表越容易理解，对用户的友好程度越高。只要能够高效清楚地传达业务含义，就应该优先选择。</p>\n<p>例如，饼图比较适合反映某个部分占整体的比重，而折线图能更好的反应数据变化的趋势；分组柱状图和堆叠柱状图都能够显示数据集的分组情况，但是彼此间的差异却让它们在特定情况下显得更加强大。在比较同一分类不同组的数据或者同组不同分类的数据时，分组柱状图更能体现优势；然而在比较每个分组之间的总量时，堆叠柱状图显然更加合适。下面分别使用这两种图表在展示不同地区、不同年龄段人口数量分布时显示的效果：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-Grouped-Bar-Chart.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-Grouped-Bar-Chart.png\" alt=\"\" width=\"940\" height=\"483\"></a></p>\n<p>图2. 分组柱状图（Grouped Bar Chart)</p>\n<p>图片来自：<a href=\"https://bl.ocks.org/mbostock/3887051\">https://bl.ocks.org/mbostock/3887051</a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-Stacked-Bar-Chart.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-Stacked-Bar-Chart.png\" alt=\"\" width=\"940\" height=\"485\"></a></p>\n<p>图3. 堆叠柱状图（Stacked Bar Chart)</p>\n<p>图片来自：<a href=\"https://bl.ocks.org/mbostock/3886208\">https://bl.ocks.org/mbostock/3886208</a></p>\n<p>要想让受众读懂图表所表达的业务含义，就要选择合适的图表类型。在选择时，首先需要清楚的知道不同图表的优劣以及它们适合的应用场景；除此之外尽量选择一些简单的、易于理解的图表类型。但这不意味着不能选择复杂的图表类型，有的图表虽然看起来比较复杂，但是却能很好的反映一些业务场景，再辅助一些文字说明等其他手段，降低用户的使用难度，也未尝不可。</p>\n<p>选择图表时，以业务为基础。只要能够清晰地表达业务数据背后含义，不让用户产生歧义，都值得考虑。</p>\n<h4>2、易用的、多维度的交互分析</h4>\n<p>随着数据类型的多样化，数据间的关联关系也越来越复杂。仅仅展示单维度的数据，是无法让用户轻易发现数据之间的联系、挖掘出更多业务价值的。同样，若是交互方式过于复杂，也只会增加用户的使用难度而已，不利于业务长期发展。因此易操作的、多维度的交互分析对于数据可视化来说必不可少。多维度的分析方式有很多种，以下是常见的几种：</p>\n<ul>\n<li>钻取： 将汇总数据拆分到更细节的数据；在维的不同层次间的变化，从上层降到下一层。</li>\n<li>上卷： 钻取的逆操作，即从细粒度数据向高层的聚合。</li>\n<li>切片： 选择维中特定的值进行分析。</li>\n<li>切块：选择维中特定区间的数据或者某批特定值进行分析。</li>\n<li>筛选： 通过不同的维度或者类别过滤出用户想要的数据。</li>\n<li>联动：若干个相关联的图表，一个图表发生变化，其他的也会跟着发生变化。</li>\n</ul>\n<p>下面是一些图表的样例：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-tree-graph.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-tree-graph.png\" alt=\"\" width=\"940\" height=\"435\"></a></p>\n<p>图4. 树图（不同数据层次，可以进行数据的钻取、上卷的等等操作)</p>\n<p>（图片来自：<a href=\"https://bl.ocks.org/mbostock/1093025\">https://bl.ocks.org/mbostock/1093025</a>）</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-Linkage.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-Linkage.png\" alt=\"\" width=\"940\" height=\"756\"></a></p>\n<p>图5. 同步联动图（图中显示的是在某一到达距离时的速度、高度以及心率）</p>\n<p>（图片来自：<a href=\"https://www.highcharts.com/demo/synchronized-charts\">http://t.cn/RoUdHCX</a>）<code></code></p>\n<p>有选择的将不同交互方式进行结合，能够发挥出更强大的作用。再辅助高效灵活的追加合并、拖曳式操作进行数据的挖掘分析，就可以帮助用户快速定位问题，释放劳动力，提升效率，不再需要程序员花费大量精力在日志文件中寻找问题的原因。同时通过各类数据的横向、纵向对比，业务人员能够从中挖掘出更多的业务需求，创造更大的商业价值。</p>\n<h4>3、预警功能</h4>\n<p>数据可视化除了能够帮助定位已有的问题，另外一个更大的价值是能够及时预警。</p>\n<p>一旦数据出现异常或者是提前预定义的一些条件被满足时，警报就会被触发，提前预警。通过设置报警方式、报警策略、报警等级等等，根据紧急程度用不同的方式通知特定的人群。这样在问题发生之前，就能预先做好防护措施；或者在问题发生的时候，能够及时通知负责人，尽快解决问题。这样不仅能缩短反馈周期（发现问题－找到责任人－定位问题－解决问题），也能降低对用户的影响，提升用户对产品的信任度，很好的降低业务损失。</p>\n<h3>总结</h3>\n<p>除了上述提到的一些关键因素，好的数据可视化平台、产品也有许多其他的共性： 友好的用户体验设计，页面的交互逻辑要符合真实的用户路径； 可以多终端使用 ，尤其要能契合移动端体验的可视化设计实现，使得人与数据零距离，随时随地可用；强大的数据整合、计算、渲染能力，就算图表表达的业务含义再精确，性能的缺失也是致命的。 支持多种数据源整合、多数据类型的扩展等等。 对产品用户使用情况进行监控、分析。了解真实用户人群、用户路径、用户的核心关注点，帮助产品进行改善</p>\n<p>总之，好的数据可视化，就是要以用户为中心。根据目标用户的需求提炼业务需求，以用户的良好体验为目标，绘制出人人都能读懂的图表；以人人都会的交互方式，帮助用户挖掘业务价值，提升工作效率，促进业务持续发展，让数据可视化产生生产力。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111529\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111529votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111529\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 60</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5fd060bc6a901fb82af8477afb63c706d0e06446.jpg"}
{"url_object_id": "ef6c307e280a8e27315c464cf98bb302", "url": "http://blog.jobbole.com/111541/", "title": "不再迷惑，无值和 NULL 值", "front_image_url": ["http://images2015.cnblogs.com/blog/628084/201706/628084-20170620110230601-1550885802.png"], "create_date": "2017-06-21", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,NULL,TSQL,无值", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/ljhdo/p/5128417.html\">Vic Liu</a>   </div><p>在关系型数据库的世界中，无值和NULL值的区别是什么？一直被这个问题困扰着，甚至在写TSQL脚本时，心有戚戚焉，害怕因为自己的一知半解，挖了坑，贻害后来人，于是，本着上下求索，不达通幽不罢休的决心（开个玩笑），遂有此文。</p>\n<p>学习过关系型数据库的伙伴都知道，NULL是指不确定的值，在数据库中绝对是噩梦的存在；而空值，一般对字符串类型而言，指没有任何值的字符串类型，为字符类型的变量设置为空值：set @vs=”，空值跟无值不同。有人可能会问，无值是什么？无值，是指数据表中没有任何数据。无值和不确定值，单从字面意思上来看，两者之间的定义很清楚，一旦深究，这两者之间的关系，有时令人十分迷惑（confused），这是因为，在特定条件下，无值会转换为NULL值。</p>\n<h3>一，举个栗子，理解无值和NULL值的区别</h3>\n<p>比如，创建一个临时表，在不插入任何数据时，该数据表是空的，没有任何值，对其执行select命令，将不会返回任何数据值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97de4286760823\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table #temp\r\n(\r\nid int null\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97de4286760823-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97de4286760823-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97de4286760823-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97de4286760823-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97de4286760823-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97de4286760823-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-594ee4ec97de4286760823-3\"><span class=\"crayon-e\">id </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97de4286760823-4\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>创建一个标量类型的变量，在不初始化时，该变量的值是不确定的，其值是NULL：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97ded836924002\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @vs int</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97ded836924002-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97ded836924002-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">vs </span><span class=\"crayon-t\">int</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>创建一个表类型变量，在不初始化时，该表变量没有任何数据，是无值的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97df1293249435\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @vt as table\r\n(\r\nid int null\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97df1293249435-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97df1293249435-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97df1293249435-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97df1293249435-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97df1293249435-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">vt </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">table</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97df1293249435-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-594ee4ec97df1293249435-3\"><span class=\"crayon-e\">id </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97df1293249435-4\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>总结一下，声明一个标量型变量，如果没有对变量进行初始化，其值是不确定的，是NULL值；对于表变量，临时表和基础表，如果没有插入任何数据，该表没有任何数据，是无值的。</p>\n<h3>二，无值和NULL值的转换</h3>\n<p>在开始本节之前，先为变量赋值，简单的一个select命令就可以完成变量的赋值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97df4015161737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97df4015161737-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97df4015161737-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>有些朋友思维比较活跃，立马会想到：“用select命令可以从表中取值为变量赋值”，对，但是，赋值方法不是我求索的重点，我关注的是从表中取值为变量赋值的结果。</p>\n<p><strong>1，从空表中为变量赋值</strong></p>\n<p>如果数据表是空表，没有任何值，那么数据库引擎不会执行赋值语句，变量保持原有值不变：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97df8709457419\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=id\r\nfrom #temp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97df8709457419-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97df8709457419-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97df8709457419-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97df8709457419-2\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但是，如果采用以下方式，那么数据库引擎会执行赋值语句，由于空表不返回任何值，数据库引擎会把无值转换为不确定值NULL：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97dfb322770190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=(select top 1 id\r\nfrom #temp)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97dfb322770190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97dfb322770190-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97dfb322770190-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">select </span><span class=\"crayon-i\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97dfb322770190-2\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>诧异吗？无值和NULL值的转换，居然从不起眼的变量赋值开始。<strong>注意，当不返回任何值时，数据库引擎不确定返回值，就把无值转换为NULL值。</strong></p>\n<p><strong>2，从空表中计算聚合</strong></p>\n<p>空表是没有任何数据的表，计算聚合会产生怎样的结果？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97dff120765275\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect count(0) as count_all\r\n    ,count(id) as count_id\r\n    ,max(id) as max_id\r\n    ,min(id) as min_id\r\n    ,avg(id) as avg_id\r\n    ,sum(id) as sum_id\r\nfrom #temp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97dff120765275-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97dff120765275-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97dff120765275-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97dff120765275-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97dff120765275-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97dff120765275-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97dff120765275-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97dff120765275-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>all</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97dff120765275-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-594ee4ec97dff120765275-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97dff120765275-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-594ee4ec97dff120765275-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">avg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97dff120765275-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum_id</span></div><div class=\"crayon-line\" id=\"crayon-594ee4ec97dff120765275-7\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>当统计数据行数时，返回的是0；当计算聚合函数（max，min，avg和sum）的聚合值时，由于无值可以聚合，数据库引擎不能确定这些聚合函数的返回值，因此，数据库引擎返回NULL值。</p>\n<p><img class=\"aligncenter\" src=\"http://images2015.cnblogs.com/blog/628084/201706/628084-20170620110230601-1550885802.png\" alt=\"\"></p>\n<h3>三，聚合函数忽略NULL值</h3>\n<p>一般情况下，除了count(0)，count(*)之外，聚合函数都会忽略NULL值，而统计非NULL值，如果读者有疑问，可以查看我的博客《<a id=\"cb_post_title_url\" class=\"postTitle2\" href=\"http://www.cnblogs.com/ljhdo/p/4950586.html\">TSQL 聚合函数忽略NULL值</a>》。如果只知聚合函数忽略NULL值，而不知空表也会产生结果为NULL的聚合值，轻易得出聚合函数不会返回NULL值的定论，那就很尴尬。楼主曾遇到过一次“意外”，在一次调试脚本代码的过程中，我遇到max聚合函数返回NULL值的情况，当时一脸懵逼，直接怀疑自己之前的所学。</p>\n<p>当聚合列值都是NULL值时，由于聚合函数忽略NULL值，因此，当计算聚合函数（max，min，avg和sum）的聚合值时，由于无值可以聚合，数据库引擎不能确定这些聚合函数的返回值，因此，数据库引擎返回NULL值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594ee4ec97e03019055001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninsert into #temp(id)\r\nvalues(null)\r\n\r\nselect count(0) as count_all\r\n    ,count(id) as count_id\r\n    ,max(id) as max_id\r\n    ,min(id) as min_id\r\n    ,avg(id) as avg_id\r\n    ,sum(id) as sum_id\r\nfrom #temp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97e03019055001-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97e03019055001-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97e03019055001-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97e03019055001-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97e03019055001-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97e03019055001-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97e03019055001-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97e03019055001-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594ee4ec97e03019055001-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594ee4ec97e03019055001-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594ee4ec97e03019055001-1\"><span class=\"crayon-e\">insert </span><span class=\"crayon-v\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp(id)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97e03019055001-2\"><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594ee4ec97e03019055001-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97e03019055001-4\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>all</div><div class=\"crayon-line\" id=\"crayon-594ee4ec97e03019055001-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97e03019055001-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-594ee4ec97e03019055001-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97e03019055001-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">avg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-594ee4ec97e03019055001-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594ee4ec97e03019055001-10\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>聚合函数（max,min,sum,avg和count）忽略null值，但不代表聚合函数不返回null值：如果数据表为空表，或聚合列值都是null，那么max,min,sum,avg聚合函数返回null值，而count 聚合函数返回0。聚合函数的共性：<span id=\"mt3\" class=\"sentence SentenceHover\">Null values are ignored。</span></p>\n<p><img class=\"aligncenter\" src=\"http://images2015.cnblogs.com/blog/628084/201706/628084-20170620112538616-1090159798.png\" alt=\"\"></p>\n<p>不再迷惑：<strong>当不返回任何值时，数据库引擎不确定返回值，就把无值转换为NULL值。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111541\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111541votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111541\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d04e5b5dc5af34eab469fb145bba36349f5b9a4f.jpg"}
{"url_object_id": "52f70501a29c2a68a1a8aced393190d5", "url": "http://blog.jobbole.com/111551/", "title": "开发团队到底好不好，这 12 个问题能检验出来吗？", "front_image_url": ["http://ww4.sinaimg.cn/large/7cc829d3gw1f5o84olqc5j20zk0qodjo.jpg"], "create_date": "2017-06-23", "praise_nums": 1, "fav_nums": 3, "comment_nums": 0, "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/alvendarthy\">alvendarthy</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://myers.io/2017/04/04/the-joel-test-for-2017/\">Dale Myers</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：「Joel 测试」是 Joel Spolsky 在 2000 年提出的 12 个问题，用来检验一个团队是否是好的开发团队。17 年过去了，Dale Myers 重新审视了这12个问题，并与时俱进地提出了修改建议。</p>\n<hr>\n<p>就在 2013 年，我参加了一个课程：“软件的架构、执行和管理”。其中主题之一，就是如何评价一个开发团队？这不是一个简单的问题，如果要得到一个完整的答案，最后一定需要一些必要的研究，一篇冗长的报告。还好，Joel Spolsky 提出了12 个非常简单的测试问题，相对无痛地解决这个问题，这些问题被称为“Joel 测试”。该测试不是非常严谨，也无意于此。但是它可以为你提供坚实基础，进一步了解其他细节。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc299105d9310657820\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 是否使用源码控制？\r\n2. 能实现一键编译吗?\r\n3. 是否进行每日编译？\r\n4. 有无 bug 数据库？\r\n5. 在编码前是否解决bug？\r\n6. 是否有实时更新的计划表？\r\n7. 是否有文档？\r\n8. 开发人员有安静的开发环境吗?\r\n9. 是否使用市面上最好的工具？\r\n10. 是否有测试人员？\r\n11. 新员工面试时写代码吗？\r\n12. 是否进行走廊可用性测试？</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105d9310657820-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105d9310657820-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>是否使用源码控制？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>能实现一键编译吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否进行每日编译？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>有无<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>数据库？</div><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>在编码前是否解决<span class=\"crayon-i\">bug</span>？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表？</div><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否有文档？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>开发人员有安静的开发环境吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-10\"><span class=\"crayon-cn\">10.</span><span class=\"crayon-h\"> </span>是否有测试人员？</div><div class=\"crayon-line\" id=\"crayon-594fc299105d9310657820-11\"><span class=\"crayon-cn\">11.</span><span class=\"crayon-h\"> </span>新员工面试时写代码吗？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105d9310657820-12\"><span class=\"crayon-cn\">12.</span><span class=\"crayon-h\"> </span>是否进行走廊可用性测试？</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><strong>Joel 测试的优点在于：仅仅通过很小一组是非题，就可以得到需要的答案</strong>。你无需关注任何例外，或任何附加条件，只需要单纯的关注每个问题的答案是 yes 还是 no，就可以得到需要的结果： 12 分为优，11 分为良， 10 分及以下为差。这个优点并没有被我和我的几个同学忽视。我立刻将这个方法用到评估那些我面试实习的公司，以及后来毕业后第一份工作的公司。大多数雇主从来没有听说过这个测试，这倒不意外。真正令人意外的是，有多少公司没有通过该测试，而我曾认为这些公司非常棒！</p>\n<p><strong>我提问的不准确吗？他们真的理解我的意思吗？再或者我统计 12 个问题的时候算错了？</strong></p>\n<p>在面试时遇到 ”你还有什么想要问我们的吗？“ 这种问题时，Joel 测试是回答这个问题的大杀器，但是基本都没有及格的。当然，有可能刚好我面试的公司都很差劲，但是，尽管我是软件行业的新人，但是我有个感觉，事实绝非如此。我将该测试带入我的一些应用，发现我竟没有在任何地方考虑到这些问题。</p>\n<p><strong>那么我在 Joel 测试中出了什么问题呢？</strong></p>\n<p>每个开发人员都是不同的，他们对好坏都有着自己的标准，而且这个标准还会随着时间变化。Joel 测试试图规避这种偏差，用客观题替代了主观题。相信没有任何开发人员会反对，跟踪 bug 是个好想法，但是其他的问题呢？</p>\n<p>从 2000 年发布开始，Joel 测试已经有 17 个年头了。它比 OS X 的历史还要久。在同一时期，Windows 2000 还是当时技术最高水平，PlayStation 2 刚刚发布， 奔腾 III 处理器还在 1GHz 下嗡嗡地工作。 在计算机世界里，这确实是很久以前的事了。随着处理器计算能力（还有硬件的整体性能）每18个月翻番，我们的开发进程也一同提升了。Joel 测试的问题反映了当时软件开发的时代缩影。时至 2017 年，它们就未必非常恰当了。</p>\n<p>以第一个问题为例：</p>\n<blockquote><p>是否有源码控制？</p></blockquote>\n<p>如今最流行的版本控制系统——Git，在当时还没有出现。好吧，众所周知，Git 直到 2005 年才出现。也不要忘记，前任的版本控制系统之王——Subversion 也是到 2000 年才出现，比 Joel 测试首次发布晚了 2 个月。那时源码控制出现了，但是却不像今天这样普遍。这是不是意味着，今天还讨论源码控制这个问题显得多此一举呢？可能吧！我们应该修改这个问题与时俱进吗？也许吧！</p>\n<p>让我们一起来看看这些问题，然后看看如何与时俱进吧。</p>\n<h3 id=\"do-you-use-source-control\">1. 是否使用源码控制？</h3>\n<p>除了上面提到的，时至今日，这个问题似乎依然有意义。任何团队都需要源码控制，这是毋庸置疑的。如今的争议主要在是否使用集中式版本控制系统。一般的项目使用 Git 或者 Mercurial （举例来说）都可以。大型公司拥有超大型代码仓库，一般采用集中式版本控制系统。这个问题没有绝对答案。真正重要的是，有版本控制！既然这个问题已经是常识，我认为它就没必要继续存在了。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议： 删除</strong></span></p>\n<h3>2. 能实现一键编译吗?</h3>\n<p>Joel 的解释如下：</p>\n<blockquote><p>从最新的代码快照编译出交付版本，一共需要多少步？</p></blockquote>\n<p>其背后的原因，今天依然成立。好了，我认为这是我们对老问题的第一个挑战。我一直认为，编译交付版本，应当 0 步骤完成。持续集成已经广泛存在。使用它是非常明智的。创建一个交付版本的步骤应当这样：程序员们提交代码，当管理人员，或者其他负责人准备 release 时，他只需要点击 ”release“ 按钮即可，然后就成功了。所有开发人员只需要确保他们提交的代码无误，持续集成服务自动会完成其他工作。</p>\n<p>持续集成系统将软件开发产业向前推进了一大步。如果我们能更广泛的使用，充分发挥它的潜力，我们将受益良多。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：所有版本，都由持续集成服务器自动编译吗？</strong></span></p>\n<h3 id=\"do-you-make-daily-builds\">3. 是否进行每日编译？</h3>\n<p>这个问题紧随第 2 个。如果对团队有用的话，每日编译是可行的。我一直认为每日应当是最低限度了。在我眼里更好的实践是，确保主开发分支的每一次提交，都可以正常的完成编译。这算是一种“预览”版本，同时也意味着你能更快、更有效地发现自己的问题，因为一旦发生任何故障，非常容易确认其版本。</p>\n<p>该编译过程应当由持续集成系统自动完成。还有，你不止应当进行每日编译，而且应该使用它们。当然，如果你开发那些与你日常工作无关的软件时（定制或者专业软件），很难做到这一点。比如你在开发一款会计软件，或者火箭控制程序，显然你不可能使用这些产品。然而，我的建议是，每天至少花20分钟看看你的软件，试用一下，确保一切正常。假如你开发的软件每天都能用得到，那就更好了。它的作用与前面提到的 20 分钟试用一样，但在实际操作中，你可以进行远超 20 分钟的测试，使项目暴露在更加真实的场景下。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：是否执行每日编译，并使用这些版本？</strong></span></p>\n<h3>4. 有无 bug 数据库？</h3>\n<p>当然啦，你应该使用某种 bug 数据库。你听说过任何人认为没这个必要吗？如今发生变化的是，bug 跟踪有了更加丰富的特性。它们已经不再单单是一个数据库表的接口，而是拥有丰富功能的规划、管理程序，通常在任务和 bug 之间有显著区别（参考第 5 条）。</p>\n<p>如今，当你提交一个bug时，它有标题、描述、复现步骤、影响平台等等信息，一般都是如此。如今不同的是，管理将贯穿你的 bug 处理，bug 会被分派到若干迭代中，你需要利用看板规划任务，你的敏捷开发组长会就那些有困难的任务与你进行谈话。</p>\n<p>问题跟踪器也不仅仅是记录需要做的事。它包含谁执行了操作，对团队的影响，对产品的影响，以及其他上百个属性。那么，我认为你应该有某种软件来做这些事情，这都不重要，它就是你的某种问题跟踪器。因为各个团队的情况有所差异，这个问题也没有确切的答案。我所做的一点调整，只是为了用文字的一点不同，来反映我们现有的能力。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：你是否使用问题追踪器（issue tracker）？</strong></span></p>\n<h3 id=\"do-you-fix-bugs-before-writing-new-code\">5. 在编码前是否解决bug？</h3>\n<p>Joel 对这一点的重要性给出了非常好的论述，17 年后的今天，它依然成立。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-an-up-to-date-schedule\">6. 是否有实时更新的计划表？</h3>\n<p>作为开发人员，你可能没那么关心计划表。如果你的团队没有在按时完成任务会怎样？不是你的问题吗？把这个问题留给管理人员吧！</p>\n<p>留个管理人员，也许有用，也许没用。如今，我们有各种敏捷开发理论，从开发人员，或者其他任何估时比较靠谱的人那里，得到的项目预估，是进行项目规划的关键要素。这帮助我们安排团队工作、谁来做这些工作，以及何时做这些工作。你可以掩耳盗铃，假装事事与你无关，但是最终，每一个人都需要对整个团队有一份责任。</p>\n<p>这一条今天还有效吗？必须的！当然了，我们已经不用瀑布流了。确保准时达到测试阶段，对我们已经没有太多意义了，但在敏捷开发（很多人深信，跟“现编现造”一个意思），特别是敏捷开发，计划表是最重要的，而且需要时刻保持更新。如今不同的是，计划表会根据新信息，保持更新。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-a-spec\">7. 是否有文档？</h3>\n<p>计划表那一条完整的被保留下来，文档却未必同样走运。在瀑布流流行的时候，文档是你了解开发目标的关键。如果你无法有效调配资源，那么你的项目，注定会失败。</p>\n<p>回到 2001 年，当你创建一个程序时，无论是一台咖啡机，一台火箭，或者只是一个简单的 CRUD（Create、Retrieve、Update、Delete等） 界面，你都很清楚需要做什么，以及大约需要多少开销，逐步实现它。开发人员、测试人员、项目管理人员各司其职，大家全程根据文档展开工作，测试，交付，然后进入下一个项目。而今，在很多方面已经不是这样了。当然了，如果你还在开发上面提到的东西，情况就基本没什么变化。但是，如果你在开发 Twitter 客户端呢？或者文本编辑器呢？再或者邮件客户端？以前的老方法还依然有效吗？通常不是。</p>\n<p>只有当你可以从一开始就获得所有信息，并用来完成规划，文档才是有效的。当你的软件需要持续开发时，文档只在 MVP（Minimum Viable Product，最小可行产品）阶段比较重要，在此之后，它的用处就很小了。要让文档在今天依然保持重要性，就必须实时更新信息，并相应地适应当前进度和产品情况。</p>\n<p>这里所谓的信息，可以通过很多形式获得。可能只是简单的模拟用户如何使用APP，或者应该更进一步，如果可能的话，应当对新特性和设计进行 A/B 测试。</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：是否有关于产品功能和使用相关的最新信息？</span></strong></p>\n<h3 id=\"do-programmers-have-quiet-working-conditions\">8. 程序员有安静的开发环境吗?</h3>\n<p>当回想八九十年代的软件开发环境，一片小隔间的海洋就会进入脑海。如今，情形基本没变，唯独发生变化的是，隔断变得更小了，或者隔断在所谓的“开放式”办公室里，直接消失了。</p>\n<p>我个人而言，我并不喜欢开放式办公室。我喜欢自己的办公室，我就可以拥有单独的开发时间，完全看我的喜好，我可以打开音乐，让我步入状态。然而并不是所有人都同意我的观点。我知道很多人喜欢开放式办公，这样更加有效率，促进团队成员之间直接沟通，通常可以获得更快、更好的问题解决方案。</p>\n<p>这条规则对工作环境的要求，并不是什么特例。开放式办公室，通常比你自己的办公室更加嘈杂。每当有人问起关于开放式办公室的噪音问题时，我通常的解决方案就是带上耳机。通过消音技术，基本能解决绝大多数问题。这是我平常在开放办公室的办法。</p>\n<p>总之，安静的工作环境，无非就是独立办公室和开放办公室之间的取舍，这两个也没有孰优孰劣。</p>\n<p><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://ww4.sinaimg.cn/large/7cc829d3gw1f5o84olqc5j20zk0qodjo.jpg\"></p>\n<p style=\"text-align: center;\">（ 《<a href=\"http://blog.jobbole.com/101501/\" target=\"_blank\">国内程序员的办公桌是什么样的？</a>》文中黄钊的晒图 ）</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：删除</span></strong></p>\n<h3 id=\"do-you-use-the-best-tools-money-can-buy\">9. 是否使用市面上最好的工具？</h3>\n<p>这一条是最难取舍的，事实上我是写完本文其他部分以后，才回头写这一部分。</p>\n<p>我通常遇到的情况是这样的，公司无法负担市面最好的工具。也就是今天无法负担而已，不代表以后不行。我认为这一条规则的精神依然是成立的。公司应当有义务，尽可能保证开发人员的工作惬意、开心。愉快、宽松的程序员会生产更好的代码。</p>\n<p>有一点一定要切记，这并不意味着必须要用重金砸向这些问题，如果优秀的工具是免费的，那肯定还是要用免费的。</p>\n<p> </p>\n<p><img id=\"pic\" class=\"M_cur_zoom_in aligncenter\" src=\"http://ww1.sinaimg.cn/large/7cc829d3gw1f5mkf3ee8wj20zk0qon0z.jpg\" width=\"734\" height=\"551\"></p>\n<p style=\"text-align: center;\">（《<span data-rel=\"title\"><a class=\"archive-title\" title=\"国外程序员的办公桌是什么样的？\" href=\"http://blog.jobbole.com/103205/\" target=\"_blank\">国外程序员的办公桌是什么样的？</a>》，</span>网友「土豆」晒图）</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-testers\">10. 是否有测试人员？</h3>\n<p>不同公司在测试方面是有区别的。几年前，就在我还是个实习生，到成为全职之间那段时间，微软复用工程师作为测试人员。我曾撰文说明，<a href=\"https://www.quora.com/Why-is-Microsoft-merging-its-SDE-and-SDET-positions-into-the-software-engineer-title\" target=\"_blank\">为什么我认为微软复用开发和测试人员</a>，很好的说明我作为实习生浪费了多少资源，还消除了曾鼓励我编写更好代码的安全网。现在这都在微软得到印证，我们还是看看 Joel 对此是怎么说的：</p>\n<blockquote><p>如果你的团队没有专业的测试人员，至少每 2~3 个开发人员一个测试人员，你要么会交付缺陷产品，要么你让时薪 $100 的开发人员，去做时薪 $30 测试人员的工作。</p></blockquote>\n<p>我和 Joel 观点的主要不同是，对于微软而言，开发人员和测试人员是一样的，开发人员的薪酬并不是测试人员的 3 倍。测试人员花费时间，遍历代码变更，确保提交的修改可用，而且没有引入新的问题，这些都与开发人员的时间一样有价值。当然，这也算安全网。</p>\n<p>拥有测试人员是很好的选择，但是 Joel 提出了更好的观点，那就是，你千万不要浪费测试人员的价值。</p>\n<p>开发人员需要对自己的代码负责。如果你不是特别确信自己的代码无 bug，就不应当提交。这意味着你需要进行人工测试、单元测试、集成测试等等。既然在未进行代码 review 之前，代码是不可提交的，那没有进行测试，又怎么可以提交呢？</p>\n<p>测试人员不需要遍历每一个变更，但是他们需要确保，产品作为一个整体依然是稳定的。他们应该能将他们的时间投入测试模型，这远比开发人员更加有价值。有测试人员并不是最关键的，有完整有效的测试计划才是。</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：是否有完整的测试计划。</span></strong></p>\n<h3 id=\"do-new-candidates-write-code-during-their-interview\">11. 新员工面试时写代码吗？</h3>\n<p>当你在很多类似 Hacker News，或者一些  Reddit 之类开发网站搜索关键字“面试”时，结果中的文章有多少对现在的面试流程是正面评价呢？非常少！每个人都很清楚，现在的面试系统很烂，我们需要更好的选择。在某人想出更好的之前，就当现在只有这么一个办法，虽然看起来不像什么好点子，我们就将就一下吧。</p>\n<p>目前有如下一些不同的面试方法：</p>\n<ol>\n<li>白板面试。</li>\n<li>做一个家庭作业式的小项目。</li>\n<li>到公司来，与我们一起工作 6 个月，作为试用期。</li>\n</ol>\n<p>有件事我们都有共识，开发人员应该编码。既然这是他们的工作，那你就应该在这方面测试他们。就不要用查找特定的语法错误这种问题来为难他们，也不要让他们选择你的团队的工作语言了，只要确保他们可以编码即可。</p>\n<p>就像我们前面看到的，这一条也是非常常识的问题，我觉得就没必要继续保留了。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：删除。</strong></span></p>\n<h3 id=\"do-you-do-hallway-usability-testing\">12. 是否进行走廊可用性测试？</h3>\n<p>这是一条鲜为人知的规则，我们看看 Joel 的定义：</p>\n<blockquote><p>走廊可用性测试是这样的，你在走廊里，随手请一位路人，帮忙测试你刚刚编写的代码。如果如此请了 5 个人帮忙，你就可以找到代码中 95% 影响可用性的问题。</p></blockquote>\n<p>现在，如果我说走廊可用性测试是个好东西，应该不会有太多人反对吧，但是对于灰色桌面背景上的灰色工具栏，上面还有灰色按钮的情况，这就未必了。电脑用户（如今这个定义非常宽泛）通常不是特别了解其工作原理。对于专业工具，你可能需要按钮提示信息、拖拽支持、键盘快捷方式等，这样就非常棒了。然而对于 Facebook，得让你的爷爷奶奶也能用才行。这需要清晰的设计：元素之间采用高对比度，在合理的位置进行交互，还要有适合的大小。</p>\n<p>在各种情况下，需要创建用户界面和用户体验，我所说的不仅仅是常规的 UI，而是类似“以合理的方式，控制文件保存操作”这样的事，这已经不是一个开发人员能做到的了，应该由专业人员来做。现在这是专业的 UI 和 UX 设计师应该掌握的一种专业技能。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：是否有专业的 UI 和 UX 设计师?</strong></span></p>\n<h2>现在我们看看「Joel 测试」变成什么样了：</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc299105ed824305637\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 所有版本都是由一个持续集成服务自动完成的吗? \r\n2. 是否生成并使用每日版本? \r\n3. 是否有问题跟踪器?\r\n4. 写代码之前修正所有 bug 吗?\r\n5. 是否有实时更新的计划表?\r\n6. 是否实时更新产品功能和使用方法的文档?\r\n7. 是否使用市面上最好的工具？\r\n8. 是否有完整的测试计划？\r\n9. 是否有专业的 UI 和 UX 设计师？</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc299105ed824305637-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105ed824305637-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105ed824305637-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105ed824305637-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105ed824305637-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105ed824305637-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105ed824305637-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105ed824305637-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105ed824305637-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc299105ed824305637-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>所有版本都是由一个持续集成服务自动完成的吗<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105ed824305637-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>是否生成并使用每日版本<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594fc299105ed824305637-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否有问题跟踪器<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105ed824305637-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>写代码之前修正所有<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105ed824305637-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105ed824305637-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否实时更新产品功能和使用方法的文档<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105ed824305637-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105ed824305637-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>是否有完整的测试计划？</div><div class=\"crayon-line\" id=\"crayon-594fc299105ed824305637-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否有专业的<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UI</span><span class=\"crayon-h\"> </span>和<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UX</span><span class=\"crayon-h\"> </span>设计师？</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>我们砍掉了部分规则，修正了其他的。但是这还没完。这只是我们如何修改已有规则，使之与时俱进，但是我们还需要新增一些如今非常重要的规则。</p>\n<h2 id=\"new-rules\">新增的 3 个规则</h2>\n<h3 id=\"does-all-code-go-through-code-review\">所有代码都经过 review 了吗？</h3>\n<p>每个人都会犯错，无论你是刚刚毕业的新人，还是身经百战的编程老司机，你都会犯错。我们总是过于依赖编译器帮我们发现错误，这并不是编译器的正确使用方法。这就是我们需要“测试”的原因。但是测试也可能失效，我们不能 100% 依赖它。对你的代码擦亮眼睛，能让你发现平时未发现的东西。除此之外，这还能让你的代码与团队代码风格保持一致，编译器通常不具备这样的能力（代码检查这个主题，我们换个机会再谈）。一致性良好的代码，可以方便团队成员阅读、使用你的代码。</p>\n<h3 id=\"do-you-have-coding-standards\">是否有编码标准？</h3>\n<p>这条规则与上面一条相互依存。编写代码非常重要，但是最终你需要能重读你的代码。很遗憾，现实并不是这样。所以，我们应该尽可能让代码易于阅读。首要任务就是，保证代码库的一致性。通过制定一系列规范，在团队内贯彻，令代码易于阅读和理解。在代码库中搜索最常用的模块、类型等等，清晰定义期望的代码风格，帮助新进开发人员逐步跟上进度，这比在开发过程中一点点明确风格要好的多。也可以在持续集成系统中，增加自动代码检查工具，推进这些代码规范。</p>\n<h3 id=\"are-new-employees-given-training\">新员工是否有培训？</h3>\n<p>这看起来显而易见，但事实上却并不常见。很多新进开发人员，加入一家公司，就立刻被投入深水区。这个过程对开发人员和公司，都是浪费。有一些会试着游起来，但是绝大多数会沉没。当你加入一家公司后，你应当获得工作所需的一些必要信息。我并不是说你应该在一间会议室里待一周，学习 HR 课程、聆听 VP 的宣讲，这确非我的本意。实际上你应该获得你所工作系统的文档，并且，有一位团队成员，给你当一段时间导师，以帮助你尽快跟上进度。没错，这意味着这个开发人员可能在培训阶段的输出会有所减少，但是在此之后，你就获得了两个开发人员，任何会算数的人，都会看出来，这事一笔值当的投资。</p>\n<h2 id=\"conclusion\">结语</h2>\n<p>那么，我们看看我们 2017 版 “Joel 测试”是怎样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc299105f4791092057\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 所有版本都是由一个持续集成服务器自动完成的吗? \r\n2. 是否生成并使用每日版本? \r\n3. 是否有问题跟踪器?\r\n4. 写代码之前修正所有 bug 吗?\r\n5. 是否有实时更新的计划表?\r\n6. 是否实时更新产品功能和使用方法的文档?\r\n7. 是否使用市面上最好的工具？\r\n8. 是否有完整的测试计划？\r\n9. 是否有专业的 UI 和 UX 设计师？\r\n10. 所有代码都进行 review 吗？\r\n11. 是否有代码规范？\r\n12. 新员工有培训吗？</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fc299105f4791092057-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc299105f4791092057-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>所有版本都是由一个持续集成服务器自动完成的吗<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>是否生成并使用每日版本<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否有问题跟踪器<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>写代码之前修正所有<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否实时更新产品功能和使用方法的文档<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>是否有完整的测试计划？</div><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否有专业的<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UI</span><span class=\"crayon-h\"> </span>和<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UX</span><span class=\"crayon-h\"> </span>设计师？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-10\"><span class=\"crayon-cn\">10.</span><span class=\"crayon-h\"> </span>所有代码都进行<span class=\"crayon-h\"> </span><span class=\"crayon-i\">review</span><span class=\"crayon-h\"> </span>吗？</div><div class=\"crayon-line\" id=\"crayon-594fc299105f4791092057-11\"><span class=\"crayon-cn\">11.</span><span class=\"crayon-h\"> </span>是否有代码规范？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc299105f4791092057-12\"><span class=\"crayon-cn\">12.</span><span class=\"crayon-h\"> </span>新员工有培训吗？</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>好棒耶！让我们喜大普奔地照办起来吧。</p>\n<p>还是不要了！该测试不是万金油，只是个指导意见。它是一个指导系统，而非一套完整的评估系统。一个得到满分的企业，依然可能是一家不宜工作的地方。当然，如果一家公司连 10 分都拿不到，那这是家不靠谱的公司基本没跑。只要确保你的雇主能获得 11~12 这样的高分，然后根据自己的判断来。千万不要迷信！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111551\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111551votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111551\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy\">alvendarthy</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个热爱生活的家伙！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/alvendarthy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/alvendarthy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8ac214b4204afd642c5f87970a0d16ad87660f96.jpg"}
{"url_object_id": "df681e6513a624d137705e1cd73fb5cc", "url": "http://blog.jobbole.com/109944/", "title": "30 岁转行做初级程序员是什么样的体验", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgn22fpk57j20m80et77o.jpg"], "create_date": "2017-06-16", "praise_nums": 2, "fav_nums": 3, "comment_nums": 0, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/being-a-junior-developer-at-30-38309f1daee8\">Eva Lettner</a>   译文出处：<a target=\"_blank\" href=\"https://sdk.cn/news/7081\">SDK/鲁行云</a>   </div><p>改变职业是一件吓人的事情，有时候还会成为一件危险的事情。年龄越大，危险就越高。从头学起一样东西，难度总是非常高，尤其是当你身边的人都比你年纪小，而且比你成就高的时候。我在30岁的时候进入科技行业，在这个旅程中我收获了难忘的经历，见到了优秀的人，并且得到了许多机会。</p>\n<p>今天是我 32 岁生日，我想要在这一天回顾过去一年来的旅程、机遇、新朋友和那些让人窒息的挑战。</p>\n<p><em><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgn22fpk57j20m80et77o.jpg\" width=\"690\" height=\"460\"></em></p>\n<p style=\"text-align: center;\"><em>（2017年5月，我在 We Are Developers 活动上演讲 ）</em></p>\n<p>二十几岁的时候，我觉得自己到了 32 岁的时候一定已经找到了自己想要的东西。我曾经憧憬自己成为一个幸福的女人，有着美满的人生，自己喜欢的工作，穿着美美的高跟鞋，而且给自己制定了详细的未来计划。</p>\n<p>但是现实和梦想总是存在着差距，我今天脸上的妆还是昨天画的，穿的是老公的衬衫。我的生活的确很幸福，但是和我当初想象的却大相径庭，而我的职业才刚刚起步。我从来不穿高跟鞋，因为我觉得它们不舒服，而对于未来，我根本没有计划！</p>\n<p>我用了很长的时间才进入了科技行业，一路上有眼泪，也有沮丧。本来我的理想是成为一名语言学家，我希望环游世界，在各个知名学府里翻译古代文本。后来，我的母亲不幸的得了癌症，一切对我来说都不再重要了。病痛折磨了她两年半的时间，在这段时间里，我的生活也停滞了。我感到无比难过，大学不再重要，我的学位也不再重要，我刹那间迷失在生活中，漫无目的。</p>\n<p>虽然用了一段时间，但是最后我还是从悲痛中恢复了。我突然想到回去做曾经喜欢的Web设计工作。我之前一直很喜欢Web设计，但是从来没有想过将它作为我的职业。于是我开始学习写代码，并且找到了一个为期两年的项目，我在这个项目中认识了<a href=\"https://twitter.com/mmatuzo\"><u>Manuel Matuzovic</u></a>，他是我的老师，并且我们最后成为了朋友，我也将他视为是我的导师。他不断的给我设定挑战，并且挖掘了我的潜力。</p>\n<p>大约一年以前，我成为了一名全职开发者，我想要总结一下这一年的经验，并且和所有人分享，一个30多岁的人是如何进入科技行业的：</p>\n<h3>大家都好年轻！</h3>\n<p>在我刚刚入职的时候，我是公司里年级最大的人，而且还是一个初级开发者。这种感觉很奇怪，尤其是在我之前的工作中，我曾是管理层的一员，管理者一个超过60人的团队。</p>\n<p>我一度觉得自己完全无法赶上身边的人，他们都比我强太多了。这种感觉如今依然会时不时的向我袭来，但是在我找到自己的强项之后，这种感觉就没有那么强烈了。</p>\n<p>因此我的建议是：找到你喜欢的东西，让自己获得提高，自信来源于练习。</p>\n<h3>冒充者综合征真的存在</h3>\n<p>编程的好坏是装不出来的。对于我这样容易担心的人来说，把代码发给同事去审核就像是一个噩梦。我总是觉得自己是个loser，觉得自己永远都没有进步。在我看来，克服这种感觉的关键在于沟通。我跟老板说了我的不安全感，并且请他评价了我的代码质量，以及询问他我这一段时间里是否有了进步。每当遇到不同的问题，我就会去提问，不断的从他和其他人那里学习。很幸运，我的老板和同事都是很好的人，他们让我敢于向他们提问。</p>\n<h3>身边的人很重要</h3>\n<p>和其他工作一样，作为一名开发者也需要积攒人脉。你的同时、客户、用户。</p>\n<p>我在科技大会上见到了很多优秀的人。这个行业的气氛真的很不错，人与人之间彼此尊重、彼此学习。当时，和其他行业一样，科技行业也有丑陋的一面，但是我感觉到了人与人之间的对话。我们还有很大的进步空间，而且我们都在不断努力。</p>\n<h3>不仅是份工作</h3>\n<p>在之前的工作中，每天下班之后，我都不想在去考虑任何与工作有关的事情。而在科技行业，下班后我不是直接回家，而是去参加各种meetup。而周末的时候，我回去参加hackathon，各种科技大会我都会参加，有时还会自己组织一些活动。</p>\n<p>当一名开发者是一种非常特别的体验。离开办公室之后，你的工作并没有停止。</p>\n<h3>公开演讲是一件有意思的事情！</h3>\n<p>我是个有梦想的人，进入科技行业也想要取得成功。尽管从来没有特别准备过，但是我在维也纳参加meetup的时候，却马上成为了一名科技演讲人，在1000人面前进行演讲。也许是因为年纪大了，我现在不再害怕在众人面前说话，甚至开始享受这种感觉。我甚至还开始教其他人东西。我觉得22岁的我一定做不到这一点。</p>\n<h3>我的未来在哪里？</h3>\n<p>希望能够获得更多的公开演讲机会，更多的编程挑战，参加更多的大会，拥抱更多优秀的人，让我的职业生涯更圆满。</p>\n<p>如果你正在考虑转行，但是担心自己的年纪太大，请听我一句话：追求幸福和成功，享受你的工作，在工作中结实优秀的人，这一切都不受年龄的限制。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"109944\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"109944votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"109944\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/1fa2a48d2861decd9ce91a980d2cbf42c7800763.jpg"}
{"url_object_id": "870e31215fb1729110ca515f2094da90", "url": "http://blog.jobbole.com/111472/", "title": "C++ 中命名空间的 5 个常见用法", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/05/eca4be2ffe4b0cb57637c10c6a35a454.png"], "create_date": "2017-06-16", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "C/C++,C++", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://cppdepend.com/blog/?p=79\">CppDepend Team</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32479\">王江平</a>   </div><p>译者注：可能很多程序员对C++已经非常熟悉，但是对命名空间经常使用到的地方还不是很明白，这篇文章就针对命名空间这一块做了一个叙述。</p>\n<p>命名空间在1995年被引入到 c++ 标准中，通常是这样定义的:</p>\n<blockquote>\n<div>命名空间定义了新的作用域。它们提供了一种避免名称冲突的方法。</div>\n</blockquote>\n<p>c++ 中的命名空间通常用于避免命名冲突。尽管命名空间在最近的 c++ 代码中广泛使用，但大多数较旧代码都不使用此工具。</p>\n<p>基于对众多C++项目源码的探索与研究，总结出了在这些项目中使用命名空间的一些常见原因。</p>\n<p><strong>1-避免名称冲突</strong></p>\n<p>如前所述，这是在C++中使用命名空间最常见的原因，在这种情况下，它们的使用只是对编译器有效。无法为开发人员在代码可读性和维护性方面带来什么价值。</p>\n<p><strong>2-模块化应用程序</strong></p>\n<p>命名空间采取 “Namespace-by-feature ”的方法使代码模块化。”Namespace-by-feature” 通过命名空间来反映功能集。它将具有相互关联的项归类在同一个命名空间。这会形成具有高内聚低耦合（译者注：高内聚是指一个软件模块是由相关性很强的代码组成，只负责一项任务。耦合是一个软件结构内不同模块之间互连程度的度量）、模块性很强的命名空间。</p>\n<p>Boost是按功能分组的最佳示例， 它包含数以千计的命名空间， 每一个都用于对特定功能进行分组。</p>\n<p><strong>3-匿名命名空间</strong></p>\n<p>匿名的命名空间可避免产生全局静态变量。您创建的 “匿名” 命名空间只能在创建它的文件中访问。</p>\n<p><strong>4-解决枚举类型成员重名问题</strong></p>\n<p>如果在同一个作用域内定义了具有相同名称的枚举，C++中的“传统”枚举会在其作用域内导出枚举值，可能会导致名称冲突，</p>\n<p>在一个大型项目中，不能保证两个不同的枚举都不会以同名命名。这个问题在C++ 11中已经得以解决，它使用枚举类，隐式地对枚举名称中的枚举值进行定义。</p>\n<p>许多年前, 使用在命名空间内声明枚举的技巧解决这个问题, 而不是像这样声明枚举</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2cb85eb2478087367\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n enum status{  \r\n   status_ok,  \r\n    status_error  \r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2cb85eb2478087367-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2cb85eb2478087367-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2cb85eb2478087367-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2cb85eb2478087367-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2cb85eb2478087367-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">enum</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2cb85eb2478087367-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">status_ok</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2cb85eb2478087367-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">_</span>error<span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2cb85eb2478087367-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>它在命名空间中声明:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2cb85ec2073737340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n namespace status{  \r\n   enum status{  \r\n     ok,\r\n      error  \r\n };  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2cb85ec2073737340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2cb85ec2073737340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2cb85ec2073737340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2cb85ec2073737340-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc2cb85ec2073737340-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2cb85ec2073737340-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2cb85ec2073737340-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2cb85ec2073737340-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">enum</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2cb85ec2073737340-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">ok</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2cb85ec2073737340-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">error</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2cb85ec2073737340-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2cb85ec2073737340-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>许多 c++ 项目使用此技巧，例如Unreal Engine（译者注：UNREAL ENGINE中文名称为“虚幻引擎” ，是目前世界最知名授权最广的顶尖游戏引擎，占有全球商用游戏引擎80%的市场份额）源代码就广泛使用此技术。</p>\n<p><strong>5-隐藏实现</strong></p>\n<p>对于在头文件中实现的模板库，开发者在调用时不需要用到特殊的数据类型，因为他们只专注于功能的实现，所以对于找到一种适合开发者调用库的方法是很有趣的。在c#中， “internal” 关键字做了这项工作， 但是在c++中，没有办法将公有数据类型完全对开发者进行隐藏。</p>\n<p>在模块中将定义和实现分离，是由Boost库开发者们创建的一个c++惯用语法，但这些定义必须按照规则放入到一个可供开发者调用sub-namespace（子命名空间）中。</p>\n<p>例如在 boost::math文档中， 它指定:</p>\n<div>引用</div>\n<blockquote>\n<div>不适用于应用程序的函数是在 boost::math::detail中。</div>\n</blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111472\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111472votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111472\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/da35ad566039b9a47e7be77df46f799f2628ed32.jpg"}
{"url_object_id": "94888647819d6f970f3339f019f4c5a9", "url": "http://blog.jobbole.com/108466/", "title": "数据科学家和机器学习工程师有什么不同", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fgkj97pnkuj20m00ejjtd.jpg"], "create_date": "2017-06-14", "praise_nums": 1, "fav_nums": 2, "comment_nums": 2, "tags": "开发,数据科学,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.oreilly.com/ideas/what-are-machine-learning-engineers\">Ben Lorica、Mike Loukides</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32480\">ITEYE/何冰心</a>   </div><p>近十年来，“数据科学”和“数据科学家”备受关注。但对于哪些人可以被称为是“数据科学家”，则争论不休。业界最后达成一致：只要取得数据科学相关学位、认证的研究数据的，不论是在大学还是从在线课程，都称之为数据科学家。统计数据是枯燥单一的，是非自然的，只有各种各样的数据才使得世界丰富多彩。那么，如何去分析多样的数据呢？数据科学家便应需求而生。</p>\n<p>数据科学领域飞速发展，一大波数据专家正在袭来。在企业中，他们被称为“数据科学家”或“数据科学团队”，包括：</p>\n<ul>\n<li>普通员工：执行临时的分析或报告任务（包括商业智能和商业分析）</li>\n<li>数据分析者：负责统计分析，建模，包括实验和测试</li>\n<li>机器学习建模者：构建模型原型</li>\n</ul>\n<p>那么问题来了。创造出“数据科学家”此概念并且从数据中挖掘出产品的 DJ Patil 和 Jeff Hammerbacher 属于哪一类呢？他们看似并不属于以上任何一种。若非要归类，他们大概更倾向于被看做是机器学习的建模者。他们是研究者，并没有通过数据进行产出。那么，究竟如何定义数据科学家呢？我们认为，数据科学家不仅仅是统计学家，他们一般拥有计算机科学领域的博士学位，有着大量的数据实践经验，有着很强的编码能力，精通数据提取、清洗、建模、将原型变成产品、产品设计以及数据基础建设，等等。<strong>实际上，数据科学家更应该被称作为硅谷的“独角兽”，稀有且昂贵。</strong></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fgkj97pnkuj20m00ejjtd.jpg\"></p>\n<p>“数据科学”不分领域不分专业，它不只是精算统计、商务智能、数据仓库等，它打破了已有行业的壁垒，比如软件、市场、管理、人力等。数据科学的灵魂所在是它涵盖了数据的方方面面，各个领域。而数据科学家的任务便是收集、使用所有数据，而不是某一领域的数据。</p>\n<p>然而，找到这些稀有的“独角兽”是极其困难的。因此，我们把其职能根据专业性进行划分，数据工程师便诞生了。数据工程师精通数学和统计学，但他们不只是数学家或统计学家，他们精通软件开发和编程，但又不只是程序员。数据工程师负责数据栈操作和维护，Hadoop 或 Spark 的构建和维护，以及众多数据库（比如 HBase 和 Cassandra）和平台（比如 Kafka、Spark Streaming 和 Apache Flink ）等等。他们要知道如何操作云端，如何使用 Amazon Web Services，Microsoft Azure 和 Google Compute Engine。</p>\n<p>2015 年有一篇被广泛引用的文献突出强调，真实世界的机器学习系统不只是分析模型。各个公司开始着眼于研发基于数据的产品，并把相关技术投入生产中去。在这众多项目中，严格属于“机器学习”的部分并不是很多。然后，我们发现越来越多的公司组成了机器学习工程师团队。这并不难想象，当今机器学习盛行，数据工程师肯定会顺应潮流寻求突破。那么，机器学习工程师与数据工程师有什么区别呢？</p>\n<p>一般来讲，机器学习工程师的职责涵盖软件工程师（和一些好的数据工程师）的职责：</p>\n<ul>\n<li>他们拥有比普通数据科学家更强的软件编码能力。</li>\n<li>由于他们的工作重心是产出数据产品，他们需要通观全局。</li>\n<li>他们监管数据型产品的生产，并了解产品可能会出现的问题。</li>\n<li>深度学习的盛行引领一个相关的更专业的职位出现：深度学习工程师。</li>\n</ul>\n<p>机器学习工程师不仅仅要了解，更要参与到软件架构和设计中去。比如，他们了解 A/B 测试，同时也要知道如何 A/B 测试。他们了解日志或安全性问题，同时也要知道如何让数据工程师能够有效使用日志数据。对于机器学习工程师这个头衔来说，并无新鲜和特殊之处，更多的是深挖而不是改变。</p>\n<p>机器学习与数据科学有什么区别呢？数据科学涵盖面更广。最大的区别是深度学习的运作方式。容易想象的是数据科学家如何挖掘数据，比如 Tukey 的 Exploratory Data Analysis 中介绍了挖掘并分析大量数据去发现其价值所在。</p>\n<p>但是深度学习改变了数据挖掘方式。我们不直接接触数据，我们只是知道结果，让程序自己去建模并发现数据的价值。比如，如何构建一个能够打败围棋冠军的智能机器人，如何准确地标记图片，如何精准地翻译。这些问题，需要大量的数据和维度，人力难以实现，而机器学习便是构造一个模型，让这个模型自主发掘数据。那么，数据科学家的工作便不再是自己从数据中发掘价值，而是构建一个能够分析数据并产生结果的机器。实现“平民化”是机器学习领域的梦想，其含义便是任意领域的专家都能构建一个机器学习系统，而非 AI 博士。比如，我们希望一个围棋选手便能够构建下一代 AlphaGo，一个西班牙语者便能够构建一个西班牙语翻译引擎，而非机器学习专家。</p>\n<p>这种转变影响着机器学习工程师。机器学习模型不是静态的，会随着需求变化而成长。应该有专人去监管机器学习系统并在必要时进行重新训练。</p>\n<p>所有从事软件或IT行业的人都知道安全问题很重要。如今，机器学习系统的安全性上还未出现问题，但依然要防范于未然。那么，如今的机器学习系统在哪方面容易被攻击？系统中的数据是否会被感染？是否能够强迫系统进行非必要的重训练？由于该系统的自主训练模式，我们需要重新认知其在安全性上的易攻击点。</p>\n<p>随着系统日益完善，我们发现更多的数据科学家使之转变为生产系统。比如，云端和 SaaS 使数据科学家得以充分利用数据模型并运用到生产中，一些开源项目像是 Clipper 和 Ground（加州大学伯克利分校的 RISELab 的新项目）也逐渐开始进行。但是我们依旧需要数据工程师和机器学习工程师：精通数据科学和机器学习，深入理解数据如何进行产出，敢于挑战创造基于机器学习的产品。他们是 “humans in the loop” 的终点。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"108466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"108466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"108466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/49c6509b4b6997ea4dc3eadffba385b0196497cb.jpg"}
{"url_object_id": "9ee795c61ba918ee74aef13fbaab16a9", "url": "http://blog.jobbole.com/111466/", "title": "2017 十大最佳用于隐私和安全保护的 Linux 发行版", "front_image_url": ["https://static.oschina.net/uploads/space/2017/0613/195235_iFxM_2918182.jpg"], "create_date": "2017-06-15", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "工具与资源,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/920550\">开源中国 - 局长</a>   </div><p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195235_iFxM_2918182.jpg\" alt=\"\" width=\"650\" height=\"400\"></p>\n<h2 id=\"h2_0\"><strong>介绍</strong></h2>\n<p>优秀的 Linux 操作系统是自由和开源的。因此，有数千种不同的“风味”可供选择——而某些类型的 Linux，例如 Ubuntu 是通用的，而且适用于许多不同的用途。</p>\n<p>但安全意识高的用户会对专为隐私和安全设计的 Linux 发行版更有兴趣，它们可以帮助你通过加密操作来保护数据的安全，并支持在 Live 模式下运行，无需将数据写入在使用中的硬盘。</p>\n<p>这篇文章将列出十个关注隐私和安全性的 Linux 发行版。</p>\n<h2 id=\"h2_1\" style=\"text-align: left\"><strong>1. Qubes OS</strong></h2>\n<p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195433_DrFR_2918182.png\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>虽然不是面向新手用户的发行版，但 Qubes 是顶级的关注隐私的发行版之一。该发行版必须使用图形化安装程序将操作系统安装到硬盘驱动器，这是被加密的。</p>\n<p>Qubes OS 使用 Xen Hypervisor 来运行多个虚拟机，其主要理念就是基于隔离的安全，它会将系统隔离为“个人”、“工作”和“上网”。这样，即便你不小心在工作机器上下载了恶意软件，但个人文件不会受到影响。</p>\n<p>主桌面会使用颜色编码的窗口，用于展示不同的虚拟机，以方便区分。</p>\n<p>https://www.qubes-os.org/</p>\n<h2 id=\"h2_2\"><strong>2. Tails</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/195623_NeGI_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>Tails (The Amnesiac Incognito Live System) 可能是最有名的关注隐私的 Linux 发行版之一，它是基于 Debian 的自启动光盘和 USB 发行。Tails 可以在 Live 模式下从 DVD 运行，从而将其完全加载进系统 RAM，并且其活动不会产生任何痕迹。这款系统也可以像普遍的系统一样在“持久”模式下运行，关于系统的设置会存储在加密的 U 盘上。</p>\n<p>Tails 为用户提供了完整的因特网匿名功能，所有的网络流量都会经过匿名网络 Tor，它可隐藏你的上网痕迹，使得网络流量难以被追踪。Tails 中配备的应用程序也是经过谨慎选择的，以安全为理念进行了预配置，以增强用户的隐私安全。例如，KeePassX 密码管理器、网页浏览器、IRC客户端、邮件mail客户端等。值得注意的是 Tails 会不断发现漏洞，因此请务必经常检查更新。（当然对待任何操作系统都应如此）</p>\n<p>https://tails.boum.org/</p>\n<h2 id=\"h2_3\"><strong>3. BlackArch Linux</strong></h2>\n<p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195923_uICR_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>这个基于 Arch Linux 的轻量级渗透测试发行，包含了 1,600 多种不同的黑客工具以用于渗透测试和计算机取证分析，这节省了每次下载需要的时间。BlackArch Linux 被设计为服务于系统渗透测试人员及安全研究人员，包含有多个轻量级窗口管理器如 Fluxbox、Openbox、Awesome、spectrwm。</p>\n<p>BlackArch Linux的提供形式是一张自启动运行 DVD 镜像，可以从 U 盘或 CD 上直接运行，也可以安装到电脑或虚拟机，甚至可以安装在树莓派上以给你提供一个便携的渗透测试计算机。</p>\n<p>特别值得一提的是它的 ‘anti-forensics’ 目录，因为它包含了为已加密的设备扫描内存的工具，这有助于保护机器免受“冷启动攻击”。</p>\n<p>https://blackarch.org/</p>\n<h2 id=\"h2_4\"><strong>4. Kali</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0426/080144_KZXe_2720166.png\"></p>\n<p>Kali Linux（以前叫做BackTrack），以印度教的一个女神命名，是最著名的渗透测试发行版之一，也是一份基于 Debian 的发行。它带有一套安全和计算机取证工具。其特色在于及时的安全更新（每周提供更新的 ISO 镜像），对 ARM 架构的支持（可在树莓派上运行），有四种流行的桌面环境供选择，以及能平滑升级到新版本。</p>\n<p>Kali 有着令人敬畏的声望，它的创作者会通过 <a href=\"https://www.kali.org/kali-linux-dojo-workshop/\" target=\"_blank\" rel=\"nofollow\">Kali Linux Dojo</a> 提供培训。课程内容包括定制自己的 Kali Linux ISO 和学习渗透测试的基础。对于无法参加培训的人士，所有的课程教育资源都可通过 Kali 的网站免费获取。</p>\n<p>https://www.kali.org/</p>\n<h2 id=\"h2_5\"><strong>5. IprediaOS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200242_tDsT_2918182.jpg\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>IprediaOS 是一个基于 Linux 的快速、强大和稳定的操作系统，提供了匿名的环境。所有的网络流量都会被自动和透明地加密和匿名化。这个面向隐私的操作系统基于 Fedora Linux，可在 Live 模式下运行也可安装到硬盘上。正如 Tails OS 会将所有网络流量通过 Tor 网络以避免被追踪，Ipredia 中所有的网络流量都会经过匿名的 I2P 网络。</p>\n<p>它的功能包括匿名电子邮件和 BitTorrent 客户端，IRC 聊天，以及浏览 eepsites（特殊的 .i2p 扩展名）的功能。与 Tor 不同的是，I2P 不能作为访问正常的互联网的网关，所以 Ipredia 无法安全地访问常规网站。不过只能访问 eepsites 的优点是你的连接是真正无法被追溯的。</p>\n<p>http://www.ipredia.org/os</p>\n<h2 id=\"h2_6\"><strong>6. Whonix</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200603_Z1TH_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>引导一份 Live 操作系统是一个麻烦，因为必须重新启动计算机，但将其安装到硬盘意味着有被攻击的风险。Whonix 提供了一个优雅的方案，它被设计为运行在 Virtualbox 中作为一个虚拟机而工作。由于它在虚拟机中运行，所以 Whonix 与所有可运行 Virtualbox 的操作系统兼容。</p>\n<p>Whonix 是一份聚焦于匿名性、隐私、安全的操作系统。它基于 Tor 匿名网络、Debian GNU/Linux、基于隔离的安全性。Whonix 包括两部分，一部分只运行在 Tor 上并扮演网关角色，这部分叫做 Whonix-Gateway；另一部分叫做 Whonix-Workstation，位于隔离网络中。只有经由 Tor 的连接被允许。有了 Whonix，你就可以匿名使用应用程序并在因特网上运行服务器。因匿名解析而造成的信息泄漏不可能存在，即便获得了根权限的恶意软件也无法发现用户的真实 IP 地址。</p>\n<p>https://www.whonix.org/</p>\n<h2 id=\"h2_7\"><strong>7. Discreete Linux</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200511_1ovk_2918182.jpg\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>这个故意拼写错的发行版是优秀的 Ubuntu Privacy Remix 的继承者。该操作系统不支持网络硬件或内部硬盘驱动器，因此所有的数据都离线存储在 RAM 或 USB 设备中。它可以在 Live 模式下运行，但当从卷启动时也允许将一些设置存储在加密的‘Cryptobox’中。</p>\n<p>还有另外一个值得关注的功能是它的内核模块只能在 Discreete Linux 团队进行数字签名后才能安装。这可以防止黑客试图偷偷安装恶意软件。请注意，该操作系统目前尚处于 Beat 测试阶段。</p>\n<p>https://www.discreete-linux.org/</p>\n<h2 id=\"h2_8\"><strong>8. Parrot Security OS</strong></h2>\n<p><img src=\"http://static.oschina.net/uploads/space/2016/1017/071656_YYvN_2720166.png\"></p>\n<p>这款渗透测试系统由来自意大利的团队 Frozenbox 开发。和 Kali 和 BlackArch 一样，它也包含着许多易用的工具。Parrot Security OS 是面向安全的操作系统，它被设计为用于渗透测试、计算机取证、反向工程、攻击、云计算渗透测试、隐私/匿名、密码等场合。</p>\n<p>Parrot 基于 Debian，其特色在于 MATE 桌面环境，拥有更丰富多彩的背景和菜单。因此，它对硬件的要求比其他渗透测试发行版（例如 Kali）更高。建议至少使用 2GB 的 RAM。</p>\n<p>对于资源有限的用户，Parrot Cloud 是专门用于在服务器上运行的特殊发行版。它没有图形界面，但包含了一些网络和取证工具，可用于远程运行测试。</p>\n<p>https://www.parrotsec.org/</p>\n<h2 id=\"h2_9\"><strong>9. Subgraph OS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/201019_7SbG_2918182.png\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>Subgraph OS 是基于 Debian 的 Linux 发行，为超强的安全性而设计，它提供了多种安全、匿名上网、加固的特性。它的内核通过许多安全性的增强进行了加固，Subgraph 还在诸如浏览器之类的高风险应用中创建了虚拟的“沙盒”。因此，任何针对独立应用程序的攻击都不会危及整个系统。</p>\n<p>Subgraph OS 使用加固过的 Linux 内核及应用防火墙来阻止特定的可执行程序去访问网络，并强制要求所有的因特网流量都经由 Tor 网络。每个应用程序需要连接到网络和访问其他应用程序的“沙盒”都需经过手动的允许。</p>\n<p>该发行的文件管理器带有特色工具可以从数据文件中移除元数据，并且还集成了 OnionShare 文件共享软件。该发行使用 Icedove 邮件客户端以自动配合 Enigmail 对电子邮件进行加密。</p>\n<p>在 Subgraph 中，对文件系统的加密是强制性的，这意味着没有写入未加密数据的危险。要注意的是，Subgraph 还处于测试阶段，因此不要依赖使用它来保护任何真正敏感的数据（并且一如既往地保持常规的备份）。</p>\n<p>https://subgraph.com/</p>\n<h2 id=\"h2_10\"><strong>10. TENS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/194931_D4L5_2720166.png\"></p>\n<p>第十个发行版恰好是 TENS(Trusted End Node Security)。以前被称为 LPS(Lightweight Portable Security)，这份 Linux 发行版是美国国防部的产品。Trusted End Node Security (TENS)是基于 Linux 的自启动运行光盘，其目标是让用户能在计算机上工作而不会有向恶意软件、键盘记录程序及其他因特网时代的恶疾泄露信息凭证及私人数据的风险。</p>\n<p>它包含了最必需的一套应用软件及实用工具，例如 Firefox 网页浏览器，以及一份加密向导以对个人文件进行加解密。但有一个‘Public Deluxe’（公开豪华版）也包含了 Adobe Reader 和 LibreOffice 这样的工具。所有的版本都包含一个自定义防火墙，值得注意的是该操作系统支持通过 Smart Card 登录。</p>\n<p>https://spi.dod.mil/lipose.htm</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/afce380e67e6757fa681cdf46ce584920cb491a3.jpg"}
{"url_object_id": "3a898adcf998284e1075b145b18db2d5", "url": "http://blog.jobbole.com/111468/", "title": "拯救 Java Code Style 强迫症", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg"], "create_date": "2017-06-16", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "开发,java,编程风格", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>这篇文章缘起于上一个持续交付的咨询项目，当时正在指导客户团队的Java工程师做Code Review，发现一个很有意思的现象：有一位工程师对Code Style特别在意，所以在Code Review的大部分时间中都是该工程师在指出哪里哪里的格式不对，但是团队并没有找到改进方法，每次的结论都是“下次我注意一点。”我挺欣赏这位工程师对Code Style的认真态度，所以就萌生了“怎么拯救Code Style强迫症”的想法。</p>\n<h3>要点</h3>\n<ul>\n<li>Code Style不是个人喜好问题，它会影响工作效率，团队应将其当做工程实践予以重视。</li>\n<li>Code Style需要端到端的工具支持，尽早解决问题，避免技术债。</li>\n<li>以Checkstyle作为核心工具支撑Java项目的Code Style实施方案。</li>\n</ul>\n<h3>Code Style是一项工程实践</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg\" alt=\"\" width=\"479\" height=\"310\"></a></p>\n<p>我是右侧风格的忠实拥趸，如果让我在工作的项目中看到左侧风格的代码，你猜猜我的反应是什么。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-gitblame.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-gitblame.jpg\" alt=\"\" width=\"400\" height=\"400\"></a></p>\n<p>嗯，可能我对代码风格确实有些强迫症，但事实上，Code Style并不仅仅是代码是否好看那么简单，如果没有按照惯例来编写代码，甚至会让阅读者产生疑惑。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f6c3ebec0a621881131\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate Listener listener = new Listener() // So Listener looks like a class?  \r\n{}; // Oops, it is an interface</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec0a621881131-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec0a621881131-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f6c3ebec0a621881131-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listener </span><span class=\"crayon-v\">listener</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// So Listener looks like a class?  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec0a621881131-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Oops, it is an interface</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>如果代码可读性还不足以打动你，那么想象一下这个场景，你的同事说他修复了两个空指针问题，请你帮忙Code Review，你查看了这个文件的修订历史，乍看之下有许多改动，看来是个大动作。然而事实上，绝大部分改动是代码格式调整，只有两处改动与需要Review的问题相关。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-happy-code-review.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-happy-code-review-1024x365.jpg\" alt=\"\" width=\"700\" height=\"250\"></a></p>\n<p style=\"text-align: center;\">(看来这位同事的IDE使用了不同的自动缩进设置，导致所有行都产生了缩进)</p>\n<p>之所以会产生以上这些影响工作效率的问题，是因为团队没有重视Code Style，没有把它当做一项工程实践，既没有对其达成一致，也没有正确地使用工具帮助实施。</p>\n<h3>那就按照工程实践的标准来实施Code Style</h3>\n<p>本文将重点介绍Java项目中Code Style的工具支持，但在此之前，你的团队需要一起做一些决定：</p>\n<p><strong>使用哪种Code Style？</strong></p>\n<p>每个人可能都有偏好的style，但在团队协作面前，需要一定的妥协。有些公司或组织有着统一的Code Style指导标准，萧规曹随是个不错的选择（但是要确保这类统一指导标准在制定时参考了开发人员的意见，是切实可行的），你的团队也可以自己裁剪，但至少要保证项目（Repository）级别上使用同一种Style。</p>\n<p><strong>如何处理不符合Code Style的提交？</strong></p>\n<p>大家往往懈怠于事后补救的方式，我的建议是不要让不符合约定的代码流入代码库。对于遗留项目，尤其是大型项目，可以选择一部分代码作为实施范围，集中修复Style问题后严格实施，切忌操之过急，最后团队疲惫不堪只得放弃。</p>\n<p>我们都知道人工监督检查的方式是不可持续和不可靠的，来看看有哪些工具可以提供帮助吧。</p>\n<h3>懒惰是第一生产力</h3>\n<p>工程实践不能没有自动化工具支持，在Java生态圈中，Code Style工具最出名的应该是Checkstyle了，它可以通过XML形式的<a href=\"https://martinfowler.com/books/dsl.html\">外部DSL</a>来定义Code Style的检查风格，比如你可以从这里找到<a href=\"https://github.com/checkstyle/checkstyle/blob/master/src/main/resources/google_checks.xml\">Google的Java Checkstyle配置文件</a>。这里我不会详细介绍Checkstyle本身，相反，我会更多地探讨如何工程化地使用Checkstyle，在交付代码的各个活动中，我们都可以用到Checkstyle，进行360°无死角的检查。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-lifecycle-overview.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-lifecycle-overview-1024x558.jpg\" alt=\"\" width=\"700\" height=\"381\"></a></p>\n<p style=\"text-align: center;\">（和Code Style相关的代码交付生命周期）</p>\n<h3>守住提交的质量关口</h3>\n<p>为了贯彻不让不符合约定的代码流入代码库的决定，可以优先在服务端设置Code Style的检查关卡。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-lifecycle-ci.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-lifecycle-ci-1024x584.jpg\" alt=\"\" width=\"700\" height=\"399\"></a></p>\n<p style=\"text-align: center;\">（优先守住代码提交时的服务端检查，可以考虑使用CI服务器来实现）</p>\n<p><strong>从实现层面上说，有两种方式：</strong></p>\n<p>一是在SCM（Source Control Management，例如Git/SVN）服务端设置检查项，如果不达标则拒绝提交，但这种方式相对不容易实现，而且一般SCM服务端也不由开发团队管理，设置起来不灵活也不方便。</p>\n<p>二是利用<a href=\"https://www.thoughtworks.com/continuous-integration\">持续集成</a>服务器，开发团队的每一次提交都会触发一次构建，我们可以在构建脚本中加入Checkstyle检查，如果有不达标的代码则让构建失败，以便告诉提交者立即修复Style问题。我更推荐这个方案，因为相关的工具支持都很成熟，实现简单，而且构建过程可以在开发者的本地环境复制，以便在后续改进中将Checkstyle检查前移，提供更快的反馈。如果团队使用Maven/Gradle等构建工具，可以用插件的方式实现Checkstyle检查并嵌入到整个构建过程中。这样CI服务器只要调用构建脚本就行了。</p>\n<h3>在开发者本地验证Style</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/6-lifecycle-local.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/6-lifecycle-local-1024x559.jpg\" alt=\"\" width=\"700\" height=\"382\"></a></p>\n<p style=\"text-align: center;\">（在开发者本地实现验证，反馈关口前移）</p>\n<p>在实现了CI验证后，就可以着手实现开发者本地验证了，这样开发者就不用等到提交代码到服务端后才会获得反馈了。由于之前采用的是构建工具的插件方案，所以开发者在本地运行构建就能实现验证了。比如Gradle提供了Checkstyle插件支持，你可以在这里找到Gradle Checkstyle Plugin的详细配置文档，如果你使用Maven，则可以参考这里。现在只需要一条命令，开发者久能在本地验证Code style了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f6c3ebec1e882315281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# build.gradle \r\n# omitted plugins \r\napply plugin: 'checkstyle'  \r\ncheckstyle {     \r\n    configFile = file(\"config/checkstyle.xml\") //指定checkstyle配置文件     \r\n    toolVersion = \"7.4\" //指定checkstyle工具的版本，部分style规则有版本要求 \r\n}  \r\ncheckstyleTest.exclude \"**/ContractVerifierTest**\" // 忽略检查生成代码，这个锅我们不背  \r\n\r\n// 如果出现checkstyle warning也使构建失败，插件默认只支持checkstyle error失败 \r\n// Fail build on Checkstyle Warning Violation · Issue #881 \r\ntasks.withType(Checkstyle).each { checkstyleTask -&gt;     \r\n    checkstyleTask.doLast {         \r\n        reports.all { report -&gt;             \r\n            def outputFile = report.destination             \r\n            if (outputFile.exists() &amp;&amp; outputFile.text.contains(\"&lt;error \")) {    \r\n                throw new GradleException(\"There were checkstyle warnings! For more info check $outputFile\")             \r\n            }         \r\n        }     \r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec1e882315281-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec1e882315281-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-1\"><span class=\"crayon-p\"># build.gradle </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-2\"><span class=\"crayon-p\"># omitted plugins </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-3\"><span class=\"crayon-e\">apply </span><span class=\"crayon-v\">plugin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'checkstyle'</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-4\"><span class=\"crayon-e\">checkstyle</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">configFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"config/checkstyle.xml\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//指定checkstyle配置文件     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">toolVersion</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"7.4\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//指定checkstyle工具的版本，部分style规则有版本要求 </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-8\"><span class=\"crayon-v\">checkstyleTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">exclude</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"**/ContractVerifierTest**\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 忽略检查生成代码，这个锅我们不背  </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-10\"><span class=\"crayon-c\">// 如果出现checkstyle warning也使构建失败，插件默认只支持checkstyle error失败 </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-11\"><span class=\"crayon-c\">// Fail build on Checkstyle Warning Violation · Issue #881 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-12\"><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withType</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Checkstyle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">checkstyleTask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">checkstyleTask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doLast</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">         </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">reports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">def </span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">destination             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-16\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&lt;error \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradleException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There were checkstyle warnings! For more info check $outputFile\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">         </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec1e882315281-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec1e882315281-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>现在只需要一条命令，每个开发者就能在本地验证Code Style了。你可以在<a href=\"https://docs.gradle.org/current/userguide/checkstyle_plugin.html\">这里</a>找到Gradle Checkstyle Plugin的详细配置文档，如果你使用Maven，则可以参考<a href=\"https://maven.apache.org/plugins/maven-checkstyle-plugin/\">这里</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f6c3ebec2c546301310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n➜  court-booking-backend (master) ✗ ./gradlew check \r\nStarting a Gradle Daemon (subsequent builds will be faster) \r\n:compileJava \r\n:processResources UP-TO-DATE \r\n:classes \r\n:checkstyleMain [ant:checkstyle] \r\n    [WARN] /Users/twer/Workspace/restbucks/court-booking-backend/src/main/java/com/restbucks/courtbooking/http/CourtRestController.java:16: \r\n    'method def' child have incorrect indentation level 4, expected level should be 8. [Indentation] :checkstyleMain FAILED  \r\nFAILURE: Build failed with an exception.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec2c546301310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec2c546301310-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec2c546301310-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec2c546301310-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec2c546301310-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec2c546301310-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec2c546301310-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec2c546301310-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec2c546301310-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f6c3ebec2c546301310-1\">➜<span class=\"crayon-h\">  </span><span class=\"crayon-v\">court</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">booking</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">backend</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span>✗<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">gradlew </span><span class=\"crayon-e\">check </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec2c546301310-2\"><span class=\"crayon-i\">Starting</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gradle </span><span class=\"crayon-e\">Daemon</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">subsequent </span><span class=\"crayon-e\">builds </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">be </span><span class=\"crayon-v\">faster</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec2c546301310-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">compileJava</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec2c546301310-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">processResources </span><span class=\"crayon-v\">UP</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">TO</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DATE</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec2c546301310-5\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec2c546301310-6\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">checkstyleMain</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ant</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">checkstyle</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec2c546301310-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WARN</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twer</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Workspace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">restbucks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">court</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">booking</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backend</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">main</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">restbucks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">courtbooking</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CourtRestController</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec2c546301310-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'method def'</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">have </span><span class=\"crayon-e\">incorrect </span><span class=\"crayon-e\">indentation </span><span class=\"crayon-i\">level</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">expected </span><span class=\"crayon-e\">level </span><span class=\"crayon-e\">should </span><span class=\"crayon-i\">be</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Indentation</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">checkstyleMain </span><span class=\"crayon-e\">FAILED  </span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec2c546301310-9\"><span class=\"crayon-v\">FAILURE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Build </span><span class=\"crayon-e\">failed </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">an </span><span class=\"crayon-v\">exception</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p></p>\n<h3>本地验证很不错，但我有时候会忘记执行</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/7-lifecycle-git-hook.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/7-lifecycle-git-hook-1024x559.jpg\" alt=\"\" width=\"700\" height=\"382\"></a></p>\n<p style=\"text-align: center;\">（让机器代劳琐事）</p>\n<p>有时候，开发者修改了代码后会忘记执行本地检查就提交代码了，最好能够在提交代码前自动执行检查。如果你使用Git的话，可能会想到Git commit hook，比如这是我常用的pre-commit hook</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f6c3ebec31554686973\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\n# From gist at https://gist.github.com/chadmaughan/5889802\r\n\r\n# stash any unstaged changes\r\ngit stash -q --keep-index\r\n\r\n# run the tests with the gradle wrapper\r\n./gradlew clean build\r\n\r\n# store the last exit code in a variable\r\nRESULT=$?\r\n\r\n# unstash the unstashed changes\r\ngit stash pop -q\r\n\r\n# return the './gradlew build' exit code\r\nexit $RESULT</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec31554686973-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec31554686973-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-2\"><span class=\"crayon-p\"># From gist at https://gist.github.com/chadmaughan/5889802</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-4\"><span class=\"crayon-p\"># stash any unstaged changes</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-5\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">stash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-6\"> </div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-7\"><span class=\"crayon-p\"># run the tests with the gradle wrapper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-8\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">gradlew </span><span class=\"crayon-e\">clean </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-10\"><span class=\"crayon-p\"># store the last exit code in a variable</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-11\"><span class=\"crayon-v\">RESULT</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-12\"> </div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-13\"><span class=\"crayon-p\"># unstash the unstashed changes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-14\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">stash </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec31554686973-16\"><span class=\"crayon-p\"># return the './gradlew build' exit code</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec31554686973-17\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">RESULT</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>将该脚本拷贝到<code>.git/hooks/</code>下，在执行<code>git commit</code>的时候就会自动触发检查了，如果检查失败则提交失败。但问题是<code>.git</code>并不能提交到远程代码仓库，那么除了人工分发和拷贝外，有没有更好的方式在团队中共享这个机制呢？</p>\n<p>可以曲线救国！把pre-commit纳入版本控制(如下面的<code>config/pre-commit</code>)，再使用构建工具的扩展机制来自动完成拷贝工作，这样可以间接实现git hooks的团队间共享。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f6c3ebec35942325630\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# build.gradle\r\n\r\ntask installGitHooks(type: Copy) { //将pre-commit拷贝到指定位置\r\n    from new File(rootProject.rootDir, 'config/pre-commit')\r\n    into {\r\n        new File(rootProject.rootDir, '.git/hooks')\r\n    }\r\n    fileMode 0755\r\n}\r\n\r\nbuild.dependsOn installGitHooks //设置执行build任务时会自动触发installGitHooks任务</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec35942325630-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec35942325630-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec35942325630-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec35942325630-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f6c3ebec35942325630-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f6c3ebec35942325630-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-1\"><span class=\"crayon-p\"># build.gradle</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec35942325630-2\"> </div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-3\"><span class=\"crayon-e\">task </span><span class=\"crayon-e\">installGitHooks</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Copy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//将pre-commit拷贝到指定位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec35942325630-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">from </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rootProject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rootDir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'config/pre-commit'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec35942325630-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rootProject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rootDir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'.git/hooks'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec35942325630-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">fileMode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0755</span></div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f6c3ebec35942325630-10\"> </div><div class=\"crayon-line\" id=\"crayon-594f6c3ebec35942325630-11\"><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dependsOn </span><span class=\"crayon-v\">installGitHooks</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//设置执行build任务时会自动触发installGitHooks任务</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h3>关闭包围圈，编辑时反馈</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/8-lifecycle-edit-time.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/8-lifecycle-edit-time-1024x558.jpg\" alt=\"\" width=\"700\" height=\"381\"></a></p>\n<p style=\"text-align: center;\">(实时反馈)</p>\n<p>之前基于构建工具的方案都很好，但是对于开发者来说，最好能将反馈前移到编辑时，并且可视化。所幸的是，Checkstyle的生态系统非常成熟，各主流IDE都有插件支持，以Intellij Idea为例，可以使用<a href=\"https://github.com/jshiell/checkstyle-idea\">checkstyle-idea</a>插件，让团队成员手工设置插件，使用项目的checkstyle配置文件即可(我目前还没有找到自动化配置的方式，或许gradle idea插件可以？)</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/9-idea-checkstyle-settings.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/9-idea-checkstyle-settings-1024x258.jpg\" alt=\"\" width=\"700\" height=\"176\"></a></p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/10-idea-checkstyle-plugin.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/10-idea-checkstyle-plugin-1024x142.jpg\" alt=\"\" width=\"700\" height=\"97\"></a></p>\n<p style=\"text-align: center;\">(checkstyle-idea插件配置和效果)</p>\n<p>有了自动实时检查，最好还能将IDE的自动格式化与Checkstyle配置文件挂钩，否则自动格式化反倒给你添麻烦了。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/11-idea-format.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/11-idea-format-1024x485.jpg\" alt=\"\" width=\"700\" height=\"332\"></a></p>\n<p style=\"text-align: center;\">(为IDE导入checkstyle配置文件作为自动格式化的依据)</p>\n<p>如果你连自动格式化都懒得按，那可以试试<a href=\"https://github.com/dubreuia/intellij-plugin-save-actions\">Save Actions</a>插件，它可以在Intellij保存文件时自动执行代码格式化等动作。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/12-save-actions.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/12-save-actions-1024x583.jpg\" alt=\"\" width=\"700\" height=\"399\"></a></p>\n<p style=\"text-align: center;\">(这个插件目前对部分文件有些问题，可以通过File path exclusion忽略)</p>\n<h3>总结</h3>\n<ol>\n<li>Code Style影响工作效率，团队应将其当做工程实践予以重视。</li>\n<li>Code Style不能靠人工监督和检查，应该提供端到端的工具支持\n<ul>\n<li>服务端检查（推荐集成到CI的构建步骤中）</li>\n<li>开发环境检查（使用各构建工具的Checkstyle插件）</li>\n<li>自动提交检查（git pre-commit hook与共享）</li>\n<li>IDE增强（checkstyle插件实时可视化反馈/自动的自动格式化！）</li>\n<li>以上的工具都要依据为同一份Checkstyle配置文件，并纳入版本控制</li>\n</ul>\n</li>\n</ol>\n<p>希望以上这些招数可以解救Java Code Style强迫症 ：）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111468\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111468votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111468\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 60</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8df83dd8bc57ae7800dd00484fe81b189041997c.jpg"}
{"url_object_id": "4057d0a4af8aa2f6c9d6dd4716b2d87b", "url": "http://blog.jobbole.com/109943/", "title": "九年游戏开发经验谈", "front_image_url": ["http://wx3.sinaimg.cn/mw690/63918611gy1fgn2pbhpw9j213r0mcwo9.jpg"], "create_date": "2017-06-16", "praise_nums": 6, "fav_nums": 2, "comment_nums": 0, "tags": "职场,游戏,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>【导读】：程序员是一个充满了躁动与焦虑的职业，新人的不断涌入和频繁的跳槽正在不断消磨人们对这个行业的安全感。而我有幸认识了这样一位工程师，他从 08 年就加入育碧上海工作室从事他所热爱的游戏开发。这九年的时间里，他见证了游戏行业的蓬勃发展，开发技术的日新月异，而育碧也见证了他由青涩到成熟，在游戏开发行业中渐渐闯出自己的一番天地。</p>\n<blockquote><p>育碧是全球领先的游戏制作、发行及分销商，创建于1986年。在全球拥有30个工作室，10000名员工。育碧上海工作室是育碧亚太区的核心研发中心。自1996年成立以来，约400位顶尖人才正不断推出高品质3A级端游、页游和手游产品。同时上海工作室也承担着育碧亚太网络数据中心的重要角色。</p></blockquote>\n<p>除了育碧旗下全球畅销游戏作品《刺客信条》、《波斯王子》、《雷曼》、《孤岛惊魂》和《看门狗》，游戏发烧友们一定还知道《我还活着》、《细胞分裂系列》和《彩虹六号：围攻》等等。这些游戏从设计，制作，不断打磨完善，到最终呈现在玩家面前，都离不开游戏开发工程师们的努力，其中就包括曹檬恺。这些脍炙人口的游戏，就是由他和育碧全球各工作室的同事一起，将一行行代码转化为精美的画面，生动的人物，炫酷的操作和流畅的剧情。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgn2pbhpw9j213r0mcwo9.jpg\" width=\"690\" height=\"388\"></p>\n<p>读书期间，曹檬恺就是热爱游戏的众多青年之一，在玩游戏的过程中，他逐渐对游戏开发产生了浓厚的兴趣。被《刺客信条》宣传视频深深震撼的他毅然决定加入育碧。九年时间里，不同的工作角色给了他与众不同的体验。兴趣和责任激励他不断开阔视野，充实自己的技术栈，由初出茅庐成长为技术负责人。</p>\n<p>当被问到有没有考虑过离开育碧的时候，他给了我一个否定答案。曹檬恺告诉我，跳槽并不是程序员的必由之路，选择一个适合自己的公司非常重要。在已过去的九年和未来的职业生涯中，能够和志同道合的人一起做自己热爱的事业，保持学习和成长的状态，体会游戏上线所带来的成就感，对于一名游戏开发工程师来说，是相当享受的一件事。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fgn2pfmwczj213r0mc480.jpg\" width=\"690\" height=\"388\"></p>\n<p>作为“过来人”，对想进入游戏开发领域的新人，或是处于工作迷茫期不知如何做选择的人，曹檬恺分享了自己的经验：</p>\n<h3>兴趣是最好的老师，勇敢追求自己喜欢的事业</h3>\n<p>要坚持做一件事，仅靠毅力还不够，还需要兴趣作为不断探索钻研的动力。在曹檬恺看来，相较于其他类型的软件开发，游戏开发有其独特的魅力。它是创意与技术的结合：在工作中，每天都能接触到最前沿的图形技术，并将其运用到游戏当中，制作出生动有趣的作品。从游戏玩家到参与设计制作游戏，是一个很大的跨越。当真正参与到游戏项目中的时候，能够体会到普通游戏玩家所体会不到的乐趣。尤其是在育碧这种多文化背景的环境下，能与不同职位，来自不同国家工作室的同事们交流，感受思维的碰撞。</p>\n<p>很多人期待加入这个行业，但因为种种原因望而却步，他们缺乏的是把“想”变成“做”的过程。曹檬恺希望更多喜欢游戏的年轻人，以及处于观望状态中的朋友能勇敢迈出这一步，加入到游戏开发的队伍中来。</p>\n<h3>不局限于短期利益，放眼长远发展</h3>\n<p>无论是游戏行业还是其他软件开发行业，进步都不是一两天的功夫。选择了这个职业就等于选择了终身学习。多思考，多积累，由此不断提升自己。相比于一些短期的利益，一个能让人不断成长的工作环境才是至关重要的。</p>\n<p>曹檬恺说，很多人在工作一段时间以后就会感觉遇到了瓶颈，没有了提升的空间，这对个人感受和未来发展都很不利。而他在育碧的九年时间里能一直保持成长的状态主要来源于以下几方面。</p>\n<p>首先，从刚进入工作岗位到成长为团队的负责人，这个过程本身就体现了作为一名程序员良性并且长远的职业发展路径。同时，他的工作角色一直在变化之中，经历了由开发工具维护、引擎维护、功能开发、游戏玩法设计实现等等。不同的角色让他有机会涉猎包括传统软件开发、动画、AI、图形等各种类型的技术，开拓了视野，对自己本身的定位有了更好的认识。其次，游戏项目当中离不开组内所有成员的协作分工，除了每天会和不同职位的人打交道，大型团队中的分工细化也能让开发人员在某一个领域深入钻研，这是选择大公司大团队的一个明显优势。另外，随着各个工作室之间合作的加强，有机会接触到像《刺客信条》《孤岛惊魂》这些最知名的游戏，其代码经过了十几二十年的沉淀，从中可以学到很多东西，磨炼个人技术水平。</p>\n<h3>紧跟潮流，了解行业技术前沿</h3>\n<p>一个尊重技术、紧跟潮流的公司对开发人员有着非常积极的影响。个人的成长与公司产品的成长密不可分。如今的游戏行业，一方面，社交主导的手游正在兴起，另一方面，更高精尖的图形技术和 AI 技术也在不断运用到游戏设计中来。例如游戏中一个非常不起眼的 NPC，从一点移动到另一点的简单过程，也会运用到寻路等算法。又例如在图形技术中，从最早的DX9.0到目前的DX12。这些新技术的运用使玩家获得更丰富的游戏体验。而产品的成功，自然需要开发人员不断吸收新技术，并与现有的产品完美结合。</p>\n<p>除此之外，个人也要多了解游戏行业发展趋势，不仅要学习新技术，还要发现游戏的新玩法新创意，多关注国内外的论坛，大牛的博客，专业的游戏测评网站等等。</p>\n<h3>责任就是动力</h3>\n<p>有些人会觉得参与项目责任越大压力越大，但曹檬恺却认为责任就是动力。在一个项目当中，每个人都有着举足轻重的作用。一款游戏并非从一开始就全部设计完成，只需要工程师按部就班地去实现。在设计师提出需求以后，还要在实现过程中不断打磨，以期带给玩家最棒的游戏体验。在打磨过程中迸发出的新想法，根据个人经验理解所做的技术优化都会为游戏增色不少。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgn2pju4doj213q0myqam.jpg\" width=\"690\" height=\"399\"></p>\n<p>在育碧上海工作室，能接触到大 IP，参与大型游戏开发项目更是难得的机会。在承担其中的部分工作的同时还需要管理团队，这会让自己感受到肩上的责任，努力把任务完成好。当你或是整个项目组为了一款游戏做了很多付出，看到它最终被推向市场，获得玩家的肯定时，这种巨大的成就感是其他事情所不能比拟的。大项目中的技术沉淀也值得每一个技术人员深入探讨研究，从中学习有用的经验。</p>\n<h3>劳逸结合，丰富生活</h3>\n<p>一个轻松愉快的工作氛围能使人全身心投入工作，也能追求工作与生活的平衡。好的项目团队就像一个家，大家的目标都是相同的，为了把游戏做好。工作中要平等交流互相学习，工作之余，同事间也能一起参加各种活动，成为朋友，一起游游泳、踢踢球。朋友多了，运动多了，保持身心愉悦工作自然会越做越好。</p>\n<p>现在很多公司会强调加班文化。曹檬恺坦言，自己也会加班，但不是为了赶工完成任务，而是根据自身情况选择最佳状态完成工作。有些人晚上工作效率会更高，白天的时间会用来完成一些个人的学习，公司给员工更多自由其实对双方都是颇有益处的。</p>\n<p>除了技术上的提升，公司里多一些其他职场相关的培训也很有意义，例如和顶级游戏工作室学习工作方式，针对英语和演讲方面的训练，对自己未来的职业发展非常有帮助。</p>\n<p>最后，曹檬恺用三个词语概括了在育碧的这九年：<strong>笃定、学习和动力</strong>。他对工作的选择、职业的发展规划、学习的方式都为年轻的工程师们提供了宝贵的借鉴意义。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgn2pp75ryj213p0newq8.jpg\" width=\"690\" height=\"407\"></p>\n<p>在 IT 圈人员流动速度快、人心浮躁的大环境下，曹檬恺却对我说，他和同事们都非常享受现在的工作状态，希望继续留在育碧，专心于技术，做玩家喜爱的游戏。育碧上海工作室团队中不乏工作了十年，十五年甚至更长时间的老员工。他也期待更多热爱游戏热爱技术的人加入其中，为育碧注入新鲜的血液。不论你擅长是游戏逻辑编程，UI 编程还是手游，这里都会有你的一片天地。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"109943\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"109943votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"109943\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 33</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.jianshu.com/u/04b72e40cddc\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/37d4eb0422ad391a3cea574bc52cd9a2ec0614ca.jpg"}
{"url_object_id": "d30f567903f1e7312bf578c3ca0c3935", "url": "http://blog.jobbole.com/111491/", "title": "使用 Go 语言来理解 Tensorflow", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/86a72531c8845e07f09b2d42649f2253.jpg"], "create_date": "2017-06-17", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "开发,Go,TensorFlow", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://pgaleone.eu/tensorflow/go/2017/05/29/understanding-tensorflow-using-go/\">P. Galeone</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32467\">雁惊寒</a>   </div><p><em>译者注：本文通过一个简单的Go绑定实例，让读者一步一步地学习到Tensorflow有关ID、作用域、类型等方面的知识。以下是译文。</em></p>\n<p>Tensorflow并不是机器学习方面专用的库，而是一个使用图来表示计算的通用计算库。它的核心是用C++实现的，并且还有不同语言的绑定。Go语言绑定是一个非常有用的工具，它与Python绑定不同，用户不仅可以通过Go语言使用Tensorflow，还可以了解Tensorflow的底层实现。</p>\n<p><strong>绑定</strong></p>\n<p>Tensorflow的开发者正式发布了：</p>\n<ul>\n<li>C++源代码：真正的Tensorflow核心，实现了具体的高级和低级操作。</li>\n<li>Python绑定和Python库：这个绑定是由C++实现自动生成的，这样我们可以使用Python来调用C++函数。此外，这个库将调用融合到了绑定中，以便定义更高级别的API。</li>\n<li>Java绑定。</li>\n<li>Go绑定。</li>\n</ul>\n<p>作为一个Go开发者而不是一个Java爱好者，我开始关注Go绑定，以便了解他们创建了什么样的任务。</p>\n<p><strong>Go绑定</strong></p>\n<div><img class=\"aligncenter\" src=\"http://dl2.iteye.com/upload/attachment/0125/3210/5d4bd576-2c19-330c-aee5-8eb9da01eb3e.png\"></div>\n<div style=\"text-align: center\">地鼠与Tensorflow的徽标</div>\n<p>首先要注意的是，Go API缺少对Variable的支持：该API旨在使用已经训练过的模型，而不是从头开始训练模型。安装Tensorflow for Go的时候已经明确说明了：</p>\n<blockquote><p>TensorFlow提供了可用于Go程序的API。这些API特别适合于加载用Python创建并需要在Go程序中执行的模型。</p></blockquote>\n<p>如果我们对培训ML模型不感兴趣，万岁！相反，如果你对培训模型感兴趣，那就有一个建议：</p>\n<blockquote><p>作为一个真正的Go开发者，保持简单！使用Python定义并训练模型；你可以随时使用Go来加载并使用训练过的模型！</p></blockquote>\n<p>简而言之，go绑定可用于<strong>导入和定义</strong>常量图；在这种情况下，常量指的是没有经过训练的过程，因此没有可训练的变量。</p>\n<p>现在，开始用Go来深入学习Tensorflow吧：让我们来创建第一个应用程序。</p>\n<p>在下文中，我假设读者已经准备好Go环境，并按照<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/README.md\" target=\"_blank\">README</a>中的说明编译并安装了Tensorflow绑定。</p>\n<p><strong>理解Tensorflow结构</strong></p>\n<p>让我们来重复一下什么是Tensorflow：</p>\n<blockquote><p>TensorFlow™是一款使用数据流图进行数值计算的开源软件库。图中的节点表示数学运算，而图的边表示在节点之间传递的多维数据数组（张量）。</p></blockquote>\n<p>我们可以把Tensorflow视为一种描述性语言，这有点像SQL，你可以在其中描述你想要的内容，并让底层引擎（数据库）解析你的查询、检查句法和语义错误、将其转换为内部表示形式、进行优化并计算出结果：所有这一切都会给你正确的结果。</p>\n<p>因此，当我们使用任何一个API时，我们真正做的是描述一个图：当我们把图放到Session中并显式地在Session中运行图时，图的计算就开始了。</p>\n<p>知道了这一点之后，让我们试着来定义一个计算图并在一个Session中进行计算吧。<a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go\" target=\"_blank\">API文档</a>为我们提供了tensorflow（简写为 tf）和op包中所有方法的列表。</p>\n<p>我们可以看到，这两个包包含了我们需要定义和计算图形的所有内容。</p>\n<p>前者包含了构建一个基本的“空”结构（就像Graph本身）的功能，后者是包含由C++实现自动生成绑定的最重要的包。</p>\n<p>然而，假设我们要计算A与x的矩阵乘法，其中</p>\n<div><img class=\"aligncenter\" src=\"http://dl2.iteye.com/upload/attachment/0125/3212/b2aca1f7-5bfc-3c34-a4a3-6e1e640db759.png\"></div>\n<p>我假设读者已经熟悉了tensorflow图定义的基本思想，并且知道占位符是什么以及它们如何工作。下面的代码是对Tensorflow Python绑定的第一次尝试。我们来调用这个文件attempt1.go</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8d0412777567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage main  \r\n  \r\nimport (  \r\n    \"fmt\"  \r\n    tf \"github.com/tensorflow/tensorflow/tensorflow/go\"  \r\n    \"github.com/tensorflow/tensorflow/tensorflow/go/op\"  \r\n)  \r\n  \r\nfunc main() {  \r\n    // 这里，我们打算要: 创建图  \r\n  \r\n    // 我们要定义两个占位符用于在运行的时候传入  \r\n    // 第一个占位符 A 将是一个 [2, 2] 的整数张量  \r\n    // 第二个占位符 x 将是一个 [2, 1] 的整数张量  \r\n  \r\n    // 然后，我们要计算 Y = Ax  \r\n  \r\n    // 创建图的第一个节点： 一个空的节点，位于图的根  \r\n    root := op.NewScope()  \r\n  \r\n    // 定义两个占位符  \r\n    A := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\n    x := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))  \r\n  \r\n    // 定义接收A和x作为输入参数的操作节点  \r\n    product := op.MatMul(root, A, x)  \r\n  \r\n    // 每次我们把一个`Scope`穿给操作符的时候，把操作放在作用域的下面。  \r\n    // 这样，我们有了一个空的作用域（由NewScope创建）：空的作用域是图的根，因此可以用“/”来表示。  \r\n  \r\n    // 现在，我们让tensorflow按照我们的定义来创建图。  \r\n    // 把作用域和OP结合起来，创建具体的图。  \r\n  \r\n    graph, err := root.Finalize()  \r\n    if err != nil {  \r\n        // 这里没办法处理这个错误：  \r\n        // 如果我们错误的定义了图，我们必须手工修改这个定义。  \r\n  \r\n        // 这就跟SQL查询一样：如果查询语句在语法上有问题，我们只能重新写  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    // 如果在这里，图在语法上是正确的。  \r\n    // 我们就可以把它放到一个Session里，并执行。  \r\n  \r\n    var sess *tf.Session  \r\n    sess, err = tf.NewSession(graph, &amp;tf.SessionOptions{})  \r\n    if err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    // 要使用占位符，我们必须创建一个Tensors，这个Tensors包含要反馈到网络的数值  \r\n    var matrix, column *tf.Tensor  \r\n  \r\n    // A = [ [1, 2], [-1, -2] ]  \r\n    if matrix, err = tf.NewTensor([2][2]int64{ {1, 2}, {-1, -2} }); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n    // x = [ [10], [100] ]  \r\n    if column, err = tf.NewTensor([2][1]int64{ {10}, {100} }); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    var results []*tf.Tensor  \r\n    if results, err = sess.Run(map[tf.Output]*tf.Tensor{  \r\n        A: matrix,  \r\n        x: column,  \r\n    }, []tf.Output{product}, nil); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n    for _, result := range results {  \r\n        fmt.Println(result.Value().([][]int64))  \r\n    }  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8d0412777567-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8d0412777567-74\">74</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-2\"><span class=\"crayon-e\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"fmt\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">tf</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"github.com/tensorflow/tensorflow/tensorflow/go\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"github.com/tensorflow/tensorflow/tensorflow/go/op\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-8\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-9\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 这里，我们打算要: 创建图  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我们要定义两个占位符用于在运行的时候传入  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 第一个占位符 A 将是一个 [2, 2] 的整数张量  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 第二个占位符 x 将是一个 [2, 1] 的整数张量  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-15\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 然后，我们要计算 Y = Ax  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-17\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 创建图的第一个节点： 一个空的节点，位于图的根  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-20\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 定义两个占位符  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-24\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 定义接收A和x作为输入参数的操作节点  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">product</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MatMul</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-27\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 每次我们把一个`Scope`穿给操作符的时候，把操作放在作用域的下面。  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 这样，我们有了一个空的作用域（由NewScope创建）：空的作用域是图的根，因此可以用“/”来表示。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-30\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 现在，我们让tensorflow按照我们的定义来创建图。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 把作用域和OP结合起来，创建具体的图。  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-33\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Finalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 这里没办法处理这个错误：  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果我们错误的定义了图，我们必须手工修改这个定义。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-38\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 这就跟SQL查询一样：如果查询语句在语法上有问题，我们只能重新写  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-42\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 如果在这里，图在语法上是正确的。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我们就可以把它放到一个Session里，并执行。  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-45\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sess *</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-47\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SessionOptions</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-51\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 要使用占位符，我们必须创建一个Tensors，这个Tensors包含要反馈到网络的数值  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">column *</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Tensor</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-54\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// A = [ [1, 2], [-1, -2] ]  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewTensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e\">int64</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// x = [ [10], [100] ]  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">column</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewTensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e\">int64</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-63\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Tensor  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Output</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Tensor</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">A</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">column</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Output</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">product</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-v\">int64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8d0412777567-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8d0412777567-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0108 seconds] -->\r\n<p>代码注释的很详细，希望读者能阅读每一行注释。</p>\n<p>现在，Tensorflow-Python用户期望该代码进行编译并正常工作。我们来看看它是否正确：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8df612592412\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngo run attempt1.go</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8df612592412-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8df612592412-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">attempt1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这是他看到的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8e5812571228\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npanic: failed to add operation \"Placeholder\": Duplicate node name in graph: 'Placeholder'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8e5812571228-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8e5812571228-1\"><span class=\"crayon-v\">panic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add </span><span class=\"crayon-i\">operation</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Placeholder\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-e\">node </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Placeholder'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>等等，这里发生了什么？ 显然，存在两个名称都为“Placeholder”的操作。</p>\n<p><strong>第一节课： 节点ID</strong></p>\n<p>每当我们调用一个方法来定义一个操作时，Python API都会生成不同的节点，无论是否已经被调用过。下面的代码返回3。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8e9787037343\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport tensorflow as tf  \r\na = tf.placeholder(tf.int32, shape=())  \r\nb = tf.placeholder(tf.int32, shape=())  \r\nadd = tf.add(a,b)  \r\nsess = tf.InteractiveSession()  \r\nprint(sess.run(add, feed_dict={a: 1,b: 2}))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8e9787037343-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8e9787037343-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8e9787037343-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8e9787037343-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8e9787037343-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8e9787037343-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8e9787037343-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">tensorflow </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tf</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8e9787037343-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8e9787037343-3\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8e9787037343-4\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8e9787037343-5\"><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">InteractiveSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8e9787037343-6\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feed_dict</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>我们可以通过打印占位符的名称来验证此程序是否创建了两个不同的节点：print(a.name，b.name)生成Placeholder:0 Placeholder_1:0，因此，b占位符是Placeholder_1:0，而a占位符是Placeholder:0。</p>\n<p>在Go中，相反，之前的程序会执行失败，因为A和x都命名为Placeholder。我们可以得出这样的结论：</p>\n<p><strong>Go API不会在每次调用函数来定义操作的时候自动生成新的名字：操作的名字是固定的，我们无法修改。</strong></p>\n<p><strong>提问时间：</strong></p>\n<ul>\n<li>关于Tensorflow架构，我们学到了哪些东西？图中的每个节点都必须具有唯一的名称。每个节点都用名称来标识。</li>\n<li>节点的名称与用名字来定义的操作相同吗？是的，但还有更好的答案，不完全是，节点的名称只是操作的一部分。</li>\n</ul>\n<p>为了详细说明第二个答案，我们来解决节点名重复的问题。</p>\n<p><strong>第二节课： 作用域</strong></p>\n<p>正如我们刚刚看到的那样，每定义一个操作时，Python API都会自动创建一个新的名称。在底层，Python API调用类Scope的C++方法WithOpName。以下是方法的文档及其签名，保存在<a href=\"https://github.com/tensorflow/tensorflow/blob/a5b1fb8e56ceda0ee2794ee05f5a7642157875c5/tensorflow/cc/framework/scope.h\" target=\"_blank\">scope.h</a>中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8ed689538140\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/// Return a new scope. All ops created within the returned scope will have\r\n/// names of the form &amp;lt;name&amp;gt;/&amp;lt;op_name&amp;gt;[_&amp;lt;suffix].\r\nScope WithOpName(const string&amp;amp; op_name) const;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8ed689538140-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8ed689538140-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8ed689538140-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8ed689538140-1\"><span class=\"crayon-c\">/// Return a new scope. All ops created within the returned scope will have</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8ed689538140-2\"><span class=\"crayon-c\">/// names of the form &amp;lt;name&amp;gt;/&amp;lt;op_name&amp;gt;[_&amp;lt;suffix].</span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8ed689538140-3\"><span class=\"crayon-e\">Scope </span><span class=\"crayon-e\">WithOpName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">amp</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们注意到，这个用于命名节点的方法返回了一个Scope，因此，节点名实际上是一个Scope。Scope是从根 /（空的图）到op_name的<strong>完整路径</strong>。</p>\n<p>当我们尝试添加一个具有与/到op_name相同路径的节点时，WithOpName方法会添加一个后缀_&lt;suffix&gt;（其中&lt;suffix&gt;是一个计数器），因此它将成为同一范围内的重复的节点。</p>\n<p>知道了这一点之后，为了解决重复节点名的问题，我们期望在Scope类型中找到WithOpName方法。可悲的是，这种方法并不存在。</p>\n<p>相反，查看<a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go/op#Scope\" target=\"_blank\">Scope类型的文档</a>，我们可以看到唯一的一个方法：SubScope，它返回一个新的Scope。</p>\n<p>文档里是这么说的：</p>\n<blockquote><p>SubScope返回一个新的Scope，这将导致添加到图中的所有操作都将以“namespace”为命名空间。如果命名空间与作用域内现有的命名空间冲突，则会添加一个后缀。</p></blockquote>\n<p>使用后缀的冲突管理与C++的WithOpName不同：WithOpName是在操作名之后添加后缀，但还是在同一作用域内（因此占位符变为了Placeholder_1），而Go的SubScope是在作用域名称后添加后缀。</p>\n<p>这种差异会产生完全不同的图，但它们在计算上是等效的。</p>\n<p>我们来改变占位符的定义，以此来定义两个不同的节点，此外，我们来打印一下作用域的名称。</p>\n<p>让我们创建文件attempt2.go，把这几行从：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8f2809056870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nA := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\nx := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8f2809056870-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8f2809056870-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8f2809056870-1\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8f2809056870-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>改成：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8f7008291937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// define 2 subscopes of the root subscopes, called \"input\". In this  \r\n// way we expect to have a input/ and a input_1/ scope under the root scope  \r\nA := op.Placeholder(root.SubScope(\"input\"), tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\nx := op.Placeholder(root.SubScope(\"input\"), tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))  \r\nfmt.Println(A.Op.Name(), x.Op.Name())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8f7008291937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8f7008291937-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8f7008291937-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee8f7008291937-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8f7008291937-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8f7008291937-1\"><span class=\"crayon-c\">// define 2 subscopes of the root subscopes, called \"input\". In this  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8f7008291937-2\"><span class=\"crayon-c\">// way we expect to have a input/ and a input_1/ scope under the root scope  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8f7008291937-3\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SubScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee8f7008291937-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SubScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8f7008291937-5\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>编译并运行：go run attempt2.go，输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8fb990725245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninput/Placeholder input_1/Placeholder</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8fb990725245-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8fb990725245-1\"><span class=\"crayon-v\">input</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Placeholder </span><span class=\"crayon-v\">input_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Placeholder</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><strong>提问时间：</strong></p>\n<p>关于Tensorflow的架构，我们学到了什么？节点完全是由被定义的作用域来标识的。作用域是我们从图的根到达节点的路径。有两种定义节点的方法：在不同的作用域（Go语言）中定义操作或更改操作名称。</p>\n<p>我们解决了重复节点名称的问题，但另一个问题显示在我们的终端上。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee8fe414237245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npanic: failed to add operation \"MatMul\": Value for attr 'T' of int64 is not in the list of allowed values: half, float, double, int32, complex64, complex128</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee8fe414237245-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee8fe414237245-1\"><span class=\"crayon-v\">panic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add </span><span class=\"crayon-i\">operation</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MatMul\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Value </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">attr</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'T'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">int64 </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-v\">values</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">half</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">complex64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">complex128</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>为什么MatMul节点会出现错误？我们只是想增加两个tf.int64矩阵！从这段错误提示来看，int64是MatMul唯一不接受的类型。</p>\n<blockquote><p>int64类型的attr ‘T’的值不在允许的值列表中：half，float，double，int32，complex64，complex128</p></blockquote>\n<p>这个列表是什么？为什么我们可以做两个int32类型矩阵的乘法，而不是int64？</p>\n<p>我们来解决这个问题，了解为什么会出现这种情况。</p>\n<p><strong>第三节课：Tensorflow的类型系统</strong></p>\n<p>我们来看一下<a href=\"https://github.com/tensorflow/tensorflow/blob/r1.2/tensorflow/core/ops/math_ops.cc#L1048\" target=\"_blank\">源代码</a>，寻找MatMul操作的C++声明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee902935593910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nREGISTER_OP(\"MatMul\")  \r\n    .Input(\"a: T\")  \r\n    .Input(\"b: T\")  \r\n    .Output(\"product: T\")  \r\n    .Attr(\"transpose_a: bool = false\")  \r\n    .Attr(\"transpose_b: bool = false\")  \r\n    .Attr(\"T: {half, float, double, int32, complex64, complex128}\")  \r\n    .SetShapeFn(shape_inference::MatMulShape)  \r\n    .Doc(R\"doc(  \r\nMultiply the matrix \"a\" by the matrix \"b\".  \r\nThe inputs must be two-dimensional matrices and the inner dimension of  \r\n\"a\" (after being transposed if transpose_a is true) must match the  \r\nouter dimension of \"b\" (after being transposed if transposed_b is  \r\ntrue).  \r\n*Note*: The default kernel implementation for MatMul on GPUs uses  \r\ncublas.  \r\ntranspose_a: If true, \"a\" is transposed before multiplication.  \r\ntranspose_b: If true, \"b\" is transposed before multiplication.  \r\n)doc\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee902935593910-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee902935593910-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-1\"><span class=\"crayon-e\">REGISTER_OP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MatMul\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"a: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Output</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"product: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transpose_a: bool = false\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transpose_b: bool = false\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"T: {half, float, double, int32, complex64, complex128}\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetShapeFn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">shape_inference</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">MatMulShape</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Doc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">R</span><span class=\"crayon-s\">\"doc(  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-10\"><span class=\"crayon-s\">Multiply the matrix \"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" by the matrix \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\".  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-11\"><span class=\"crayon-s\">The inputs must be two-dimensional matrices and the inner dimension of  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-12\"><span class=\"crayon-s\">\"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" (after being transposed if transpose_a is true) must match the  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-13\"><span class=\"crayon-s\">outer dimension of \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\" (after being transposed if transposed_b is  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-14\"><span class=\"crayon-s\">true).  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-15\"><span class=\"crayon-s\">*Note*: The default kernel implementation for MatMul on GPUs uses  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-16\"><span class=\"crayon-s\">cublas.  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-17\"><span class=\"crayon-s\">transpose_a: If true, \"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" is transposed before multiplication.  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee902935593910-18\"><span class=\"crayon-s\">transpose_b: If true, \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\" is transposed before multiplication.  </span></div><div class=\"crayon-line\" id=\"crayon-594fc2f7ee902935593910-19\"><span class=\"crayon-s\">)doc\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>该行定义了MatMul操作的接口：特别注意到代码里使用了REGISTER_OP宏来声明了op的：</p>\n<ul>\n<li>名称：MatMul</li>\n<li>参数：a，b</li>\n<li>属性（可选参数）：transpose_a，transpose_b</li>\n<li>模板T支持的类型：half，float，double，int32，complex64，complex128</li>\n<li>输出形状：自动推断</li>\n<li>说明文档</li>\n</ul>\n<p>这个宏调用不包含任何C++代码，但它告诉我们，在定义一个操作时，尽管它使用了模板，但是我们必须为指定的类型T（或属性）指定一个类型列表中的类型。实际上，属性.Attr(“T: {half, float, double, int32, complex64, complex128}”)是将类型T约束为该列表的一个值。</p>\n<p>我们可以从教程中阅读到，即使在使用模板T时，我们也必须对每个支持的重载显式地注册内核。内核是以CUDA方式对C/C++函数进行的引用，这些函数将会并行执行。</p>\n<p>因此，MatMul的作者决定仅支持上面列出的类型，而不支持int64。有两个可能的原因：</p>\n<ul>\n<li>疏忽了：这很有可能，因为Tensorflow的作者是人类！</li>\n<li>对尚未完全支持int64操作的设备兼容，因此内核的这种具体实现不足以在每个支持的硬件上运行。</li>\n</ul>\n<p>回到刚才的错误提示：修改方法是显而易见的。我们必须将参数以支持的类型传递给MatMul。</p>\n<p>我们来创建attempt3.go，把所有引用int64的行改为int32。</p>\n<p>有一点需要注意：Go绑定有自己的一组类型，与Go的类型的一一对应。当我们将值输入到图中时，我们必须关注映射关系。从图形中获取值时，必须做同样的事情。</p>\n<p>执行go run attempt3.go。结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fc2f7ee907494945820\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninput/Placeholder input_1/Placeholder  \r\n[[210] [-210]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fc2f7ee907494945820-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fc2f7ee907494945820-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fc2f7ee907494945820-1\"><span class=\"crayon-v\">input</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Placeholder </span><span class=\"crayon-v\">input_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Placeholder</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fc2f7ee907494945820-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">210</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">210</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>万岁！</p>\n<p><strong>提问时间</strong></p>\n<p>关于Tensorflow的架构，我们学到了什么？每个操作都与自己的一组内核相关联。被视为描述性语言的Tensorflow是一种强大的类型语言。它不仅要遵守C++类型规则，而且还要在op的注册阶段只实现某些指定类型的能力。</p>\n<p><strong>结论</strong></p>\n<p>使用Go来定义并执行一个图，使我们有机会更好地了解Tensorflow的底层结构。使用试错法，我们解决了这个简单的问题，我们一步一步地学到了有关图、节点和类型系统这些新东西。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111491\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111491votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111491\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5c3e802fa7c46fa53f8411355279d527314c20be.jpg"}
{"url_object_id": "0f1644704be43e7b1d23c82609dce19c", "url": "http://blog.jobbole.com/111486/", "title": "通过机器学习来自动调优 DBMS，让任何人都可以部署数据库管理系统", "front_image_url": ["https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2017/05/31/ottertune_1.gif"], "create_date": "2017-06-17", "praise_nums": 1, "fav_nums": 0, "comment_nums": 0, "tags": "IT技术,OtterTune,数据库,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://aws.amazon.com/cn/blogs/ai/tuning-your-dbms-automatically-with-machine-learning/\">AWS</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><em>本文是卡耐基梅隆大学的 Dana Van Aken、Andy Pavlo 和 Geoff Gordon 所写。这个项目展示了学术研究人员如何利用 AWS Cloud Credits for Research Program 来助力他们的科技突破的。</em></p>\n<p>数据库管理系统（DBMS）是任何数据密集应用的关键部分。它们可以处理大量数据和复杂的工作负载，但同时也难以管理，因为有成百上千个“旋钮”（即配置变量）控制着各种要素，比如要使用多少内存做缓存和写入磁盘的频率。组织机构经常要雇佣专家来做调优，而专家对很多组织来说太过昂贵了。<a href=\"http://db.cs.cmu.edu/projects/autotune/\">卡耐基梅隆大学数据库研究组</a>的学生和研究人员在开发一个新的工具，名为 OtterTune，可以自动为 DBMS 的“旋钮”找到合适的设置。工具的目的是让任何人都可以部署 DBMS，即使没有任何数据库管理专长。</p>\n<p>OtterTune 跟其他 DBMS 设置工具不同，因为它是利用对以前的 DBMS 调优知识来调优新的 DBMS，这显著降低了所耗时间和资源。OtterTune 通过维护一个之前调优积累的知识库来实现这一点，这些积累的数据用来构建机器学习（ML）模型，去捕获 DBMS 对不同的设置的反应。OtterTune 利用这些模型指导新的应用程序实验，对提升最终目标（比如降低延迟和增加吞吐量）给出建议的配置。</p>\n<p>本文中，我们将讨论 OtterTune 的每一个机器学习流水线组件，以及它们是如何互动以便调优 DBMS 的设置。然后，我们评估 OtterTune 在 MySQL 和 Postgres 上的调优表现，将它的最优配置与 DBA 和其他自动调优工具进行对比。</p>\n<p>OtterTune 是卡耐基梅隆大学数据库研究组的学生和研究人员开发的开源工具，所有的代码都托管在 <a href=\"https://github.com/cmu-db/ottertune\">Github</a> 上，以 Apache License 2.0 许可证发布。</p>\n<h2>OtterTune工作原理</h2>\n<p>下图是 OtterTune 组件和工作流程</p>\n<p><img class=\"size-full wp-image-835 alignnone\" src=\"https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2017/05/31/ottertune_1.gif\" alt=\"\" width=\"800\" height=\"319\"></p>\n<p>调优过程开始，用户告知 OtterTune 要调优的最终目标（比如，延迟或吞吐量），客户端控制器程序连接目标 DBMS，收集 Amazon EC2 实例类型和当前配置。</p>\n<p>然后，控制器启动首次观察期，来观察并记录最终目标。观察结束后，控制器收集 DBMS 的内部指标，比如 MySQL 磁盘页读取和写入的计数。控制器将这些数据返回给调优管理器程序。</p>\n<p>OtterTune 的调优管理器将接收到的指标数据保存到知识库。OtterTune 用这些结果计算出目标 DBMS 的下一个配置，连同预估的性能提升，返回给控制器。用户可以决定是否继续或终止调优过程。</p>\n<p> </p>\n<h3>注意</h3>\n<p>OtterTune 对每个支持的 DBMS 版本维护了一份“旋钮”黑名单，包括了对调优无关紧要的部分（比如保存数据文件的路径），或者那些会产生严重或隐性后果（比如丢数据）的部分。调优过程开始时，OtterTune 会向用户提供这份黑名单，用户可以添加他们希望 OtterTune 避开的其它“旋钮”。</p>\n<p>OtterTune 有一些预定假设，对某些用户可能会造成一定的限制。比如，它假设用户拥有管理员权限，以便控制器来修改 DBMS 配置。否则，用户必须在其他硬件上部署一份数据库拷贝给 OtterTune 做调优实验。这要求用户或者重现工作负载，或者转发生产 DBMS 的查询。完整的预设和限制请看我们的<a href=\"http://db.cs.cmu.edu/papers/2017/tuning-sigmod2017.pdf\">论文</a> 。</p>\n<h1>机器学习流水线</h1>\n<p>下图是 OtterTune ML流水线处理数据的过程，所有的观察结果都保存在知识库中。</p>\n<p>OtterTune 先将观察数据输送到“工作流特征化组件”（Workload Characterization component），这个组件可以识别一小部分 DBMS 指标，这些指标能最有效地捕捉到性能变化和不同工作负载的显著特征。</p>\n<p>下一步，“旋钮识别组件”（Knob Identification component）生成一个旋钮排序表，包含哪些对 DBMS 性能影响最大的旋钮。OtterTune 接着把所有这些信息“喂”给自动调优器（Automatic Tuner），后者将目标 DBMS 的工作负载与知识库里最接近的负载进行映射，重新使用这份负载数据来生成更佳的配置。</p>\n<p><img class=\"size-full wp-image-836 alignnone\" src=\"https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2017/05/31/ottertune_2.gif\" alt=\"\" width=\"613\" height=\"193\"></p>\n<p>我们来深入挖掘以下机器学习流水线的每个组件。</p>\n<p><strong>工作负载特征化</strong>： OtterTune 利用 DBMS 的内部运行时指标来特征化某个工作负载的行为，这些指标精确地代表了工作负载，因为它们捕获了负载的多个方面行为。然而，很多指标是冗余的：有些是用不同的单位表示相同的度量值，其他的表示 DBMS 的一些独立组件，但它们的值高度相关。梳理冗余度量值非常重要，可以降低机器学习模型的复杂度。因此，我们基于相关性将 DBMS 的度量值集中起来，然后选出其中最具代表性的一个，具体说就是最接近中间值的。机器学习的后续组件将使用这些度量值。</p>\n<p><strong>旋钮识别</strong>： DBMS 可以有几百个旋钮，但只有一部分影响性能。OtterTune 使用一种流行的“特性-选择”技术，叫做 Lasso，来判断哪些旋钮对系统的整体性能影响最大。用这个技术处理知识库中的数据，OtterTune 得以确定 DBMS 旋钮的重要性顺序。</p>\n<p>接着，OtterTune 必须决定在做出配置建议时使用多少个旋钮，旋钮用的太多会明显增加 OtterTune 的调优时间，而旋钮用的太少则难以找到最好的配置。OtterTune 用了一个增量方法来自动化这个过程，在一次调优过程中，逐步增加使用的旋钮。这个方法让 OtterTune 可以先用少量最重要的旋钮来探索并调优配置，然后再扩大范围考虑其他旋钮。</p>\n<p><strong>自动调优器</strong>： 自动调优器组件在每次观察阶段后，通过两步分析法来决定推荐哪个配置。</p>\n<p>首先，系统使用工作负载特征化组件找到的性能数据来确认与当前的目标 DBMS 工作负载最接近的历史调优过程，比较两者的度量值以确认哪些值对不同的旋钮设置有相似的反应。</p>\n<p>然后，OtterTune 尝试另一个旋钮配置，将一个统计模型应用到收集的数据，以及知识库中最贴近的工作负载数据。这个模型让 OtterTune 预测 DBMS 在每个可能的配置下的表现。OtterTune 调优下一个配置，在探索（收集用来改进模型的信息）和利用（贪婪地接近目标度量值）之间交替进行。</p>\n<h2>实现</h2>\n<p>OtterTune 用 Python 编写。</p>\n<p>对于工作负载特征化和旋钮识别组件，运行时性能不是着重考虑的，所以我们用 <a href=\"http://scikit-learn.org/\">scikit-learn</a> 实现对应的机器学习算法。这些算法运行在后台进程中，把新生成的数据吸收到知识库里。</p>\n<p>对于自动调优组件，机器学习算法就非常关键了。每次观察阶段完成后就需要运行，吸收新数据以便 OtterTune 挑选下一个旋钮来进行测试。由于需要考虑性能，我们用 <a href=\"https://www.tensorflow.org/\" target=\"_blank\" rel=\"noopener noreferrer\">TensorFlow</a> 来实现。</p>\n<p>为了收集 DBMS 的硬件、旋钮配置和运行时性能指标，我们把 <a href=\"https://github.com/oltpbenchmark/oltpbench\" target=\"_blank\" rel=\"noopener noreferrer\">OLTP-Bench</a> 基准测试框架集成到 OtterTune 的控制器内。</p>\n<h2>实验设计</h2>\n<p>我们比较了 OtterTune 对 MySQL 和 Postgres 做出的最佳配置与如下配置方案进行了比较，以便评估：</p>\n<ul>\n<li>默认： DBMS 初始配置</li>\n<li>调优脚本： 一个开源调优建议工具做出的配置</li>\n<li>DBA： 人类 DBA 选择的配置</li>\n<li>RDS： 将亚马逊开发人员管理的 DBMS 的定制配置应用到相同的 EC2 实例类型。</li>\n</ul>\n<p>我们在<a href=\"https://aws.amazon.com/cn/ec2/spot/\">亚马逊 EC2 竞价实例</a>上执行了所有的实验。每个实验运行在两个实例上，分别是m4.large 和 m3.xlarge 类型：一个用于 OtterTune 控制器，一个用于目标 DBMS 部署。OtterTune 调优管理器和知识库部署在本地一台 20 核 128G 内存的服务器上。</p>\n<p>工作负载用的是 <a href=\"http://www.tpc.org/tpcc/\" target=\"_blank\" rel=\"noopener noreferrer\">TPC-C</a>，这是评估联机交易系统性能的工业标准。</p>\n<h2>评估</h2>\n<p>我们给每个实验中的数据库 —— MySQL 和 Postgres —— 测量了延迟和吞吐量，下面的图表显示了结果。第一个图表显示了“第99百分位延迟”的数量，代表“最差情况下”完成一个事务的时长。第二个图表显示了吞吐量结果，以平均每秒执行的事务数来衡量。</p>\n<h2>MySQL 实验结果</h2>\n<p><img class=\"alignnone size-full wp-image-837\" src=\"https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2017/05/31/ottertune_3.gif\" alt=\"\" width=\"641\" height=\"281\"></p>\n<p>OtterTune 生成的最佳配置与调优脚本和 RDS 的配置相比，OtterTune 让 MySQL 的延迟下降了大约 60%，吞吐量提升了 22% 到 35%。OtterTune 还生成了一份几乎跟 DBA 一样好的配置。</p>\n<p>在 TPC-C 负载下，只有几个 MySQL 的旋钮显著影响性能。OtterTune 和 DBA 的配置给这几个旋钮设置了很好的值。RDS 表现略逊一筹，因为给一个旋钮配置了欠佳的值。调优脚本表现最差，因为只修改一个旋钮。</p>\n<h2>Postgres 实验结果</h2>\n<p><img class=\"alignnone size-full wp-image-838\" src=\"https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2017/05/31/ottertune_4.gif\" alt=\"\" width=\"630\" height=\"254\"></p>\n<p>在延迟方面，相比 Postgres 默认配置，OtterTune、调优工具、DBA 和 RDS 的配置获得了近似的提升。我们大概可以把这归于 OLTP-Bench 客户端和 DBMS 之间的网络开销。吞吐量方面，Postgres 在 OtterTune 的配置下比 DBA 和调优脚本要高 12%，比 RDS 要高 32%。</p>\n<h2>结束语</h2>\n<p>OtterTune 将寻找 DBMS 配置旋钮的最优值这一过程自动化了。它通过重用之前的调优过程收集的训练数据，来调优新部署的 DBMS。因为 OtterTune 不需要生成初始化数据集来训练它的机器学习模型，调优时间得以大大减少。</p>\n<p>下一步会怎么样？ 为了顺应的越来越流行的 DBaaS （远程登录 DBMS 主机是不可能的），OtterTune 会很快能够自动探查目标 DBMS 的硬件能力，而不需要远程登录。</p>\n<p>想了解 OtterTune 的详细资料，请查看我们的<a href=\"http://db.cs.cmu.edu/papers/2017/tuning-sigmod2017.pdf\">论文</a>和 <a href=\"https://github.com/cmu-db/ottertune\">GitHub 上的代码</a>。关注这个<a href=\"http://ottertune.cs.cmu.edu/\">网站</a>，我们将很快让 OtterTune 成为一个在线调优服务。</p>\n<hr>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/bb6b0431912b5b441aac6477e67bd0d22.png\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/381b4bd995d3cff3c32be73b9d0571b82.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111486\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111486votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111486\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/upanblack\">Panblack</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/upanblack\">\r\n\t\t\t<img src=\"http://tp4.sinaimg.cn/1611865122/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            挺老的Linux新手        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/upanblack\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/upanblack/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/upanblack/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 36</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.cnblogs.com/panblack\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/panblack\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"http://github.com/panblack\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6b71dd8cb7b56ba90079b35343c571c0236eb5fb.jpg"}
{"url_object_id": "44d75eb058214ff58a5b9fe0dccb16bd", "url": "http://blog.jobbole.com/108195/", "title": "我给你钱，你帮我改好不好？", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fgjcurlsj2j20ka0d8t9t.jpg"], "create_date": "2017-06-13", "praise_nums": 5, "fav_nums": 5, "comment_nums": 7, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/4e4e41e1eecc\">乔兰伊雪</a>   </div><div>\n<h3>一、</h3>\n<p>七点左右，我下班回家的路上收到一条消息，是一个初入职场的同行发过来的。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fgjcurlsj2j20ka0d8t9t.jpg\" width=\"580\" height=\"378\"></p>\n<p>其实他也不算初入职场，去年他就毕业工作了，那个时候我在上家公司工作比较轻松，每天都会到论坛逛逛，时不时写一些小功能发到网上共享，也会帮别人解决一些问题。</p>\n<p>他看到了我的代码，就加了我，说是以后有问题就向我请教，后来就杳无音讯。直到前阵子联系我帮他写一个功能，我才知道他因为家里原因大半年没上班，最近才开始工作。</p>\n<p>他问我，有没有做过扫描二维码或者条形码的功能？</p>\n<p>我想了想，去年好像写过这个功能，就跟他说明天帮他找找这份代码。</p>\n<p>然后回家，吃了饭下楼散步，又收到他的消息。</p>\n<p>可是我现在就得实现这个功能啊？</p>\n<p><b>我有些无奈，你现在要实现这个功能，与我何干？这语气好像是你着急要这个功能，我就必须要帮你实现似的。</b></p>\n<p><b>小伙子，没有人有义务帮你做任何事情，何况还是素不相识的陌生人。</b></p>\n<p>谁让我这么心软呢，最后还是找到我去年写的那份代码的下载链接发给他，让他试试看能不能用。</p>\n<p>过了一会，他说，可以用，我从网上也下了一些demo，但是想把中间的正方形扫描框改成长方形的，却找来找去不知道怎么改。你有时间吗，我给你钱，你帮我改好不好？</p>\n<p>心里莫名升起一把火，代码都给你了，就是把正方形改成长方形都还要花钱让别人改，你是钱多得没处使么？</p>\n<p>我说我在外面，没法帮他改，我的代码注释都很清楚，让他自己找找改一下，又从网上找了一篇教程发给他，让他看着改。</p>\n<p>他的心情估计也很无奈，说，好吧，那我试试看。</p>\n<p>他找到了我设置扫描框的代码，截图给我看，却依然不知该怎么修改。</p>\n<p>我已经不知道该怎么跟他说了，只能跟他说你总得自己试着成长，不能一有问题就找别人帮你写。</p>\n<p>他说，好吧，我看看。</p>\n<p>第二天一早，我问他改好了么。他肯能在忙，直到下午才回复我说改好了，并对我表示感谢。</p>\n<p><b>这不就挺好么，不试一试又怎么知道自己不行呢？遇到事情不能过分的依赖别人，也不是所有的事情都可以用钱来解决，最好能自己解决的就自己解决，这样才能快速成长起来。</b></p>\n<h4>不是所有的路别人都可以帮你走 ，有些路是需要你独自前行的。</h4>\n<h3>二</h3>\n<p>我想，应该有很多这种初入职场的菜鸟，好不容易找到工作，自己却无法按时完成任务，而不得不四处求人帮忙，甚至花钱让别人帮他写以完成任务，保住饭碗。</p>\n<p>当然，刚入职时为了不耽误项目进度，这样做也不失为一种解决办法，但长期如此就是职业道德问题了，但愿这位小伙子能够靠自己能力胜任这份工作。</p>\n<p>我曾在某平台发过帖子咨询大家对于工作完不成，花钱买代码的行为的看法。</p>\n<p>有人表示不可思议，居然有人会这么做，也有一部分人表示自己身边就有这样的人，甚至自己就曾经被某大型软件公司一位工程师以低薪聘请，专职为那位工程师写代码，结果可想而知，被公司发现后，那位工程师被开除，他也失业了。</p>\n<p><b>想来这样长期靠买代码完成工作的人，大概下场都不会很好吧。</b><br>\n<img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgjcur1snfj20go09d3yo.jpg\" width=\"580\" height=\"326\"></p>\n</div>\n<p><b>我并不是想说菜鸟有多么笨，多么不可教，也不是想要讽刺谁，我只是希望他们能变得更好。</b></p>\n<p>毕竟我也是从菜鸟过来的，我懂得在工作中无法实现某个功能时，身边又没有大神可问的的那种焦急无奈的心情。但是万事开头难，遇到问题总得自己先试着去解决，去百度，去论坛贴吧看别人的经验帖。</p>\n<p>要知道你遇到的问题百分之九十九的程序员都曾遇到过，还有百分之一是天才，在写代码之前就能预见到各种可能出现的问题，然后规避错误。但绝大多数人都还是普通人，通过自己的努力实现某个功能，解决某个问题，并且愿意无偿将自己的经验和代码分享出来，避免大家重复造轮子。</p>\n<p>关键在于你是否能从偌大的信息库中找到跟你想要实现的功能相似的帖子和代码，并总结他人经验，转化成自己的能力，一步步提升自己，摆脱菜鸟的标签。</p>\n<p>但如果一遇到问题，甚至是很简单的问题就花钱让别人帮你写，你的工作是保住了，那么你的能力呢，又何时才能有提升？难不成就一直花钱让别人帮你写，自己实现一些简单的功能，那么你的职业生涯又能维持多久呢？</p>\n<p>我在上家公司曾招过一名实习生，因不服气学长通过培训编程找到一份高薪工作就到处吹牛，觉得自己不比他差，凭着不服输的劲儿自学成才。大部分功能他都能独立实现，甚至有些知识点比我们这些老程序员都了解的透彻，平常工作根本不需要别人指点，即便遇到问题也能自己查资料解决，或者一点就通。</p>\n<p>同样是初入职场的新人，为什么差距这么大呢？</p>\n<p>也许有人说，这跟天赋、能力有关，可是笨鸟先飞啊，你如果觉得自己天赋不太好，那就要付出比别人更多的努力去弥补先天不足。</p>\n<p>也许又有人说了，你怎么知道别人没有付出努力？对，我确实不能说他没付出努力，他也是天天加班，平常完不成的工作六日补回来，但用功不在点子上也是徒劳。而且他每次找我从来都不是问我某个功能怎么实现，原理是什么，而是直接问我实现这个功能要多少钱，你帮我写好，我给你钱。</p>\n<p><b>当然，从我的层面上来说，这对我来说没什么坏处，反而能得一份外快，我又何乐而不为呢？可我觉得，长此以往不是帮他，而是害了他</b>。</p>\n<blockquote><p>3</p></blockquote>\n<p><b>一份工作，如果你努力了，付出了，仍然感到费力，还不如换一份，要相信天生我材必有用，总会有适合你那一份。</b></p>\n<p>并不是所有的人都适合编程，有些人天生就爱编程，编程就像流淌在他身体里的血液，是他的生命，他的一切，这种人可遇不可求。</p>\n<p>而大部分人只是把编程当作职业，一份养家糊口的工作，其中也不乏因为职业而爱上编程，将自己的时间都贡献在开发大业上，成为万人敬仰的大神。</p>\n<p>我并不属于他们中的一员，也不是大神，走上编程之路也并非我的本意，只是迫于生计寻找一份高薪工作而已。</p>\n<p>我的工作和生活完全分开，力求在工作时间内完成任务，并有余力提升自己不至于被淘汰。下班之后不谈工作，甚至不摸电脑，事实上我一直都没买电脑。</p>\n<p>可能有人觉得一个程序员居然没有电脑很不可思议，那我可能是个奇葩。也许我是属于程序员中不求上进的那种，只求完成本职工作，不愿为编程贡献自己的业余时间，但起码我有能力完成我的工作。</p>\n<p>但有一部分人，当初可能是被忽悠，也可能是看上程序员的高薪，入了坑，学得很吃力也很用功，走上工作岗位后依然不能胜任，为了这个饭碗苦苦挣扎，把自己弄的心力交瘁。</p>\n<p>既然这么辛苦，为什么不换一份工作？</p>\n<p>肯定会有人说我站着说话不腰疼，换工作哪有那么容易，现在工作这么不好找。可是即便你那么努力的坚持下去，又能坚持多久？</p>\n<p>公司迟早会发现你的能力不适合这份工作，你还是要面临重新找工作风险，那么你之前的坚持又有何意义？何不趁早转行，也许你就能找到适合自己的工作，在你的岗位上发光发热。</p>\n<p>在写这篇文章的时候，朋友跟我说这篇文章发出去肯定会有很多人对号入座，触犯了很多人的利益，会有很多人骂我，但这是一种不良的社会现象，总得有人敢于直言，只有戳到了痛处，才会有反思。</p>\n<p>不光是程序员，各行各业都会有不适合该行业的人在生死边缘挣扎，我还是希望每个人都能对自己负责，反思自己是否适合从事某份工作，如果不适合一定要及时悬崖勒马，换一个方向也许就海阔天空。</p>\n<h4>人生苦短，何必在没有希望的路上浪费精力？</h4>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"108195\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"108195votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"108195\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/93c5357a5f9cfa4a19bfcde8644db2d5f7712cc6.jpg"}
{"url_object_id": "8f86159a04608f8daae91ab61b818f76", "url": "http://blog.jobbole.com/111458/", "title": "2017 年最佳开源网络监控工具", "front_image_url": ["https://static.oschina.net/uploads/space/2017/0610/222601_ElXA_2894582.jpg"], "create_date": "2017-06-13", "praise_nums": 1, "fav_nums": 6, "comment_nums": 0, "tags": "工具与资源,开源,网络监控", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.computerworlduk.com/galleries/open-source/best-open-source-network-management-tools-3644057/\">Christina Mercer</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/best-open-source-network-monitoring-tools-2017\">开源中国</a>   </div><p>对开源软件的需求持续增长，网络管理工具已经适应了这一浪潮。你不再需要为可能不是你所需的软件支付小额的费用，请留意下（大部分）免费的开源工具，用来监控、配置和映射你的联网设备。</p>\n<p>这里有 14 个开源网络监控工具来协助IT管理员完成工作。</p>\n<h3><strong>1. 开源网络监控工具： NetXMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/222601_ElXA_2894582.jpg\"></p>\n<p><a href=\"https://www.netxms.org/\" target=\"_blank\" rel=\"nofollow\">NetXMS</a> 提供了企业级开源网络管理和监控程序，它在Windows和Linux上有一个简单的用户界面。<br>\nNetXMS通过相对简单的安装过程为IT基础架构的所有层提供了分布式网络监控、自动化网络发现和详细报告。<br>\n此外，服务器设备和代理对于这样一个全面的产品来说是相当轻量级的。</p>\n<h3><strong>2. 开源网络监控工具: Pandora FMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225036_iqEA_2894582.jpg\"></p>\n<p>定位于企业级， <a href=\"https://pandorafms.com/monitoring-solutions/network-monitoring/\" target=\"_blank\" rel=\"nofollow\">Pandora FMS</a> 提供了一个时尚且整洁的用户体验，提供了易于阅读的快速洞察工具以及重要的网络统计信息，例如网络状态、已上报的告警、已部署的代理数量和其他最近执行任务的列表。</p>\n<p>Pandora FMS可以在无需外部访问的情况下执行网络诊断，这意味着用户可以更快地响应任何网络问题。事实上，FMS声称，在代理模式下的器监控系统响应速度约为10秒。</p>\n<h3><strong>3. 开源网络监控工具: Cacti</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225046_S2NE_2894582.jpg\"></p>\n<p>最初发布于2001年，<a href=\"http://www.cacti.net/\" target=\"_blank\" rel=\"nofollow\"> Cacti</a> 是一款开源的基于Web的网络监控和专为数据记录而设计的图形化工具。它可以用于实时显示网络数据，如CPU负载或带宽利用率。</p>\n<p>Cacti是RRDtool的前端应用程序，RRDtool是一种用于存储实时变化数据的开源数据库工具，其使用SNMP作为其默认收集算法，但如果你喜欢本地Perl的PHP脚本，那么你也可以使用它们。</p>\n<p>其最新版本0.8.8h于2016年5月发布，主要功能包括无限图形项目、图形自动填充支持、图形数据处理、自定义数据采集脚本、内置SNMP支持、图形模板、数据源模板、主机模板和基于用户的管理。</p>\n<h3><strong>4. 开源网络监控工具: GroundWork Monitor Core</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225056_4gdH_2894582.jpg\"></p>\n<p><a href=\"https://www.gwos.com/\" target=\"_blank\" rel=\"nofollow\">GroundWork Monitor Core</a> 是监控网络、应用和云计算使用情况的平台。开源版本包含最多可监控50个设备和基于社区的支持的许可证，该软件还有其对应的商业版本。</p>\n<p>在其网络管理功能方面，GroundWork提供网络和设备的自发现和维护、拓扑、报警控制、通过API/SNMP/IPMI的数据收集和对OpenDaylight SDN的支持等功能。</p>\n<p>GroundWork还提供了存储管理，支持大规模的企业级供应商，如NetApp和EMC，以及从磁盘、块或对象存储的数据收集和存储缓冲以及中断可视化。<br>\n由于GroundWork的一站式网络管理方法，这种套件可能更适合那些寻找成熟品牌的大型商业和企业，而不是以开发人员为重点的工具，如Big Brother或Big Sister。</p>\n<h3><strong>5. 开源网络监控工具：Hyperic</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225111_6poD_2894582.jpg\"></p>\n<p>VMware的<a href=\"http://www.vmware.com/products/vrealize-hyperic.html\" target=\"_blank\" rel=\"nofollow\">Hyperic</a>工具用于在物理、虚拟或云环境下监控Web应用程序及其性能。 它适用于应用程序服务器，web服务器，数据库，操作系统，虚拟机管理程序，消息传递服务和目录服务器。</p>\n<p>Hyperic提供基础架构和操作系统监控，详细的报告，应用程序和中间件监控，警报和修复工作流程以及通用可扩展的API。</p>\n<p>该网络监控工具提供了企业版本，可以提高网络警报功能，并且能更好地创建基准。</p>\n<h3><strong>6. 开源网络监控工具: Observium</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225121_LLdQ_2894582.jpg\"></p>\n<p>基于Linux的<a href=\"http://www.observium.org/\" target=\"_blank\" rel=\"nofollow\">Observium</a>是一个自动监测的网络监控工具。 据该网站介绍，“该工具是由一批经验丰富的专业网络工程师和系统管理员开发和维护的，Observium是一个由用户自己设计和构建的平台。”</p>\n<p>Observium提供社区版本和专业版，使用RRDTool进行缓冲存储和图形化功能，并具有易于使用的用户界面和报告功能。 但是，它没有报告导出功能，这可能对商务应用来讲会是一个问题。</p>\n<p>社区版本将为用户提供对所有支持设备或指标的完整自动监测功能，通过自动发现协议进行网络映射，自动识别数百种设备，并且每六个月发布一个新版本。</p>\n<p>而专业版用户将获得所有社区版本的功能并且还将获得实时软件更新和修复功能，基于规则的自动分组功能，网络阈值和状态警报系统以及流量统计系统。</p>\n<h3><strong>7. 开源网络监控工具: Zabbix</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225227_Aw2c_2894582.jpg\"></p>\n<p><a href=\"http://www.zabbix.com/\" target=\"_blank\" rel=\"nofollow\">Zabbix</a> 作为企业级的网络监控工具，通过从服务器，虚拟机和网络设备收集的数据提供实时监控，自动发现，映射和可扩展等功能。</p>\n<p>Zabbix的企业级监控软件为用户提供内置的Java应用服务器监控，硬件监控，VMware监控和CPU，内存，网络，磁盘空间性能监控。</p>\n<p>该企业级网络监控工具能够每分钟进行 3,000,000 次检查，具有更高的安全性和数据中心监控功能。</p>\n<h3><strong>8. 开源网络监控工具: Nagios</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225235_kIpK_2894582.jpg\"></p>\n<p><a href=\"https://www.nagios.org/\" target=\"_blank\" rel=\"nofollow\">Nagios</a> 是一款用于监控IT基础架构和查看当前状态、历史日志和基本报告的开源软件工具。 Nagios 用户可以监控系统指标，网络协议，应用程序，服务器，网络基础架构和接收故障警报。</p>\n<p>Nagios提供三种类型的网络管理工具，Nagios XL，Nagios日志服务器和Nagios网络分析器。其中 Nagios XL 最适合网络监控（尽管其他两种也提供网络监控服务）。</p>\n<p>Nagios XL提供企业级网络监控，为用户提供带宽报告，网络心跳监控，自定义URL，电子邮件报告和远程机器监控。 升级的企业版提供基于Web的服务器控制台访问，业务流程监控，记录审核和自动化删除功能。</p>\n<h3><strong>9. 开源网络监控工具: NetDisco</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225246_lLsB_2894582.jpg\"></p>\n<p><a href=\"https://metacpan.org/pod/App::Netdisco\" target=\"_blank\" rel=\"nofollow\">NetDisco</a>专为类 Unix 操作系统而设计，通过NSMP提供基于网络的自动发现网络设备的功能，从而生成网络拓扑图。它是专为中型到大型网络而设计的。</p>\n<p>该网络管理工具可用于定位设备，创建设备目录并报告IP地址和交换机端口使用情况。</p>\n<p>NetDisco用户可以通过MAC或IP在网络上定位机器，关闭交换机端口，或更改端口的VLAN或PoE状态，按照型号，供应商，软件和操作系统对网络硬件进行清点，并给你的网络创建一个详细的拓扑图。</p>\n<h3></h3>\n<h3><strong>10. 开源网络监控工具: OpenNMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225255_FOmY_2894582.jpg\"></p>\n<p><a href=\"https://www.opennms.org/en\" target=\"_blank\" rel=\"nofollow\">OpenNMS</a>是在1999年发布的，旨在为大型企业级用户提供事件管理，服务监控和性能测量。</p>\n<p>使企业用户受益的主要特点包括外部脚本、向通话系统工程师发送警报、扩展Java本机通知策略API、请求跟踪（RT）集成、高级警报、IPv4和IPv6网络可达性超过ICMP、测试状态和节点库存信息。</p>\n<p>企业服务或是“风格”网络提供预置事件，通知，数据收集，工作流和附加报告等功能。</p>\n<h3><strong>11. 开源网络监控工具：RANCID</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225304_sbWJ_2894582.jpg\"></p>\n<p><a href=\"http://www.shrubbery.net/rancid/\" target=\"_blank\" rel=\"nofollow\">RANCID</a> 听起来像一个消极的名字，除非你学会Really Awesome New Cisco的配置。这一点意味着它能监视路由器或其他设备的配置，并维护任何更改过的历史记录。RANCID 支持很多供应商设备，包括 Juniper路由，HP交换机，Redback的NAS 和 很多对Observium有扩展设备的支持。</p>\n<p>RANCID支持许多供应商的设备，包括Juniper路由器，HP交换机，Redback NAS和许多其他设备，以及对Observium的扩展支持。</p>\n<p>RANCID提供多种网络管理功能，包括登录到路由器表（router.db）中的每个设备，运行各种命令以获取将被保存的信息，将之前收集的信息中的任何变化发送到邮件列表，并提交这些更改到版本控制系统。</p>\n<h3></h3>\n<h3><strong>12. 开源网络监控工具: Xymon</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225312_W73h_2894582.jpg\"></p>\n<p>另一个需要提及的网络监控工具是Xymon（以前称为Hobbit）。 Xymon监控服务器，应用程序和网络，通过网页提供有关所有这些网络组件运行状况的信息。</p>\n<p>其网站上表示Xymon的开发受到Big Brother的启发，同Big Sister一样，它试图解决Big Brother BTF的缺点，如性能方面。 同时，Xymon更容易部署并且是免费的。</p>\n<h3><strong>13. 开源网络监控工具: Big Brother BTF</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225324_M2Lp_2894582.jpg\"> Big Brother创建于20世纪90年代中期，用于监控网络系统，后来被Quest Software收购，而其又被戴尔在2012年收购。</p>\n<p>许多其他网络监控工具都是模仿Big Brother的，所以它有一个大型的、详细的论坛和有帮助的开发人员社区，是初学者的好选择。</p>\n<p>除了可用于学生和非商业用途的开源版本之外，其还提供了名为Big Brother Professional Edition的商业版本。</p>\n<h3><strong>14. 开源网络监控工具: Big Sister</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225337_KP2a_2894582.jpg\"></p>\n<p><a href=\"http://www.bigsister.ch/bigsister.html\" target=\"_blank\" rel=\"nofollow\">Big Sister</a>创始人托马斯·艾比（Thomas Aeby）表示，他对Big Brother的网络监控印象深刻，但希望提高其性能，减少坏事件发生时的警报数量，并进行其他改进。</p>\n<p>Big Sister提供网络监控，节点管理，doxygen过滤器和Web应用程序框架，作为Unix衍生产品和Microsoft Windows操作系统的一部分。</p>\n<p>Big Sister对监控网络系统的IT管理员有所帮助。当系统故障时，它会通知管理员，生成状态变化历史记录日志并显示各种系统性能数据。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111458\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111458votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111458\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e397352deab3de2274f1bc8a890a2853cf7a627e.jpg"}
{"url_object_id": "09b885cc800839c518c644472774a334", "url": "http://blog.jobbole.com/111398/", "title": "揭秘 Reddit 愚人节项目的技术实现过程", "front_image_url": ["https://i2.wp.com/redditupvoted.files.wordpress.com/2017/04/place-final.png?crop=0px%2C0px%2C1000px%2C483px&resize=1200%2C580&ssl=1"], "create_date": "2017-06-13", "praise_nums": 4, "fav_nums": 7, "comment_nums": 0, "tags": "IT技术,Reddit", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://redditblog.com/2017/04/13/how-we-built-rplace/\">Reddit</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><img src=\"https://i2.wp.com/redditupvoted.files.wordpress.com/2017/04/place-final.png?crop=0px%2C0px%2C1000px%2C483px&amp;resize=1200%2C580&amp;ssl=1\" alt=\"\"></p>\n<p>每年的愚人节，我们喜欢创建项目来探索人类大规模的交流互动，而不是做一些恶作剧。今年我们提出了 r/Place，这是一个协作的画板，每个用户每 5 分钟只能修改一个小块。这一限制弱化了个体的重要性，强化了大量用户协作完成复杂创作的必要性。每个小块的变化实时传递给观察者。</p>\n<p>许多开发团队（前端、后端、移动端）协作开发这个项目，项目大部分基于 Reddit 已有的技术。这篇文章从技术角度详细描述我们如何完成 r/Place。</p>\n<p>且慢。如果你想查看我们的代码，<a href=\"http://github.com/reddit/reddit-plugin-place-opensource\">在这里</a>。如果你对构建 r/Place 这一类项目感兴趣，<a href=\"https://about.reddit.com/careers/\">我们欢迎你</a>！</p>\n<h2>需求</h2>\n<p>定义愚人节项目的需求十分重要，因为它一旦发布即面向所有 Reddit 用户，没有增长过程。如果它一开始并不能完美运作，似乎就不能吸引足够的用户来创作并获得有趣的体验。</p>\n<ul>\n<li>画板必须有 1000×1000 个小块，所以它会非常大。</li>\n<li>所有客户端必须和当前画板状态同步，并显示一致，否则用户基于不同版本的画板难以协作。</li>\n<li>我们必须支持至少 100000 的并发同步用户。</li>\n<li>用户每 5 分钟可以修改一个小块，所以我们必须支持平均每 5 分钟 100000 个小块的更新（每秒 333 个更新）。</li>\n<li>项目的设计必须遵循这一点，即使 r/Place 流量巨大，也不能影响站点其他功能。</li>\n<li>配置必须有足够弹性，应对意外的瓶颈或故障。这意味着画板的大小和小块的使用间隔可以在运行时调节，以防数据量过大或更新过于频繁。</li>\n<li>API 必须开放和透明，reddit 社区如果对此有兴趣，可以在此之上构建项目（机器人、扩展、数据收集、外部可视化等等）。</li>\n</ul>\n<h2>后端</h2>\n<h3>实施决策</h3>\n<p>后端最大的挑战就是保持所有客户端与画板状态同步。我们的解决方案是初始化客户端状态时立刻实时监听小块的变化，然后请求整个画板状态。只要我们在生成画板的时候有实时的小块更改，那么响应返回的整个画板状态就会有几秒的延迟。当客户端接收到整个画板状态，把在等待请求时的小块变化在画板上重演。之后接收到所有小块变化实时绘制在画板上。</p>\n<p>为了让这个策略正常实施，我们需要尽可能快的请求到画板的整体状态。我们的初步方案是用<a href=\"https://pandaforme.gitbooks.io/introduction-to-cassandra/content/understand_the_cassandra_data_model.html\">单行 Cassandra</a> 储存整个画板，每个针对整个画板的请求可以读取整行。行中的每列格式如下所示：</p>\n<p><code>(x, y): {‘timestamp’: epochms, ‘author’: user_name, ‘color’: color}</code></p>\n<p>因为画板包含一百万个小块，这意味着我们不得不读取有一百万列的行。在我们的生产集群上这种读取花费 30 秒，慢到无法接受，所以我们不能过度依赖 Cassandra。</p>\n<p>我们下一个方案使用 redis 储存整个画板。我们使用 bitfield 处理一百万个 4 位的整型。每个 4 位的整型可以编码 4 位的颜色，横纵（x，y）坐标可以在 bitfield 里用偏移量表示（offset = x + 1000y）。我们可以通过读取整个 bitfield 来获取整个画板的状态。我们可以通过在 bitfield 中更新指定偏移量上的值，来更新单独的小块(不再需要加锁或读/改/写)。我们仍然需要在 Cassandra 中储存所有的细节，让用户可以检查单独的小块，看一看何时何人更改了它。我们也计划用 Cassandra 备份整个画板，以防 redis 失效。从 redis 中读取整个画板不超过 100ms，这已经足够快了。</p>\n<p>插图展示了我们如何用 redis 储存 2×2 画板的颜色：</p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/drawio-1.png?w=720&amp;h=199\" alt=\"\"></p>\n<p>我们非常关心 redis 读取最大带宽。如果很多客户端同时链接或刷新，它们会同时请求整个画板的状态，全部都触发 redis 的读取操作。因为画板是全局共享状态，显而易见的解决方案是使用缓存。我们决定在 CDN 层（Fastly）使用缓存，因为实现简单，并且缓存离客户端更近可以提高响应速度。对整个画板的请求被 Fastly 缓存下来并设置 1 秒的超时时间。我们也添加了 <a href=\"https://docs.fastly.com/guides/performance-tuning/serving-stale-content#usage\">stale-while-revalidate</a> 这个控制缓存的头信息，来应对画板缓存过期导致超过预期的大量请求。<a href=\"https://www.fastly.com/network-map\">Fastly 维护着大约 33 处独立缓存 POPs（接入点）</a>，所以我们预期每秒最多有 33 个针对整个画板的请求。</p>\n<p>我们使用我们的 <a href=\"https://github.com/reddit/reddit-service-websockets\">websocket 服务</a> 向所有客户端推送更新。我们已经成功地在 <a href=\"https://www.reddit.com/live\">reddit live</a> 生产环境中应用过它，来处理超过 100000 的并发用户，比如 live PM notifications 功能或其他特性。wesocket 服务也曾是我们过去愚人节项目的基础，比如 <a href=\"https://redditblog.com/2015/04/01/the-button/\">The Button</a> 和 <a href=\"https://redditblog.com/2016/04/01/Robin/\">Robin</a> 两个项目。对于 r/Place 项目，客户端维护一个 websocket 链接来接收实时的小块变化更新。</p>\n<h3>API</h3>\n<p><strong>检索整个画板</strong></p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/board-bitmap.png?w=720&amp;h=368\" alt=\"\"></p>\n<p>请求首先到达 Fastly。如果那里有一份未过期的画板副本，它会立刻返回从而不需要访问 reddit 应用服务器。否则如果缓存未命中或副本过时，reddit 应用会从 redis 中读取整个画板然后返回到 Fastly 中并缓存，并返回给客户端。</p>\n<p style=\"text-align: center;\">reddit 应用测量的请求速率和响应时间：</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgiu8lqg7tj20jw08v3z5.jpg\"></p>\n<p>注意，请求速率从没超过 33 个/秒，说明 Fastly（CDN） 缓存非常给力，阻止了大量直接访问 reddit 应用的请求。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fgiu8mejg3j20jt08nwf9.jpg\"></p>\n<p>当请求访问 reddit 应用时，redis 的读取操作非常迅速。</p>\n<p><strong>绘制一个小块</strong></p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/draw.png?w=720&amp;h=533\" alt=\"\"></p>\n<p>绘制一个小块的步骤如下：</p>\n<ol>\n<li>从 Cassandra 读取用户上一次更改小块的时间戳。如果和当前时间间隔比冷却时间（5 分钟）短，拒绝绘制请求，返回给用户一个错误。</li>\n<li>向 redis 和 Cassandra 写入小块详情。</li>\n<li>向 Cassandra 写入用户上一次修改小块的时间戳。</li>\n<li>让 websocket 服务向所有链接的客户端发送新的小块。</li>\n</ol>\n<p>Cassandra 的所有读写操作的<a href=\"http://docs.datastax.com/en/archived/cassandra/1.2/cassandra/dml/dml_config_consistency_c.html\">一致性设置为 QUORUM 级别</a>，来确保强一致性。</p>\n<p>我们当然也有竞态条件允许用户一次更改多个小块。在步骤 1-3 中并没有锁，因此批量小块修改的操作通过步骤 1 的检查之后将在步骤 2 中进行修改。看起来一些用户发现了这个漏洞或一些机器脚本不遵守速率限制，所以大概有 15000 个小块被利用这个漏洞进行更改（占全部更改小块的 0.09%）</p>\n<p style=\"text-align: center;\">reddit 应用测量的请求速率和响应时间：</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fgiu8mu894j20jn08rwf3.jpg\"></p>\n<p>我们经历了更改小块最大速率大概 200/s。这比我们估算的最大速率 333/s 要低（平均每 5 分钟 100000 个用户更改小块）。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgiu8o0satj20jn08o3ze.jpg\"></p>\n<p><strong>获取单个小块详情</strong></p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/pixel1.png?w=720&amp;h=251\" alt=\"\"></p>\n<p>直接从 Cassandra 请求单个小块。</p>\n<p style=\"text-align: center;\"><em>reddit 应用测量的请求速率和响应时间：</em></p>\n<p><em><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fgiu8oq24dj20jt08jwf4.jpg\"></em></p>\n<p>这个服务端点用的很多。除了客户端频繁的请求之外，有人编写抓取工具每次检索整个画板的一个小块。由于这个服务端点没有在 CDN 缓存，所有请求被 reddit 应用程序处理。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fgiu8p6m34j20jp08q754.jpg\"></p>\n<p>在整个项目中，这些请求的响应时间非常迅速稳定。</p>\n<h3>Websockets</h3>\n<p>我们并没有在 websocket 服务中为 r/Place 做单独指标，但是我们可以估计并减去项目开始前后的基本使用量。</p>\n<p style=\"text-align: center;\"><em>websocket 服务总连接数：</em></p>\n<p><em><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgiu8q6c2yj20jr08qt9b.jpg\"></em></p>\n<p>r/Place 开始前的基本使用量大概有 20000 个连接，而峰值 100000 个链接，所以高峰期我们大概有 80000 个用户连接到 r/Place。</p>\n<p style=\"text-align: center;\"><em>Websocket 服务带宽：</em></p>\n<p><em><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fgiu8qrc27j20js08p0tk.jpg\"></em></p>\n<p>高峰期 r/Place 的 websocket 服务吞吐量超过 4gbps（24个实例，每个 150 Mbps）</p>\n<h2>前端：Web和移动端</h2>\n<p>构建 r/Place 的前端工程涉及到了跨平台开发的众多挑战。我们期望 r/Place 在我们所有主流平台上拥有无缝体验，包括桌面web、移动web、iOS 和 Android。</p>\n<p>r/Place 的 UI 需要做三件很重要的事：</p>\n<ol>\n<li>实时展示画板状态。</li>\n<li>让用户和画板交互方便容易</li>\n<li>在我们所有平台上正常运行，包括移动端 app。</li>\n</ol>\n<p>UI 的主要焦点集中在了 canvas，并且 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\">Canvas API</a> 完全能胜任要求。我们使用一个 1000 x 1000 的 <code>&lt;canvas&gt;</code> 元素，把每个小块当做一个像素进行绘制。</p>\n<h3>绘制 canvas</h3>\n<p>canvas 需要实时展示整个画板的状态。我们需要在页面载入的时候绘制整个画板的状态，然后更新通过 websocket 传输过来的画板状态。通过 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D\">CanvasRenderingContext2D</a> 接口，有三种方式更新 canvas 元素。</p>\n<ol>\n<li>用 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage\">drawImage()</a> 将一个存在的图像绘制进 canvas。</li>\n<li>通过众多图形绘制的方法来绘制各种形状，比如用 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillRect\">fillRect()</a> 绘制一个有颜色的矩形。</li>\n<li>构造一个 ImageData 对象，然后用 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/putImageData\">putImageData()</a> 方法将它绘制进 canvas。</li>\n</ol>\n<p>第一种选项并不适合我们，因为我们并没有画板的图像格式，还剩下 2、3 选项。用<code>fillRect()</code>方法更新单独的小块非常简洁：当 websocket 通知更新时，只需要在(x,y)位置处绘制一个 1 x 1 的矩形。一般来说这很棒，但并不适合绘制画板的初始状态。<code>putImageData()</code>方法显然更合适，我们可以在 ImageData 对象中定义每个像素的颜色，然后一次性绘制整个 canvas。</p>\n<p><strong>绘制画板的初始状态</strong></p>\n<p>我们使用<code>putImageData()</code>方法，前提需要将画板状态定义成 <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray\">Uint8ClampedArray</a> 形式，每个值用 8 位无符号整型表示 0-255 之间的数字。每一个值表示单个颜色通道（红、绿、蓝、alpha），每个像素需要 4 个值组成的数组。一个 2 x 2 的 canvas 需要一个 16 字节的数组，前 4 字节表示 canvas 左上角的像素，最后 4 字节表示右下角像素。</p>\n<p>插图展示了 canvas 像素和 Uint8ClampedArray 映射关系：</p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/drawio-2.png?w=720&amp;h=294\" alt=\"\"></p>\n<p>对于 r/Place 的 canvas，数组大小是四百万字节，也就是 4MB。</p>\n<p>在后端，画板状态储存格式是 4 位的 bitfield。每个颜色用 0 到 15 之间的数字表示，这允许我们将 2 像素的颜色信息打包进 1 个字节（1字节=8位）。为了在客户端配合使用，我们需要做 3 件事：</p>\n<ol>\n<li>将二进制数据从我们的 API 拉取到客户端。</li>\n<li>“解压”数据</li>\n<li>将 4 位颜色映射成可用的 32 位颜色。</li>\n</ol>\n<p>为了拉取二进制数据，我们在支持 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\">Fetch API</a> 的浏览器中使用此 API。在不支持的浏览器中，我们使用 <a href=\"https://www.youtube.com/watch?v=Pubd-spHN-0\">XMLHttpRequest</a>，并把 responseType 设置为 <code>“arraybuffer”</code>。</p>\n<p>我们从 API 接收到的二进制数据中，每个字节有 2 像素的颜色数据。<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\">TypedArray</a> 的构造函数允许操作的最小单位是 1 字节。这在客户端上并不方便使用，所以我们做的第一件事就是“解压”，让数据更容易处理。方式很简洁，我们遍历打包的数据并按照高位低位分割比特位，将它们复制到另一个数组的不同字节中。最后，4 位的颜色值映射成可用的 32 位颜色。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fgiu8qtp38j20k703qt8z.jpg\"></p>\n<p><code>ImageData</code>这种数据结构需要使用<code>putImageData</code>方法，最终结果要求是可读的<code>Uint8ClampedArray</code>格式并且颜色通道字节要按照 RGBA 这种顺序。这意味着我们要做另一遍“解压”，将每个颜色拆分成颜色通道字节并按顺序排列。每个像素要做 4 次操作,这不是很方便，但幸运的是有其他方式。</p>\n<p><code>TypeArray</code>对象们本质上是<code>ArrayBuffer</code>的数组视图，实际上表示二进制数据。它们共同的一点就是多个<code>TypeArray</code>实例可以基于一个<code>ArrayBuffer</code>实例进行读写。我们不必将 4 个值写入 8 位的数组，我们可以直接把单个值写入一个 32 位的数组。使用<code>Uint32Array</code>写入值，我们可以通过更新数组单个索引来轻松更新单个小块颜色。我们唯一需要做的就是把我们的颜色字节逆序储存（ABGR），这样一来使用<code>Uint8ClampedArray</code>读取数据时可以自动把字节填入正确位置。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fgiu8r9pxaj20k403u74h.jpg\"></p>\n<p><strong>处理 websocket 更新</strong></p>\n<p>响应每个像素更新时，用<code>drawRect()</code>方法绘制它们很方便，但这有个缺点：当大量更新在同一时间来到，会影响浏览器性能。我们知道画板状态更新十分频繁，所以我们需要处理这个问题。</p>\n<p>我们希望在一个时间点前后的 websocket 更新能够批量绘制一次，而不是每次 websocket 更新来到就立刻重新绘制 canvas。我们做了以下两点改变：</p>\n<ol>\n<li>因为我们发现了使用<code>putImageData()</code>一次更新多个像素这条明路，所以我们不再使用<code>drawRect()</code>。</li>\n<li>我们把绘制 canvas 操作放到<code>requestAnimationFrame</code>循环中。</li>\n</ol>\n<p>把绘制移到动作循环中，我们可以及时将 websocket 更新写入<code>ArrayBuffer</code>，然后延迟绘制。每一帧（大概 16ms）间的 websocket 更新会再一次绘制中批量执行。因为我们使用<code>requestAnimationFrame</code>，这意味着每次绘制时间不能太长（不超过 16ms），只有 canvas 的刷新速率受影响（而不是拖慢整个浏览器）。</p>\n<h3>Canvas 的交互</h3>\n<p>还有非常重要的一点，canvas 需要方便用户的交互。用户与 canvas 核心交互方式是更改上面的小块。在 100% 缩放下，精确地选择绘制单个像素很不方便，而且容易出错。所以我们需要放大显示（放大很多）。我们也需要方便的平移 canvas，因为在多数浏览器上它太大了（尤其是放大后）。</p>\n<p><strong>视角缩放</strong></p>\n<p>用户只能每五分钟绘制一次小块，所以选错小块非常令人不爽。我们需要把 canvas 放大到每个小块都成为一个相当大的目标。这在触摸设备上尤其重要。我们使用 40x 的放大比例，给每个小块 40 x 40 的目标区域。为了应用缩放，我们把<code>&lt;canvas&gt;</code>元素包裹进一个<code>&lt;div&gt;</code>，并给 div 设置 CSS 属性<code>transform: scale(40, 40)</code>。这样一来，小块的布置变得非常方便，但整个画板的显示并不理想（尤其是在小屏幕上），所以我们混合使用两种缩放级别：40x 用于绘制，4x 用于显示。</p>\n<p>使用 CSS 来放大 canvas 使得绘制画板的代码和缩放代码相分离，但不巧这种方式也带来一些问题。当放大一个图片（或 canvas），浏览器默认使用“平滑”算法处理图片。这适用于一些场景，但也彻底毁灭了像素艺术并把它变得混乱模糊。好消息是有另一个 CSS <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\">image-rendering</a> 允许我们命令浏览器不这么做。坏消息并不是所有浏览器完全支持这个属性。</p>\n<p><em>坏消息，变得模糊：</em></p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/www-reddit-com-place-webviewtrue-1.png?w=720&amp;h=251\" alt=\"\"></p>\n<p>我们需要在那些浏览器上用其他方式放大 canvas。我之前提到过绘制 canvas 有三种方式。其中第一个是<code>drawImage()</code>方法，它可以把一个存在的图像或另一个 canvas 绘制进一个 canvas。它也支持在绘制的时候放大或缩小图像，虽然放大的时候会和在 CSS 中放大一样出现模糊问题，但是可以通过关闭 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled\">CanvasRenderingContext2D.imageSmoothingEnabled</a> 标识，这种跨浏览器兼容性的方式来解决。</p>\n<p>所以修复模糊 canvas 问题的答案就是在渲染过程中增加额外一步。我们引入了另一个<code>&lt;canvas&gt;</code>元素，它大小位置适应于容器元素（比如画板的可见区域）。每次重新绘制 canvas 后，我们使用<code>drawImage()</code>把它的一部分绘制到新的、有合适缩放比例的 canvas。因为额外的步骤给渲染过程带来微小的开销，所以我们只在不支持<code>image-rendering</code>CSS 属性的浏览器上这样做。</p>\n<p><strong>视角平移</strong></p>\n<p>canvas 是一个相当大的图像，尤其是放大之后，所以我们需要提供一些方式操作它。为了调整 canvas 在屏幕上的位置，我们采取和解决缩放问题一样的方式：我们将<code>&lt;canvas&gt;</code>包裹进另一个<code>&lt;div&gt;</code>，并在它上面应用 CSS 属性<code>transform: translate(x, y)</code>。使用单独的 div 使得应用在 canvas 上的变换操作更容易控制，这对于防止视角在缩放时产生移动非常重要。</p>\n<p>我们最后支持多种方式调整视角位置，包括：</p>\n<ul>\n<li>点击拖拽</li>\n<li>点击移动</li>\n<li>键盘导航</li>\n</ul>\n<p>每种操作需要一点不同的实现方式。</p>\n<p><strong>点击拖拽</strong></p>\n<p>最基本的导航方式就是点击拖拽（或触摸拖拽）。我们保存了<code>mousedown</code>事件的 x、y 坐标。对于每次<code>mousemove</code>事件，我们计算鼠标相对于起点的偏移量，然后把偏移量加到已存在的 canvas 偏移量中。视角位置立刻改变，让人感觉这种到导航方式很灵敏。</p>\n<p><strong>点击移动</strong></p>\n<p>我们也支持点击一个小块，使得小块定位到屏幕中心。为了实现这个功能，我们需要跟踪<code>mousedown</code>和<code>mouseup</code>事件，为了区别“点击”和“拖动”。如果鼠标移动距离达不到“拖动”的标准，我们会根据鼠标位置和屏幕中心的距离来调整视角位置。和点击拖动不同，视角位置的更新使用了缓动函数（easing function）。我们没有立刻设定新的位置，而是把它保存成“目标”位置。在动画循环中（每次绘制 canvas 的循环），我们使用缓动函数移动当前视角逐渐接近目标。这避免了视角移动太突然。</p>\n<p><strong>键盘导航</strong></p>\n<p>我们也支持键盘导航，既可以使用 WASD 键也可以使用方向键。四个键控制内置 <strong>移动向量</strong>。没有按键按下时，向量默认是 (0, 0)，每个按键按下时会增加或减少向量的 x 或 y 轴 1 个单位。举个例子，按下“右”和“上”键会把移动向量设置成 (1,-1)。这个移动向量随后应用在动画循环中，来移动视角。</p>\n<p>在动画循环中，移动速度是基于当前缩放级别而计算出来的，公式如下：</p>\n<p style=\"text-align: center;\"><span style=\"color: #ff0000;\"><code>movementSpeed = maxZoom / currentZoom * speedMultiplier</code></span></p>\n<p>在缩小状态下，键盘导航移动速度更快，这样显得更自然。</p>\n<p>移动向量<a href=\"http://mathworld.wolfram.com/NormalizedVector.html\">单位化</a>并乘以移动速度，然后应用到当前视角位置。我们用单位向量来确保对角线移动和正交移动拥有相同速度，这也显得更自然。最后我们对移动向量自身的变化也使用了缓动函数。这使得移动方向和速度变化的更平滑，视角变得流畅生动。</p>\n<h3>移动应用支持</h3>\n<p>在 iOS 和 Android 的移动应用嵌入 canvas 过程中，我们遇到一些挑战。首先，我们需要认证用户，然后用户才能更改小块。和基于 session 的 web 认证不同，移动应用中我们使用 OAuth。这意味着应用需要为 webview 提供当前登录用户的访问令牌。最安全的方式就是用 JavaScript 在应用调用 webview 时注入 oauth 认证头信息（这也允许我们设置其他需要的头信息）。问题就简化为在每个 api 调用中传递认证头信息了。</p>\n<p><code>r.place.injectHeaders({‘Authorization’: ‘Bearer &lt;access token&gt;’});</code></p>\n<p>在 iOS 端，当你可以更改 canvas 中的下一个小块时，我们实现了消息提醒功能。因为小块的变更完全在 webview 中，所以我们需要实现向原生应用的回调。辛运的是在 iOS 8 及以上版本中只需要一个简单的 JavaScript 调用：</p>\n<p><code>webkit.messageHandlers.tilePlacedHandler.postMessage(this.cooldown / 1000);</code></p>\n<p>应用中的委派方法根据传入的冷却计时器，会随后调度发送一条通知。</p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/place-notif.png?w=720&amp;h=210\" alt=\"\"></p>\n<h2>我们学到了什么</h2>\n<h3>你总会疏漏一些事</h3>\n<p>我们完美计划好了任何事情，我们知道上线时，没有什么可能出错的地方。我们对前端和后端分别进行了负载测试，我们不可能再遇到其他错误。</p>\n<p>真的吗？</p>\n<p>上线过程很顺利。经历了一个黎明，r/Place 人气迅速上升，我们 websocket 实例的链接数量和通信量也随之增加：</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fgiu8s6hfaj20js0hvq44.jpg\"></p>\n<p>并没有什么惊喜，所有和我们预期的一样。奇怪的是，我们怀疑限制了这些服务器实例的网络带宽，因为我们预计会有更大的流量。查看了一下 CPU 的实例情况，却显示出一幅不同的图片：</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fgiu8su5fdj20jt08mmxt.jpg\"></p>\n<p>服务器实例是 8 核的，所以很明显它们快到上限了。为什么它们突然表现的如此不同？我们将原因归结于 r/Place 的工作负载类型不同于以往项目。毕竟这里有很多微小的消息，我们一般发送大型消息，比如直播帖子的更新和通知。我们也没有处理过大量用户接收相同消息的情况，所以有很多地方都不同。</p>\n<p>这没什么大不了，我们预计只需要调用和测量它一天而已。待命的运维数量是服务器实例的两倍，而且他们两耳不闻窗外事，一心只顾服务器。</p>\n<p>然后，发生了这个：</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgiu8tjp99j20jq08rwez.jpg\"></p>\n<p>这幅图看上去可能并没什么，但事实上这是我们生产环境的 Rabbit MQ 实例，不仅处理 websocket 消息，也处理 reddit.com 所有底层的依赖项。这不容乐观，一点都不。</p>\n<p>经过了各种调查、束手无策和升级实例，我们把问题锁定在管理接口。它总是有点慢，随后我们意识到，我们为了获取项目状态用 <a href=\"https://github.com/python-diamond/Diamond/blob/master/src/collectors/rabbitmq/rabbitmq.py\">rabbit diamond collector</a> 会频繁查询接口。我们认为创建新的 websocket 实例时创建了额外的 exchange （RabbitMq 中概念），再加上这些 exchange 的消息吞吐量，导致了管理界面在查询和记录时，rabbit 卡住了。我们把它关掉，情况好多了。</p>\n<p>但我们不想在一片黑暗之中（关掉了状态显示程序），所以我们迅速做了一个手工艺术品——监控脚本，帮助我们观察整个项目：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f02f1ee767780717329\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat s****y_diamond.sh\r\n\r\n#!/bin/bash\r\n\r\n/usr/sbin/rabbitmqctl list_queues | /usr/bin/awk '$2~/[0-9]/{print \"servers.foo.bar.rabbit.rabbitmq.queues.\" $1 \".messages \" $2 \" \" systime()}' | /bin/grep -v 'amq.gen' | /bin/nc 10.1.2.3 2013</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f02f1ee767780717329-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f02f1ee767780717329-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f02f1ee767780717329-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f02f1ee767780717329-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f02f1ee767780717329-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f02f1ee767780717329-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">s*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">y_diamond</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f02f1ee767780717329-2\"> </div><div class=\"crayon-line\" id=\"crayon-594f02f1ee767780717329-3\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f02f1ee767780717329-4\"> </div><div class=\"crayon-line\" id=\"crayon-594f02f1ee767780717329-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rabbitmqctl </span><span class=\"crayon-v\">list_queues</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'$2~/[0-9]/{print \"servers.foo.bar.rabbit.rabbitmq.queues.\" $1 \".messages \" $2 \" \" systime()}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'amq.gen'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">nc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.1.2.3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2013</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>如果你好奇为什么我们不断调整修改像素（小块）的超时时间（冷却时间），那么现在你就知道了。我们试着减轻服务器压力以便整个项目顺利运行。这也是为什么在某个时间段，一些像素的呈现花费较长时间。</p>\n<p>所以不幸的是，你当时坚信如下的信息：</p>\n<p><a href=\"https://www.reddit.com/r/Place/comments/62xms3/10k_upvotes_to_reduce_the_cooldown_even_further/?ref=share&amp;ref_source=embed&amp;utm_content=title&amp;utm_medium=post_embed&amp;utm_name=8f15a84993df435b970ed0f5e2bf05d8&amp;utm_source=embedly&amp;utm_term=62xms3\">10K upvotes to reduce the cooldown even further! <em>ADMIN APPROVED</em></a></p>\n<p>尽管调整完看 r/Place/new 版块很有意思，但调整完全出于技术原因：</p>\n<p><img src=\"https://redditupvoted.files.wordpress.com/2017/04/place-page.png?w=720&amp;h=475\" alt=\"\"></p>\n<p>或许这也是调整的部分动机。</p>\n<h3>机器人终归是机器人</h3>\n<p>我们在项目的末期经历了一点小波折。一般来说，我们经常遇到的问题之一便是客户端重试行为。众多客户端在遇到问题时便不停地重试。这意味着站点一旦有点小问题，对于那些没有对故障进行<a href=\"https://en.wikipedia.org/wiki/Exponential_backoff\">回退</a>编程的一些客户端，很容易引发重试风暴。</p>\n<p>当我们关闭 r/Place 时，很多机器人端点请求时返回非 200 的响应码。像这样的<a href=\"https://github.com/PlaceStart/placestart/blob/7d27beacc75dcf84d634ea32a5bf0421bf2c042a/monitor.py#L114-L125\">代码</a>不是十分友好。值得庆幸的是，在 Fastly 层很容易拦截它们。</p>\n<h2>创造点其他东西</h2>\n<p>如果没有庞大团队的协作，项目不会这么成功。我们很感谢 u/gooeyblob、u/egonkasper、u/eggplanticarus、u/spladug、u/thephilthe、u/d3fect 等人对 r/Place 团队的贡献，让愚人节的尝试变成现实。</p>\n<p>正如我们之前提到的，如果你对为百万用户创造特殊体验感兴趣，看一看我们的<a href=\"https://about.reddit.com/careers/\">招聘页</a>。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111398\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111398votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111398\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Stay Cool 。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/2da3c21a904312643f8f1b56d8eeb7b84f584ec8.jpg"}
{"url_object_id": "a631e4d3ccc4bde14646e6c7d1829be8", "url": "http://blog.jobbole.com/110992/", "title": "面试解惑：没有技术深度的苦恼", "front_image_url": ["http://wx2.sinaimg.cn/mw690/7cc829d3gy1fgcozdst5qj20ba078t94.jpg"], "create_date": "2017-06-07", "praise_nums": 2, "fav_nums": 6, "comment_nums": 1, "tags": "职场,程序员,职场,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/40d24a1f6958\">goeasyway</a>   </div><p>最近有一位读者去今日头条面试 Android 开发，这位读者师出名门（BAT中的一家公司），是有十年的软件开发经验的高级 Android 工程师，但今日头条却以没有技术深度拒绝了他。</p>\n<p>昨天早上，我在给他做模拟面试的时候也发现了这个问题，因为从简历上看他的出身，呆过两家知名的互联网公司，面试官一定会不自觉的提升对他的期望。他虽然有丰富的项目经验，但真正交流下来又发现虽然在知名公司工作却没有掌握“核心科技”，他的优势一下就变成了劣势。</p>\n<blockquote><p>随着年龄的增长，你原来的优势都在慢慢变成你的劣势。</p></blockquote>\n<h3>写给资深或即将资深的Android工程师</h3>\n<p>当我们是初级工程师的时候，最希望的就是有丰富的项目经验，好把自己苍白干瘪的简历填的炫丽饱满。然而随着时间的积累，简历上的项目是挺“饱满”的了，但我们只看“外表”的行为造成了自己另一个困境：看似很资深，其实又没有做过什么有难度的事情，工作了十年可能只是 1 年的工作经验用了 9 次。</p>\n<p>正如这位去面试的读者，从简历上看确实是能看到他辉煌的项目经历，在经历之下会发现简历中没有深入的地方。有些虽然写的很有技术，但是确实只是在使用API的程度而已；有些解决问题的方式很有技巧，但还不成体系。</p>\n<p>可惜没有多走两步，没有去研究和扩展。</p>\n<h3>那么如何改变呢？</h3>\n<p>对方也在问我这个问题，而且很迫切，迫切到希望我今天说明白之后他明天面试就可以变得深入。</p>\n<p>我很无奈且直接的说明了这个多半不可能。如果是可能的话，别人也可以很快掌握核心技术变得很深入。但长期的话我认为是可能的，比如给自己半年的时间，对以前项目中的某一项技术框架进行学习扩展和实践。最好能利用一下你目前所在公司的资源，比如做这个框架的项目组，和他们搞好关系，向他们学习、和他们讨论你遇到的每一个问题。</p>\n<p>但是绝对没有其他的方式，可以让你通过看一下或者临时准备一下就提升到有深度的地步。如果你能做到，必然是已经在某方面是个很精深的高手了，自然可以忽略我说的话。</p>\n<h3>没有深度的原因</h3>\n<p>我们没有技术深度，最重要的原因有两个：第一是回避问题，第二是没有兴趣。</p>\n<p>当我们在工作中遇到问题的时候，第一选择往往是回避它，不管是从设计上还是从技术上，或者找到其他的替代方案，如可使用别人的开源库，使用别人造出来的轮子。这样做无可厚非，但如果我们想有更深一步的提升或者更有技术深度的话，我们一定要把这个问题搞明白，至少把别人是怎么能解决这个问题的思路和方式搞明白。</p>\n<p>第二关于兴趣，很多人没有往更深入的地方多走两步，很重要的一点就是没有兴趣，一点都不好奇。如果我们遇到一些很有意思的解决方案、框架或者一些诡异的问题，但我们完全不想去“招惹”它们，唯恐避之而不及，自然，我们也失去了在这些点上有突破与深入的机会。</p>\n<h3>自己该在哪个点上深入呢？</h3>\n<p>我们工作了很多年之后，技术一定是需要具有一定的深度和广度的，广度自然不必说，你也会明白它的必要性。深度最好是跟自己的兴趣或者比较接近的工作模块相关，如果你在公司相关的模块深入，你可以利用更多的资源。或者是你感兴趣的模块的话，即使没有资源，由于你很有兴趣，你也会有办法去找到你需要用的东西的。</p>\n<p>我们永远不缺方法。</p>\n<h3>带领和被带领</h3>\n<p>技术的深度是一个带领和被带领的关系。</p>\n<p>关于这点我本身就有一个深刻的体会，在我刚开始做Android开发的时候，我的工作是去维护Android自带的系统应用，客户提的问题或者进行二次开发，我都能很好的解决。然后就会有一些空闲的时间，反正也是闲着，我就找了个系统应用里面最简单的一个应用（记事本）练练手。</p>\n<p>我想既然这么简单，那我就自己照着写一个吧，就从零开始实现一个记事本应用。当我开始写时，颠覆了我对安卓应用的理解，我发现以前认为懂的地方自己都没懂，我遇到了很多毫无头绪的问题，就这么一个简单的应用，我要靠不停的对照原版的代码实现才能发现自己的问题所在，然后才确信真正的做和看中间的差距有多大。</p>\n<p>如果你只是在别人的基础上去做事情解决问题，哪怕你觉得自己想出了很好的点子，好像灵光一闪，很巧妙的解决了客户的问题，但其实这只是一种技巧，在怎么建造这个应用、构架和设计组织这种大的方向上，你并没有多大的实质进步。</p>\n<p><strong>这个时候你只是一个跟随者，你是被别人的源码带领着的。</strong></p>\n<p>即使你看过和使用过很多应用框架，但纸上得来终觉浅，只是添加了些许纸上谈兵的资本。你始终是一个被带领的人，带领者给你定好了框架，给你定好了一条大路，然后你在他定好的道路上耍了一下滑头，却生出一种假象：觉得自己很厉害，很有技巧。</p>\n<p>而你自己写一个这样的框架，或者去设计一个思路，去指定一个方向和路径的话，你会发现它没有你想象中的那么简单。</p>\n<blockquote><p>你是要做带领别人的人？还是要做一个被带领的人呢？</p></blockquote>\n<h3>小结</h3>\n<p>没有技术深度是大多程序员的一种常态。</p>\n<p>并不能说这是一种坏的或者好的现象，这只是一种合理的状态，因为很多工作，很多人从事的项目并不需要有多少技术深度。即使你有深度，你也可能发现用不上。对于大多数人，合乎理性的做法不是去追求技术深度而是够用就可以了。</p>\n<p>但转到个人的话就不一样了，在技术上你需要够用，但是在某方面上你需要有一定的深度，以突出你自己的学习理解和运用的能力，而且这个能力是要有成功案例来背书。</p>\n<p>特别是当你成为一个资深的工程师的时候，很多公司并不希望你还是那样平庸，没有深度。虽然你会纳闷，我就算有深度你们也不一定用得上呀？然而到了这个级别的人需求量并不像初中级开发那么多，公司更理性和稳妥的做法是选择有深度的人，不是吗？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110992\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110992votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110992\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d395e25b01ef3db391cf2cfb6f5dd73c75721003.jpg"}
{"url_object_id": "52eedb3aeec8f1a1932227ad6444af49", "url": "http://blog.jobbole.com/111111/", "title": "数据库表设计，没有最好只有最适合", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "create_date": "2017-06-08", "praise_nums": 3, "fav_nums": 5, "comment_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xiaoxiaoqingyi/p/6954349.html\">小小情意</a>   </div><p>我们在设计数据库的时候，是否会突破常规，找到最适合自己需求的设计方案，下面来举个例子：</p>\n<p>常用的邻接表设计，都会添加 一个 parent_id 字段，比如区域表（国、省、市、区）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6ac4363418817\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE Area (\r\n[id] [int]  NOT NULL,\r\n[name] [nvarchar]  (50) NULL,\r\n[parent_id] [int]  NULL,\r\n[type] [int]  NULL );</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6ac4363418817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6ac4363418817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6ac4363418817-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6ac4363418817-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6ac4363418817-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6ac4363418817-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Area</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6ac4363418817-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-594fcbc5b6ac4363418817-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">nvarchar</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6ac4363418817-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-594fcbc5b6ac4363418817-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>name:地域的名称， parent_id 是父ID，省的父ID是国，市的父ID 为省，以此类推。</p>\n<p>type 是区域的阶级： 1：国，2：省，3：市，4：区</p>\n<p>在层级比较确定的情况下，这么设计表格没有什么问题，调用起来也很方便。</p>\n<p>但是使用这种邻接表设计方式，并不能满足所有的需求，当我们不确定层级的情况下，假设我有下面一个评论结构：</p>\n<p><img src=\"http://img.blog.csdn.net/20170606203512792\" alt=\"\"></p>\n<p>用邻接表记录这个评论的数据（comments 表）：</p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td>comment_id</td>\n<td>parent_id</td>\n<td>author</td>\n<td>comment</td>\n</tr>\n<tr>\n<td>1</td>\n<td>0</td>\n<td>小明</td>\n<td>我不大认同这个观点</td>\n</tr>\n<tr>\n<td>2</td>\n<td>1</td>\n<td>小张</td>\n<td>我也不认同</td>\n</tr>\n<tr>\n<td>3</td>\n<td>2</td>\n<td>小红</td>\n<td>我同意楼上</td>\n</tr>\n<tr>\n<td>4</td>\n<td>1</td>\n<td>小全</td>\n<td>你为什么不认同呢</td>\n</tr>\n<tr>\n<td>5</td>\n<td>4</td>\n<td>小明</td>\n<td>我以前遇到过这情况</td>\n</tr>\n<tr>\n<td>6</td>\n<td>5</td>\n<td>小张</td>\n<td>那也不代表你所说是对的</td>\n</tr>\n<tr>\n<td>7</td>\n<td>5</td>\n<td>小新</td>\n<td>这个视情况而定吧</td>\n</tr>\n</tbody>\n</table>\n<p>大家有没发现，这么设计表，如果要查询一个节点的所有后代，是很难实现的，你可以使用关联查询来获取一条评论和他的后代：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6aff232584542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT c1.*, c2.* FROM comments c1 LEFT OUTER JOIN comments c2 ON c2.parent_id = c1.comment_id;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6aff232584542-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6aff232584542-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comments </span><span class=\"crayon-e\">c1 </span><span class=\"crayon-e\">LEFT </span><span class=\"crayon-e\">OUTER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">comments </span><span class=\"crayon-e\">c2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">comment_id</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>然而这个查询只能获取两层的数据。这种树的特性就是可以任意深地拓展，你需要有相应的方法来获取它的深度数据。比如，可能需要计算一个评论分支的数量，或者计算一个机械设备的所有的总开销。</p>\n<p>某些情况下，在项目中使用邻接表正好适用。邻接表设计的优势在于能快速的获取一个给定节点的直接父子节点，它也很容易插入新节点。如果这样的需求就是你的项目对于分层数据的全部操作，那使用邻接表就可以很好的工作了。</p>\n<p>遇到上述的树模型，有几种方案是可以考虑下的：路径枚举、嵌套集以及闭包表。这些解决方案通常看上去比邻接表复杂很多，但它们的确使得某些使用邻接表比较复杂或很低效的操作变得更简单。如果你的项目确实需要提供这些操作，那么这些设计会是邻接表更好的选择。</p>\n<h3>一、路径枚举</h3>\n<p>在comments 表中，我们使用类型varchar 的path 字段来替代原来的parent_id 字段。这个path 字段所存储的内容为当前节点的最顶层祖先到它的自己的序列，就像UNIX的路径一样，你甚至可以使用 ‘/’ 作为路径的分隔符。</p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td>comment_id</td>\n<td>path</td>\n<td>author</td>\n<td>comment</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>小明</td>\n<td>我不大认同这个观点</td>\n</tr>\n<tr>\n<td>2</td>\n<td>1/2</td>\n<td>小张</td>\n<td>我也不认同</td>\n</tr>\n<tr>\n<td>3</td>\n<td>1/2/3</td>\n<td>小红</td>\n<td>我同意楼上</td>\n</tr>\n<tr>\n<td>4</td>\n<td>1/4</td>\n<td>小全</td>\n<td>你为什么不认同呢</td>\n</tr>\n<tr>\n<td>5</td>\n<td>1/4/5</td>\n<td>小明</td>\n<td>我以前遇到过这情况</td>\n</tr>\n<tr>\n<td>6</td>\n<td>1/4/5/6</td>\n<td>小张</td>\n<td>那也不代表你所说是对的</td>\n</tr>\n<tr>\n<td>7</td>\n<td>1/4/5/7</td>\n<td>小新</td>\n<td>这个视情况而定吧</td>\n</tr>\n</tbody>\n</table>\n<p>你可以通过比较每个节点的路径来查询一个节点祖先。比如：要找到评论#7， 路径是 1/4/5/7一 的祖先，可以这么做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b06727962535\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM comments AS c WHERE '1/4/5/7' LIKE c.path || '%' ;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b06727962535-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b06727962535-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1/4/5/7'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这句话查询语句会匹配到路径为 1/4/5/%，1/4/% 以及 1/% 的节点，而这些节点就是评论#7的祖先。</p>\n<p>同时还可以通过将LIKE 关键字两边的参数互换，来查询一个给定节点的所有后代。比如查询评论#4，路径path为 ‘1/4’ 的所有后代，可以使用如下语句：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b0b190288956\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM comemnts AS c WHERE c.path LIKE '1/4' || '%' ;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b0b190288956-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b0b190288956-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comemnts </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">path </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1/4'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这句查询语句所有能找到的后台路径分别是：1/4/5、1/4/5/6、1/4/5/7。</p>\n<p>一旦你可以很简单地获取一棵子树或者从子孙节点到祖先节点的路径，你就可以很简单地实现更多的查询，如查询一颗子树所有节点上值的总和。</p>\n<p>插入一个节点也可以像使用邻接表一样地简单。你所需要做的只是复制一份要插入节点的父亲节点路径，并将这个新节点的ID追加到路径末尾即可。</p>\n<p>路径枚举也存在一些缺点，比如数据库不能确保路径的格式总是正确或者路径中的节点确实存在。依赖于应用程序的逻辑代码来维护路径的字符串，并且验证字符串的正确性开销很大。无论将varchar 的长度设定为多大，依旧存在长度的限制，因而并不能够支持树结构无限扩展。</p>\n<h3>二、 嵌套集</h3>\n<p>嵌套集解决方案是存储子孙节点的相关信息，而不是节点的直接祖先。我们使用两个数字来编码每个节点，从而表示这一信息，可以将这两个数字称为nsleft 和 nsright。</p>\n<p>每个节点通过如下的方式确定nsleft 和nsright 的值：nsleft的数值小于该节点所有后代ID，同时nsright 的值大于该节点的所有后代的ID。这些数字和comment_id 的值并没有任何关联。</p>\n<p>确定这三个值（nsleft，comment_id，nsright）的简单方法是对树进行一次深度优先遍历，在逐层深入的过程中依次递增地分配nsleft的值，并在返回时依次递增地分配nsright的值。得到数据如下:</p>\n<p><img src=\"http://img.blog.csdn.net/20170606203931626\" alt=\"\"></p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td>comment_id</td>\n<td>nsleft</td>\n<td>nsright</td>\n<td>author</td>\n<td>comment</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>14</td>\n<td>小明</td>\n<td>我不大认同这个观点</td>\n</tr>\n<tr>\n<td>2</td>\n<td>2</td>\n<td>5</td>\n<td>小张</td>\n<td>我也不认同</td>\n</tr>\n<tr>\n<td>3</td>\n<td>3</td>\n<td>4</td>\n<td>小红</td>\n<td>我同意楼上</td>\n</tr>\n<tr>\n<td>4</td>\n<td>6</td>\n<td>13</td>\n<td>小全</td>\n<td>你为什么不认同呢</td>\n</tr>\n<tr>\n<td>5</td>\n<td>7</td>\n<td>12</td>\n<td>小明</td>\n<td>我以前遇到过这情况</td>\n</tr>\n<tr>\n<td>6</td>\n<td>8</td>\n<td>9</td>\n<td>小张</td>\n<td>那也不代表你所说是对的</td>\n</tr>\n<tr>\n<td>7</td>\n<td>10</td>\n<td>11</td>\n<td>小新</td>\n<td>这个视情况而定吧</td>\n</tr>\n</tbody>\n</table>\n<p>一旦你为每个节点分配了这些数字，就可以使用它们来找到指定节点的祖先和后代。比如搜索评论#4及其所有后代，可以通过搜索哪些节点的ID在评论 #4 的nsleft 和 nsright 范围之间，例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b10184840481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT c2.* FROM comments AS c1 JOIN comments AS c2 ON c2.nsleft BETWEEN c1.nsleft\r\nAND c1.nsright WHERE c1.comment_id = 4;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b10184840481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b10184840481-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b10184840481-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">c1 </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">c2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-e\">BETWEEN </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b10184840481-2\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsright </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">comment_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>比如搜索评论#6及其所有祖先，可以通过搜索#6的ID在哪些节点的nsleft 和 nsright 范围之间，例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b14682719268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT c2.* FROM comments AS c1 JOIN comments AS c2 ON c1.nsleft BETWEEN c2.nsleft\r\nAND c2.nsright WHERE c1.comment_id = 6;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b14682719268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b14682719268-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b14682719268-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">c1 </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">c2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-e\">BETWEEN </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b14682719268-2\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsright </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">comment_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>使用嵌套集设计的主要优势是，当你想要删除一个非叶子节点时，它的后代会自动替代被删除的节点，成为其直接祖先节点的直接后代。就是说已经自动减少了一层。</p>\n<p>然而，某些在邻接表的设计中表现得很简单的查询，比如获取一个节点的直接父亲或者直接后代，在嵌套集设计中会变得比较复杂。在嵌套集中，如果需要查询一个节点的直接父亲，我们会这么做，比如要找到评论#6 的直接父亲：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b17666177860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT parent.* FROM comments AS c JOIN comments AS parent ON c.nsleft BETWEEN parent.nsleft AND parent.nsright\r\nLEFT OUTER JOIN comments AS in_between ON c.nsleft BETWEEN in_between.nsleft AND in_between.nsright\r\nAND in_between.nsleft BETWEEN parent.nsleft AND parent.nsright WHERE c.comment_id = 6\r\nAND in_between.comment_id IS NULL;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b17666177860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b17666177860-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b17666177860-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b17666177860-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b17666177860-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ON</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-e\">BETWEEN </span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsright</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b17666177860-2\"><span class=\"crayon-e\">LEFT </span><span class=\"crayon-e\">OUTER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">comments </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">in_between </span><span class=\"crayon-i\">ON</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-e\">BETWEEN </span><span class=\"crayon-v\">in_between</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">in_between</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsright</span></div><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b17666177860-3\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">in_between</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-e\">BETWEEN </span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsleft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nsright </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">comment_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b17666177860-4\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">in_between</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">comment_id </span><span class=\"crayon-st\">IS</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>总之有些复杂。</p>\n<p>对树进行操作，比如插入和移动节点，使用嵌套集会比其它设计复杂很多。当插入一个新节点时，你需要重新计算新插入节点的相邻兄弟节点、祖先节点和它祖先节点的兄弟，来确保他们的左右值都比这个新节点的左值大。同时，如果这个新节点时一个非叶子节点，你还要检查它的子孙节点。</p>\n<p>如果简单快速查询是整个程序中最重要的部分，嵌套集是最好的选择，比操作单独的节点要方便快捷很多。然而，嵌套集的插入和移动节点是比较复杂的，因为需要重新分配左右值，如果你的应用程序需要频繁的插入、删除节点，那么嵌套集可能并不合适。</p>\n<h3>三、闭包表</h3>\n<p>闭包表是解决分级存储的一个简单而优雅的解决方案，它记录了树中所有节点间的关系，而不仅仅只有那些直接的父子节点。</p>\n<p>在设计评论系统时，我们额外创建了一个叫 tree_paths 表，它包含两列，每一列都指向 comments 中的外键。</p>\n<p>我们不再使用comments 表存储树的结构，而是将树中任何具有（祖先 一 后代）关系的节点对都存储在treepaths 表里，即使这两个节点之间不是直接的父子关系；同时，我们还增加一行指向节点自己。</p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td>祖先</td>\n<td>后代</td>\n<td>祖先</td>\n<td>后代</td>\n<td>祖先</td>\n<td>后代</td>\n<td>祖先</td>\n<td>后代</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>1</td>\n<td>7</td>\n<td>4</td>\n<td>6</td>\n<td>7</td>\n<td>7</td>\n</tr>\n<tr>\n<td>1</td>\n<td>2</td>\n<td>2</td>\n<td>2</td>\n<td>4</td>\n<td>7</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>1</td>\n<td>3</td>\n<td>2</td>\n<td>3</td>\n<td>5</td>\n<td>5</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>1</td>\n<td>4</td>\n<td>3</td>\n<td>3</td>\n<td>5</td>\n<td>6</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>1</td>\n<td>5</td>\n<td>4</td>\n<td>4</td>\n<td>5</td>\n<td>7</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>1</td>\n<td>6</td>\n<td>4</td>\n<td>5</td>\n<td>6</td>\n<td>6</td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>通过treepaths 表来获取祖先和后代比使用嵌套集更加的直接。例如要获取评论#4的后代，只需要在 treepaths 表中搜索祖先是评论 #4的行就行了。同样获取后代也是如此。</p>\n<p>要插入一个新的叶子节点，比如评论#6的一个子节点，应首先插入一条自己到自己的关系，然后搜索 treepaths 表中后代是评论#6 的节点，增加该节点和新插入节点的“祖先一后代”关系（新节点ID 应该为8）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b1c287348492\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nINSERT INTO treepaths (ancestor, descendant)\r\nSELECT t.ancestor, 8\r\nFROM treepaths AS t\r\nWHERE t.descendant = 6\r\nUNION ALL SELECT 8, 8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b1c287348492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b1c287348492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b1c287348492-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594fcbc5b6b1c287348492-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b1c287348492-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b1c287348492-1\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">treepaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b1c287348492-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b1c287348492-3\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treepaths </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594fcbc5b6b1c287348492-4\"><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b1c287348492-5\"><span class=\"crayon-e\">UNION </span><span class=\"crayon-e\">ALL </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>要删除一个叶子节点，比如评论#7， 应删除所有treepaths 表中后代为评论 #7 的行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594fcbc5b6b20592777294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDELETE FROM treepaths WHERE descendant = 7;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594fcbc5b6b20592777294-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594fcbc5b6b20592777294-1\"><span class=\"crayon-e\">DELETE </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treepaths </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>要删除一颗完整的子树，比如评论#4 和它所有的后代，可删除所有在 treepaths 表中后代为 #4的行，以及那些以评论#4后代为后代的行。</p>\n<p>闭包表的设计比嵌套集更加的直接，两者都能快捷地查询给定节点的祖先和后代，但是闭包表能更加简单地维护分层信息。这两个设计都比使用邻接表或者路径枚举更方便地查询给定节点的直接后代和祖先。</p>\n<p>然而你可以优化闭包表来使它更方便地查询直接父亲节点或者子节点： 在 treepaths 表中添加一个 path_length 字段。一个节点的自我引用的path_length 为0，到它直接子节点的path_length 为1，再下一层为2，以此类推。这样查询起来就方便多了。</p>\n<h3>总结：你该使用哪种设计？</h3>\n<p>每种设计都各有优劣，如何选择设计，依赖于应用程序的哪种操作是你最需要性能上的优化。</p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td>方案</td>\n<td>表数量</td>\n<td>查询子</td>\n<td>查询树</td>\n<td>插入</td>\n<td>删除</td>\n<td>引用完整性</td>\n</tr>\n<tr>\n<td>邻接表</td>\n<td>1</td>\n<td>简单</td>\n<td>困难</td>\n<td>简单</td>\n<td>简单</td>\n<td>是</td>\n</tr>\n<tr>\n<td>枚举路径</td>\n<td>1</td>\n<td>简单</td>\n<td>简单</td>\n<td>简单</td>\n<td>简单</td>\n<td>否</td>\n</tr>\n<tr>\n<td>嵌套集</td>\n<td>1</td>\n<td>困难</td>\n<td>简单</td>\n<td>困难</td>\n<td>困难</td>\n<td>否</td>\n</tr>\n<tr>\n<td>闭包表</td>\n<td>2</td>\n<td>简单</td>\n<td>简单</td>\n<td>简单</td>\n<td>简单</td>\n<td>是</td>\n</tr>\n</tbody>\n</table>\n<p>层级数据设计比较</p>\n<p>1、邻接表是最方便的设计，并且很多程序员都了解它</p>\n<p>2、如果你使用的数据库支持WITH 或者 CONNECT BY PRIOR 的递归查询，那能使得邻接表的查询更高效。</p>\n<p>3、枚举路径能够很直观地展示出祖先到后代之间的路径，但同时由于它不能确保引用完整性，使得这个设计非常脆弱。枚举路径也使得数据的存储变得比较冗余。</p>\n<p>4、嵌套集是一个聪明的解决方案，但可能过于聪明，它不能确保引用完整性。最好在一个查询性能要求很高而对其他要求一般的场合来使用它。</p>\n<p>5、闭包表是最通用的设计，并且以上的方案也只有它能允许一个节点属于多棵树。它要求一张额外的表来存储关系，使用空间换时间的方案减少操作过程中由冗余的计算所造成的消耗。</p>\n<p>这几种设计方案只是我们日常设计中的一部分，开发中肯定会遇到更多的选择方案。选择哪一种方案，是需要切合实际，根据自己项目的需求，结合方案的优劣，选择最适合的一种。</p>\n<p>我遇到一些开发人员，为了敷衍了事，在设计数据库表时，只考虑能否完成眼下的任务，不太注重以后拓展的问题，不考虑查询起来是否耗性能。可能前期数据量不多的时候，看不出什么影响，但数据量稍微多一点的话，就已经显而易见了（例如：可以使用外联接查询的，偏偏要使用子查询）。</p>\n<p>我觉得设计数据库是一个很有趣且充满挑战的工作，它有时能体现你的视野有多宽广，有时它能让你睡不着觉，总之痛并快乐着。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111111\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111111votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111111\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "ce55facb32cdaa01d9d66d8cccce5a05", "url": "http://blog.jobbole.com/111393/", "title": "Reddit 如何统计每个帖子的浏览量", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/06/998ce63f36097881b592d75c920250e6.png"], "create_date": "2017-06-08", "praise_nums": 2, "fav_nums": 1, "comment_nums": 0, "tags": "IT技术,HyperLogLog,Reddit", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://redditblog.com/2017/05/24/view-counting-at-reddit/\">redditblog</a>   译文出处：<a target=\"_blank\" href=\"http://yemengying.com/2017/06/04/reddit-view-counting/\">yemengying</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/998ce63f36097881b592d75c920250e6.png\" alt=\"\"></p>\n<p>我们想要更好地向用户展示 Reddit 的规模。为了这一点，投票和评论数是一个帖子最重要的指标。然而，在 Reddit 上有相当多的用户只浏览内容，既不投票也不评论。所以我们想要建立一个能够计算一个帖子浏览数的系统。这一数字会被展示给帖子的创作者和版主，以便他们更好的了解某个帖子的活跃程度。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/ce48672da2acb834090d2b83e6d8fc50.png\" alt=\"\"></p>\n<p>在这篇博客中，我们将讨论我们是如何实现超大数据量的计数。</p>\n<h2 id=\"计数机制\">计数机制</h2>\n<p>对于计数系统我们主要有四种需求:</p>\n<ul>\n<li>帖子浏览数必须是实时或者近实时的，而不是每天或者每小时汇总。</li>\n<li>同一用户在短时间内多次访问帖子，只算一个浏览量</li>\n<li>显示的浏览量与真实浏览量间允许有小百分之几的误差</li>\n<li>Reddit 是全球访问量第八的网站，系统要能在生产环境的规模上正常运行，仅允许几秒的延迟</li>\n</ul>\n<p>要全部满足以上四个需求的困难远远比听上去大的多。为了实时精准计数，我们需要知道某个用户是否曾经访问过这篇帖子。想要知道这个信息，我们就要为每篇帖子维护一个访问用户的集合，然后在每次计算浏览量时检查集合。一个 naive 的实现方式就是将访问用户的集合存储在内存的 hashMap 中，以帖子 Id 为 key。</p>\n<p>这种实现方式对于访问量低的帖子是可行的，但一旦一个帖子变得流行，访问量剧增时就很难控制了。甚至有的帖子有超过 100 万的独立访客！ 对于这样的帖子，存储独立访客的 ID 并且频繁查询某个用户是否之前曾访问过会给内存和 CPU 造成很大的负担。</p>\n<p>因为我们不能提供准确的计数，我们查看了几种不同的<a href=\"https://en.wikipedia.org/wiki/Count-distinct_problem\" target=\"_blank\" rel=\"external\">基数估计算法</a>。有两个符合我们需求的选择：</p>\n<ul>\n<li>一是线性概率计数法，很准确，但当计数集合变大时所需内存会线性变大。</li>\n<li>二是基于 <a href=\"http://algo.inria.fr/flajolet/Publications/FlFuGaMe07.pdf\" target=\"_blank\" rel=\"external\">HyperLogLog</a> (以下简称 HLL )的计数法。 HLL 空间复杂度较低，但是精确度不如线性计数。</li>\n</ul>\n<p>下面看下 HLL 会节省多少内存。如果我们需要存储 100 万个独立访客的 ID, 每个用户 ID 8 字节长，那么为了存储一篇帖子的独立访客我们就需要 8 M的内存。反之，如果采用 HLL 会显著减少内存占用。不同的 HLL 实现方式消耗的内存不同。如果采用<a href=\"http://antirez.com/news/75\" target=\"_blank\" rel=\"external\">这篇文章</a>的实现方法，那么存储 100 万个 ID 仅需 12 KB，是原来的 0.15%！！</p>\n<p><a href=\"http://highscalability.com/blog/2012/4/5/big-data-counting-how-to-count-a-billion-distinct-objects-us.html\" target=\"_blank\" rel=\"external\">Big Data Counting: How to count a billion distinct objects using only 1.5KB of Memory – High Scalability –</a>这篇文章很好的总结了上面的算法。</p>\n<p>许多 HLL 的实现都是结合了上面两种算法。在集合小的时候采用线性计数，当集合大小到达一定的阈值后切换到 HLL。前者通常被成为 ”稀疏“(sparse) HLL，后者被称为”稠密“(dense) HLL。这种结合了两种算法的实现有很大的好处，因为它对于小集合和大集合都能够保证精确度，同时保证了适度的内存增长。可以在 google 的这篇<a href=\"https://stefanheule.com/papers/edbt13-hyperloglog.pdf\" target=\"_blank\" rel=\"external\">论文</a>中了解这种实现的详细内容。</p>\n<p>现在我们已经确定要采用 HLL 算法了，不过在选择具体的实现时，我们考虑了以下三种不同的实现。因为我们的数据工程团队使用 Java 和 Scala，所以我们只考虑 Java 和 Scala 的实现。</p>\n<ul>\n<li>Twitter 提供的 <a href=\"https://twitter.github.io/algebird/datatypes/approx/hyperloglog.html\" target=\"_blank\" rel=\"external\">Algebird</a>，采用 Scala 实现。Algebird 有很好的文档，但他们对于 sparse 和 dense HLL 的实现细节不是很容易理解。</li>\n<li><a href=\"https://github.com/addthis/stream-lib\" target=\"_blank\" rel=\"external\">stream-lib</a>中提供的 HyperLogLog++， 采用 Java 实现。stream-lib 中的代码文档齐全，但有些难理解如何合适的使用并且改造的符合我们的需求。</li>\n<li><a href=\"http://antirez.com/news/75\" target=\"_blank\" rel=\"external\">Redis HLL 实现</a>，这是我们最终选择的。我们认为 Redis 中 HLLs 的实现文档齐全、容易配置，提供的相关 API 也很容易集成。还有一个好处是，我们可以用一台专门的服务器部署，从而减轻性能上的压力。</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/16ccb06f98572ee8c2c9862b601b5330.png\" alt=\"\"></p>\n<p>Reddit 的数据管道依赖于 Kafka。当一个用户访问了一篇博客，会触发一个事件，事件会被发送到事件收集服务器，并被持久化在 Kafka 中。</p>\n<p>之后，计数系统会依次顺序运行两个组件。在我们的计数系统架构中，第一部分是一个 Kafka 的消费者，我们称之为 Nazar。Nazar 会从 Kafka 中读取每个事件，并将它通过一系列配置的规则来判断该事件是否需要被计数。我们取这个名字仅仅是因为 Nazar 是一个眼睛形状的护身符，而 ”Nazar“ 系统就像眼睛一样使我们的计数系统远离不怀好意者的破坏。其中一个我们不将一个事件计算在内的原因就是同一个用户在很短时间内重复访问。Nazar 会修改事件，加上个标明是否应该被计数的布尔标识，并将事件重新放入 Kafka。</p>\n<p>下面就到了系统的第二个部分。我们将第二个 Kafka 的消费者称作 Abacus，用来进行真正浏览量的计算，并且将计算结果显示在网站或客户端。Abacus 从 Kafka 中读取经过 Nazar 处理过的事件，并根据 Nazar 的处理结果决定是跳过这个事件还是将其加入计数。如果 Nazar 中的处理结果是可以加入计数，那么 Abacus 首先会检查这个事件所关联的帖子在 Redis 中是否已经存在了一个 HLL 计数器。如果已经存在，Abacus 会给 Redis 发送个 PFADD 的请求。如果不存在，那么 Abacus 会给 Cassandra 集群发送个请求（Cassandra 用来持久化 HLL 计数器和 计数值的），然后向 Redis 发送 <a href=\"https://redis.io/commands/set\" target=\"_blank\" rel=\"external\">SET</a> 请求。这通常会发生在网友访问较老帖子的时候，这时该帖子的计数器很可能已经在 Redis 中过期了。</p>\n<p>为了存储存在 Redis 中的计数器过期的老帖子的浏览量。Abacus 会周期性的将 Redis 中全部的 HLL 和 每篇帖子的浏览量写入到 Cassandra 集群中。为了避免集群过载，我们以 10 秒为周期批量写入。</p>\n<p>下图是事件流的大致流程：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/d09187e95644ef43035e135057ea6dcc.jpg\" alt=\"\"></p>\n<h2 id=\"总结\">总结</h2>\n<p>我们希望浏览量可以让发帖者了解帖子全部的访问量，也帮助版主快速定位自己社区中高访问量的帖子。在未来，我们计划利用我们数据管道在实时方面的潜力来为 Reddit 的用户提供更多的有用的反馈。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111393\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111393votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111393\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/be3c037cbb3c7c32899af846d32a664913c16963.jpg"}
{"url_object_id": "e975392587f1caa2451dc67f1c110a3e", "url": "http://blog.jobbole.com/111385/", "title": "Linux 下 logrotate 日志轮询操作梳理", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "create_date": "2017-06-07", "praise_nums": 1, "fav_nums": 2, "comment_nums": 0, "tags": "IT技术,Linux,logrotate,日志", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kevingrace/p/6307298.html\">散尽浮华</a>   </div><p>对于 Linux 系统安全来说，日志文件是极其重要的工具。不知为何，我发现很多运维同学的服务器上都运行着一些诸如每天切分 Nginx日志之类的 CRON 脚本，大家似乎遗忘了 Logrotate，争相发明自己的轮子，这真是让人沮丧啊！就好比明明身边躺着现成的性感美女，大家却忙着自娱自乐，罪过！</p>\n<p>logrotate 程序是一个日志文件管理工具。用于分割日志文件，删除旧的日志文件，并创建新的日志文件，起到“转储”作用。可以节省磁盘空间。下面就对 logrotate 日志轮转操作做一梳理记录。</p>\n<div id=\"cnblogs_post_body\">\n<p><strong>1）配置文件介绍</strong></p>\n<p>Linux系统默认安装logrotate工具，它默认的配置文件在：</p>\n<blockquote><p>/etc/logrotate.conf<br>\n/etc/logrotate.d/</p></blockquote>\n<p>logrotate.conf 才主要的配置文件，logrotate.d 是一个目录，该目录里的所有文件都会被主动的读入/etc/logrotate.conf中执行。</p>\n<p>另外，如果 /etc/logrotate.d/ 里面的文件中没有设定一些细节，则会以/etc/logrotate.conf这个文件的设定来作为默认值。</p>\n<p>Logrotate是基于CRON来运行的，其脚本是/etc/cron.daily/logrotate，日志轮转是系统自动完成的。实际运行时，Logrotate会调用配置文件/etc/logrotate.conf。可以在/etc/logrotate.d目录里放置自定义好的配置文件，用来覆盖Logrotate的缺省值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f02350722681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# cat /etc/cron.daily/logrotate \r\n#!/bin/sh\r\n\r\n/usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1\r\nEXITVALUE=$?\r\nif [ $EXITVALUE != 0 ]; then\r\n    /usr/bin/logger -t logrotate \"ALERT exited abnormally with [$EXITVALUE]\"\r\nfi\r\nexit 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f02350722681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f02350722681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f02350722681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f02350722681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f02350722681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f02350722681-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f02350722681-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f02350722681-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f02350722681-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f02350722681-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/cron.daily/logrotate </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f02350722681-2\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f02350722681-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f02350722681-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f02350722681-5\"><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f02350722681-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f02350722681-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ALERT exited abnormally with [$EXITVALUE]\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f02350722681-8\"><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f02350722681-9\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>\n</p></div>\n<p>如果等不及cron自动执行日志轮转，想手动强制切割日志，需要加-f参数；不过正式执行前最好通过Debug选项来验证一下（-d参数），这对调试也很重要：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f0c271372433\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/sbin/logrotate -f /etc/logrotate.d/nginx\r\n# /usr/sbin/logrotate -d -f /etc/logrotate.d/nginx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f0c271372433-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f0c271372433-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f0c271372433-1\"><span class=\"crayon-p\"># /usr/sbin/logrotate -f /etc/logrotate.d/nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f0c271372433-2\"><span class=\"crayon-p\"># /usr/sbin/logrotate -d -f /etc/logrotate.d/nginx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><strong>logrotate 命令格式：</strong></p>\n<blockquote><p>logrotate [OPTION…] &lt;configfile&gt;</p>\n<p>-d, –debug ：debug模式，测试配置文件是否有错误。<br>\n-f, –force ：强制转储文件。<br>\n-m, –mail=command ：压缩日志后，发送日志到指定邮箱。<br>\n-s, –state=statefile ：使用指定的状态文件。<br>\n-v, –verbose ：显示转储过程。</p></blockquote>\n<p>根据日志切割设置进行操作，并显示详细信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f10435317213\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# /usr/sbin/logrotate -v /etc/logrotate.conf\r\n[root@huanqiu_web1 ~]# /usr/sbin/logrotate -v /etc/logrotate.d/php</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f10435317213-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f10435317213-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f10435317213-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># /usr/sbin/logrotate -v /etc/logrotate.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f10435317213-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># /usr/sbin/logrotate -v /etc/logrotate.d/php</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>根据日志切割设置进行执行，并显示详细信息,但是不进行具体操作，debug模式</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f14120093157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# /usr/sbin/logrotate -d /etc/logrotate.conf\r\n[root@huanqiu_web1 ~]# /usr/sbin/logrotate -d /etc/logrotate.d/nginx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f14120093157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f14120093157-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f14120093157-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># /usr/sbin/logrotate -d /etc/logrotate.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f14120093157-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># /usr/sbin/logrotate -d /etc/logrotate.d/nginx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>查看各log文件的具体执行情况</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f17881337528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@fangfull_web1 ~]# cat /var/lib/logrotate.status</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f17881337528-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f17881337528-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">fangfull_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /var/lib/logrotate.status</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><strong>2）切割介绍</strong></p>\n<p>比如以系统日志/var/log/message做切割来简单说明下：</p>\n<ul>\n<li>第一次执行完rotate(轮转)之后，原本的messages会变成messages.1，而且会制造一个空的messages给系统来储存日志；</li>\n<li>第二次执行之后，messages.1会变成messages.2，而messages会变成messages.1，又造成一个空的messages来储存日志！</li>\n</ul>\n<p>如果仅设定保留三个日志（即轮转3次）的话，那么执行第三次时，则 messages.3这个档案就会被删除，并由后面的较新的保存日志所取代！也就是会保存最新的几个日志。</p>\n<p>日志究竟轮换几次，这个是根据配置文件中的dateext 参数来判定的。</p>\n<p>看下logrotate.conf配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f1b131721359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# cat /etc/logrotate.conf\r\n# 底下的设定是 \"logrotate 的默认值\" ，如果別的文件设定了其他的值，\r\n# 就会以其它文件的设定为主\r\nweekly          //默认每一周执行一次rotate轮转工作\r\nrotate 4       //保留多少个日志文件(轮转几次).默认保留四个.就是指定日志文件删除之前轮转的次数，0 指没有备份\r\ncreate         //自动创建新的日志文件，新的日志文件具有和原来的文件相同的权限；因为日志被改名,因此要创建一个新的来继续存储之前的日志\r\ndateext       //这个参数很重要！就是切割后的日志文件以当前日期为格式结尾，如xxx.log-20131216这样,如果注释掉,切割出来是按数字递增,即前面说的 xxx.log-1这种格式\r\ncompress      //是否通过gzip压缩转储以后的日志文件，如xxx.log-20131216.gz ；如果不需要压缩，注释掉就行\r\n\r\ninclude /etc/logrotate.d\r\n# 将 /etc/logrotate.d/ 目录中的所有文件都加载进来\r\n\r\n/var/log/wtmp {                 //仅针对 /var/log/wtmp 所设定的参数\r\nmonthly                    //每月一次切割,取代默认的一周\r\nminsize 1M              //文件大小超过 1M 后才会切割\r\ncreate 0664 root utmp            //指定新建的日志文件权限以及所属用户和组\r\nrotate 1                    //只保留一个日志.\r\n}\r\n# 这个 wtmp 可记录用户登录系统及系统重启的时间\r\n# 因为有 minsize 的参数，因此不见得每个月一定会执行一次喔.要看文件大小。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1b131721359-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1b131721359-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-1\"><span class=\"crayon-p\"># cat /etc/logrotate.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-2\"><span class=\"crayon-p\"># 底下的设定是 \"logrotate 的默认值\" ，如果別的文件设定了其他的值，</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-3\"><span class=\"crayon-p\"># 就会以其它文件的设定为主</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-4\"><span class=\"crayon-i\">weekly</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">//默认每一周执行一次rotate轮转工作</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-5\"><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//保留多少个日志文件(轮转几次).默认保留四个.就是指定日志文件删除之前轮转的次数，0 指没有备份</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-6\"><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//自动创建新的日志文件，新的日志文件具有和原来的文件相同的权限；因为日志被改名,因此要创建一个新的来继续存储之前的日志</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-7\"><span class=\"crayon-i\">dateext</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//这个参数很重要！就是切割后的日志文件以当前日期为格式结尾，如xxx.log-20131216这样,如果注释掉,切割出来是按数字递增,即前面说的 xxx.log-1这种格式</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-8\"><span class=\"crayon-i\">compress</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">//是否通过gzip压缩转储以后的日志文件，如xxx.log-20131216.gz ；如果不需要压缩，注释掉就行</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-10\"><span class=\"crayon-v\">include</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-11\"><span class=\"crayon-p\"># 将 /etc/logrotate.d/ 目录中的所有文件都加载进来</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-12\"> </div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-13\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">wtmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//仅针对 /var/log/wtmp 所设定的参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-14\"><span class=\"crayon-i\">monthly</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>  <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//每月一次切割,取代默认的一周</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-15\"><span class=\"crayon-i\">minsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1M</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">//文件大小超过 1M 后才会切割</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-16\"><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0664</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">utmp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>  <span class=\"crayon-h\"> </span><span class=\"crayon-c\">//指定新建的日志文件权限以及所属用户和组</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-17\"><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">//只保留一个日志.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-18\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1b131721359-19\"><span class=\"crayon-p\"># 这个 wtmp 可记录用户登录系统及系统重启的时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1b131721359-20\"><span class=\"crayon-p\"># 因为有 minsize 的参数，因此不见得每个月一定会执行一次喔.要看文件大小。</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>由这个文件的设定可以知道/etc/logrotate.d其实就是由/etc/logrotate.conf 所规划出来的目录，虽然可以将所有的配置都写入 /etc/logrotate.conf ，但是这样一来这个文件就实在是太复杂了，尤其是当使用很多的服务在系统上面时， 每个服务都要去修改 /etc/logrotate.conf 的设定也似乎不太合理了。</p>\n<p>所以，如果独立出来一个目录，那么每个要切割日志的服务， 就可以独自成为一个文件，并且放置到 /etc/logrotate.d/ 当中。</p>\n<p>其他重要参数说明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f1f284709899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncompress                                   通过gzip 压缩转储以后的日志\r\nnocompress                                不做gzip压缩处理\r\ncopytruncate                              用于还在打开中的日志文件，把当前日志备份并截断；是先拷贝再清空的方式，拷贝和清空之间有一个时间差，可能会丢失部分日志数据。\r\nnocopytruncate                           备份日志文件不过不截断\r\ncreate mode owner group             轮转时指定创建新文件的属性，如create 0777 nobody nobody\r\nnocreate                                    不建立新的日志文件\r\ndelaycompress                           和compress 一起使用时，转储的日志文件到下一次转储时才压缩\r\nnodelaycompress                        覆盖 delaycompress 选项，转储同时压缩。\r\nmissingok                                 如果日志丢失，不报错继续滚动下一个日志\r\nerrors address                           专储时的错误信息发送到指定的Email 地址\r\nifempty                                    即使日志文件为空文件也做轮转，这个是logrotate的缺省选项。\r\nnotifempty                               当日志文件为空时，不进行轮转\r\nmail address                             把转储的日志文件发送到指定的E-mail 地址\r\nnomail                                     转储时不发送日志文件\r\nolddir directory                         转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统\r\nnoolddir                                   转储后的日志文件和当前日志文件放在同一个目录下\r\nsharedscripts                           运行postrotate脚本，作用是在所有日志都轮转后统一执行一次脚本。如果没有配置这个，那么每个日志轮转后都会执行一次脚本\r\nprerotate                                 在logrotate转储之前需要执行的指令，例如修改文件的属性等动作；必须独立成行\r\npostrotate                               在logrotate转储之后需要执行的指令，例如重新启动 (kill -HUP) 某个服务！必须独立成行\r\ndaily                                       指定转储周期为每天\r\nweekly                                    指定转储周期为每周\r\nmonthly                                  指定转储周期为每月\r\nrotate count                            指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份\r\ndateext                                  使用当期日期作为命名格式\r\ndateformat .%s                       配合dateext使用，紧跟在下一行出现，定义文件切割后的文件名，必须配合dateext使用，只支持 %Y %m %d %s 这四个参数\r\nsize(或minsize) log-size            当日志文件到达指定的大小时才转储，log-size能指定bytes(缺省)及KB (sizek)或MB(sizem).\r\n\r\n当日志文件 &gt;= log-size 的时候就转储。 以下为合法格式：（其他格式的单位大小写没有试过）\r\nsize = 5 或 size 5 （&gt;= 5 个字节就转储）\r\nsize = 100k 或 size 100k\r\nsize = 100M 或 size 100M</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f1f284709899-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f1f284709899-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-1\"><span class=\"crayon-i\">compress</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>通过<span class=\"crayon-i\">gzip</span><span class=\"crayon-h\"> </span>压缩转储以后的日志</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-2\"><span class=\"crayon-i\">nocompress</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 不做<span class=\"crayon-i\">gzip</span>压缩处理</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-3\"><span class=\"crayon-i\">copytruncate</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 用于还在打开中的日志文件，把当前日志备份并截断；是先拷贝再清空的方式，拷贝和清空之间有一个时间差，可能会丢失部分日志数据。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-4\"><span class=\"crayon-i\">nocopytruncate</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>备份日志文件不过不截断</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-5\"><span class=\"crayon-e\">create </span><span class=\"crayon-e\">mode </span><span class=\"crayon-e\">owner </span><span class=\"crayon-i\">group</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>轮转时指定创建新文件的属性，如<span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0777</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nobody </span><span class=\"crayon-e\">nobody</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-6\"><span class=\"crayon-i\">nocreate</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 不建立新的日志文件</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-7\"><span class=\"crayon-i\">delaycompress</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>和<span class=\"crayon-i\">compress</span><span class=\"crayon-h\"> </span>一起使用时，转储的日志文件到下一次转储时才压缩</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-8\"><span class=\"crayon-i\">nodelaycompress</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 覆盖<span class=\"crayon-h\"> </span><span class=\"crayon-i\">delaycompress</span><span class=\"crayon-h\"> </span>选项，转储同时压缩。</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-9\"><span class=\"crayon-i\">missingok</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>如果日志丢失，不报错继续滚动下一个日志</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-10\"><span class=\"crayon-e\">errors </span><span class=\"crayon-i\">address</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>专储时的错误信息发送到指定的<span class=\"crayon-i\">Email</span><span class=\"crayon-h\"> </span>地址</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-11\"><span class=\"crayon-i\">ifempty</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 即使日志文件为空文件也做轮转，这个是<span class=\"crayon-i\">logrotate</span>的缺省选项。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-12\"><span class=\"crayon-i\">notifempty</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>当日志文件为空时，不进行轮转</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-13\"><span class=\"crayon-e\">mail </span><span class=\"crayon-i\">address</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>把转储的日志文件发送到指定的<span class=\"crayon-v\">E</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">mail</span><span class=\"crayon-h\"> </span>地址</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-14\"><span class=\"crayon-i\">nomail</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>转储时不发送日志文件</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-15\"><span class=\"crayon-e\">olddir </span><span class=\"crayon-i\">directory</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-16\"><span class=\"crayon-i\">noolddir</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>转储后的日志文件和当前日志文件放在同一个目录下</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-17\"><span class=\"crayon-i\">sharedscripts</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>运行<span class=\"crayon-i\">postrotate</span>脚本，作用是在所有日志都轮转后统一执行一次脚本。如果没有配置这个，那么每个日志轮转后都会执行一次脚本</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-18\"><span class=\"crayon-i\">prerotate</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>在<span class=\"crayon-i\">logrotate</span>转储之前需要执行的指令，例如修改文件的属性等动作；必须独立成行</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-19\"><span class=\"crayon-i\">postrotate</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>在<span class=\"crayon-i\">logrotate</span>转储之后需要执行的指令，例如重新启动<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">HUP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span>某个服务！必须独立成行</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-20\"><span class=\"crayon-i\">daily</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>指定转储周期为每天</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-21\"><span class=\"crayon-i\">weekly</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 指定转储周期为每周</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-22\"><span class=\"crayon-i\">monthly</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 指定转储周期为每月</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-23\"><span class=\"crayon-e\">rotate </span><span class=\"crayon-i\">count</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 指定日志文件删除之前转储的次数，<span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span>指没有备份，<span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span>指保留<span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span>个备份</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-24\"><span class=\"crayon-i\">dateext</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> 使用当期日期作为命名格式</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-25\"><span class=\"crayon-i\">dateformat</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>配合<span class=\"crayon-i\">dateext</span>使用，紧跟在下一行出现，定义文件切割后的文件名，必须配合<span class=\"crayon-i\">dateext</span>使用，只支持<span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">Y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span>这四个参数</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-26\"><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span>或<span class=\"crayon-v\">minsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">size</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span>当日志文件到达指定的大小时才转储，<span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">size</span>能指定<span class=\"crayon-e\">bytes</span><span class=\"crayon-sy\">(</span>缺省<span class=\"crayon-sy\">)</span>及<span class=\"crayon-e\">KB</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sizek</span><span class=\"crayon-sy\">)</span>或<span class=\"crayon-e\">MB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sizem</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-28\">当日志文件<span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span>的时候就转储。<span class=\"crayon-h\"> </span>以下为合法格式：（其他格式的单位大小写没有试过）</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-29\"><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span>或<span class=\"crayon-h\"> </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span>（<span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span>个字节就转储）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f1f284709899-30\"><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100k</span><span class=\"crayon-h\"> </span>或<span class=\"crayon-h\"> </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100k</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f1f284709899-31\"><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100M</span><span class=\"crayon-h\"> </span>或<span class=\"crayon-h\"> </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100M</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0171 seconds] -->\r\n<p>小示例：下面一个切割nginx日志的配置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f25328233942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@master-server ~]# vim /etc/logrotate.d/nginx \r\n/usr/local/nginx/logs/*.log {\r\ndaily\r\nrotate 7 \r\nmissingok\r\nnotifempty\r\ndateext\r\nsharedscripts\r\npostrotate\r\n    if [ -f /usr/local/nginx/logs/nginx.pid ]; then\r\n        kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`\r\n    fi\r\nendscript\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f25328233942-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f25328233942-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># vim /etc/logrotate.d/nginx </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-3\"><span class=\"crayon-e\">daily</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-4\"><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-5\"><span class=\"crayon-e\">missingok</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-6\"><span class=\"crayon-e\">notifempty</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-7\"><span class=\"crayon-e\">dateext</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-8\"><span class=\"crayon-e\">sharedscripts</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-9\"><span class=\"crayon-e\">postrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">USR1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pid</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f25328233942-13\"><span class=\"crayon-i\">endscript</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f25328233942-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>——————–分享一例曾经使用过的nginx日志切割处理脚本———————–<br>\n<strong>1）logrotate日志分割配置：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f29381878927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@bastion-IDC ~# vim /etc/logrotate.d/nginx\r\n/data/nginx_logs/*.access_log         \r\n{\r\nnocompress                                    \r\ndaily                                   \r\ncopytruncate                                   \r\ncreate                               \r\nifempty                                    \r\nolddir /data/nginx_logs/days            \r\nrotate 0                                         \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f29381878927-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f29381878927-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f29381878927-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f29381878927-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f29381878927-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f29381878927-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">IDC</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-p\"># vim /etc/logrotate.d/nginx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f29381878927-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx_logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">access</span><span class=\"crayon-sy\">_</span>log<span class=\"crayon-h\">         </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f29381878927-4\"><span class=\"crayon-e\">nocompress                                    </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-5\"><span class=\"crayon-e\">daily                                   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f29381878927-6\"><span class=\"crayon-e\">copytruncate                                   </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-7\"><span class=\"crayon-e\">create                               </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f29381878927-8\"><span class=\"crayon-e\">ifempty                                    </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-9\"><span class=\"crayon-v\">olddir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx_logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">days            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f29381878927-10\"><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                                         </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f29381878927-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><strong>2）日志分割脚本</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f2c978827370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@bastion-IDC ~# vim /usr/local/sbin/logrotate-nginx.sh\r\n#!/bin/bash\r\n#创建转储日志压缩存放目录\r\nmkdir -p /data/nginx_logs/days\r\n#手工对nginx日志进行切割转换\r\n/usr/sbin/logrotate -vf /etc/logrotate.d/nginx\r\n#当前时间\r\ntime=$(date -d \"yesterday\" +\"%Y-%m-%d\")\r\n#进入转储日志存放目录\r\ncd /data/nginx_logs/days\r\n#对目录中的转储日志文件的文件名进行统一转换\r\nfor i in $(ls ./ | grep \"^<span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_4fd4a56c435d5c26b3c3c366f51b074e.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\".*\"></span><script type=\"math/tex\">.*</script>\\.[[:digit:]]$\")\r\ndo\r\nmv ${i} ./$(echo ${i}|sed -n 's/^<span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_4fd4a56c435d5c26b3c3c366f51b074e.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\".*\"></span><script type=\"math/tex\">.*</script>\\.<span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_2dc76049c48dc883029c9094bec37345.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\"[[:digit:]]\"></span><script type=\"math/tex\">[[:digit:]]</script>$/\\1/p')-$(echo $time)\r\ndone\r\n#对转储的日志文件进行压缩存放，并删除原有转储的日志文件，只保存压缩后的日志文件。以节约存储空间\r\nfor i in $(ls ./ | grep \"^<span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_4fd4a56c435d5c26b3c3c366f51b074e.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\".*\"></span><script type=\"math/tex\">.*</script>\\-<span class=\"MathJax_Preview\"><img src=\"http://blog.jobbole.com/wp-content/plugins/latex/cache/tex_9dff6f37fad40b9f06f4b7157720ca6e.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\"[[:digit:]-]\\+\"></span><script type=\"math/tex\">[[:digit:]-]\\+</script>$\")\r\ndo\r\ntar jcvf ${i}.bz2 ./${i}\r\nrm -rf ./${i}\r\ndone\r\n#只保留最近7天的压缩转储日志文件\r\nfind /data/nginx_logs/days/* -name \"*.bz2\" -mtime 7 -type f -exec rm -rf {} \\;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f2c978827370-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f2c978827370-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">IDC</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-p\"># vim /usr/local/sbin/logrotate-nginx.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-2\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-3\"><span class=\"crayon-p\">#创建转储日志压缩存放目录</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-4\"><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx_logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">days</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-5\"><span class=\"crayon-p\">#手工对nginx日志进行切割转换</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-6\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">vf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-7\"><span class=\"crayon-p\">#当前时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-8\"><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yesterday\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"%Y-%m-%d\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-9\"><span class=\"crayon-p\">#进入转储日志存放目录</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-10\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx_logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">days</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-11\"><span class=\"crayon-p\">#对目录中的转储日志文件的文件名进行统一转换</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-12\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"^<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span>\\.[[:digit:]]$\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-13\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-14\"><span class=\"crayon-e\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/^<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span>\\.<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">digit</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span>$/\\1/p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-15\"><span class=\"crayon-v\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-16\"><span class=\"crayon-p\">#对转储的日志文件进行压缩存放，并删除原有转储的日志文件，只保存压缩后的日志文件。以节约存储空间</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-17\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"^<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span>\\-<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">digit</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span>$\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-18\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-19\"><span class=\"crayon-e\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jcvf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bz2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-20\"><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-21\"><span class=\"crayon-v\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f2c978827370-22\"><span class=\"crayon-p\">#只保留最近7天的压缩转储日志文件</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f2c978827370-23\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx_logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">days</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*.bz2\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">exec</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p><strong>3）crontab定时执行</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f31334731180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@bastion-IDC ~# crontab -e\r\n#logrotate\r\n0 0 * * * /bin/bash -x /usr/local/sbin/logrotate-nginx.sh &gt; /dev/null 2&gt;&amp;1 </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f31334731180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f31334731180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f31334731180-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f31334731180-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">IDC</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-p\"># crontab -e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f31334731180-2\"><span class=\"crayon-p\">#logrotate</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f31334731180-3\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>手动执行脚本，测试下看看：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f34848826071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@bastion-IDC ~# /bin/bash -x /usr/local/sbin/logrotate-nginx.sh\r\n[root@bastion-IDC ~# cd /data/nginx_logs/days \r\n[root@bastion-IDC days# ls\r\nhuantest.access_log-2017-01-18.bz2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f34848826071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f34848826071-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f34848826071-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f34848826071-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f34848826071-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">IDC</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-p\"># /bin/bash -x /usr/local/sbin/logrotate-nginx.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f34848826071-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">IDC</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-p\"># cd /data/nginx_logs/days </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f34848826071-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bastion</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">IDC </span><span class=\"crayon-v\">days</span><span class=\"crayon-p\"># ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f34848826071-4\"><span class=\"crayon-v\">huantest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">access_log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">18.bz2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>———————————-php脚本切割一例———————————-</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f37657555601\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# cat /etc/logrotate.d/php \r\n/Data/logs/php/*log {\r\n    daily\r\n    rotate 365\r\n    missingok\r\n    notifempty\r\n    compress\r\n    dateext\r\n    sharedscripts\r\n    postrotate\r\n        if [ -f /Data/app/php5.6.26/var/run/php-fpm.pid ]; then\r\n            kill -USR1 `cat /Data/app/php5.6.26/var/run/php-fpm.pid`\r\n        fi\r\n    endscript\r\n    postrotate\r\n        /bin/chmod 644 /Data/logs/php/*gz\r\n    endscript\r\n}\r\n\r\n[root@huanqiu_web1 ~]# ll /Data/app/php5.6.26/var/run/php-fpm.pid \r\n-rw-r--r-- 1 root root 4 Dec 28 17:03 /Data/app/php5.6.26/var/run/php-fpm.pid\r\n\r\n[root@huanqiu_web1 ~]# cd /Data/logs/php\r\n[root@huanqiu_web1 php]# ll\r\ntotal 25676\r\n-rw-r--r-- 1 root   root         0 Jun  1  2016 error.log\r\n-rw-r--r-- 1 nobody nobody     182 Aug 30  2015 error.log-20150830.gz\r\n-rw-r--r-- 1 nobody nobody     371 Sep  1  2015 error.log-20150901.gz\r\n-rw-r--r-- 1 nobody nobody     315 Sep  7  2015 error.log-20150907.gz\r\n.........\r\n.........</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f37657555601-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f37657555601-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/logrotate.d/php </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">php</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">daily</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">365</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">missingok</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">notifempty</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">compress</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">dateext</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">sharedscripts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">postrotate</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-11\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6.26</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fpm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">USR1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6.26</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fpm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pid</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-14\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">endscript</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">postrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">644</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">gz</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-17\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">endscript</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-18\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-20\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /Data/app/php5.6.26/var/run/php-fpm.pid </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-21\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6.26</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fpm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-22\"> </div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-23\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cd /Data/logs/php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-24\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">huanqiu_web1 </span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-25\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25676</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-26\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root   </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-27\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nobody </span><span class=\"crayon-i\">nobody</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">182</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2015</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20150830.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-28\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nobody </span><span class=\"crayon-i\">nobody</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">371</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2015</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20150901.gz</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-29\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nobody </span><span class=\"crayon-i\">nobody</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">315</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2015</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20150907.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f37657555601-30\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f37657555601-31\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>———————————-nginx日志切割一例———————————–</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f3c263757087\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# cat /etc/logrotate.d/nginx \r\n/Data/logs/nginx/*/*log {\r\n    daily\r\n    rotate 365\r\n    missingok\r\n    notifempty\r\n    compress\r\n    dateext\r\n    sharedscripts\r\n    postrotate\r\n    /etc/init.d/nginx reload\r\n    endscript\r\n}\r\n\r\n[root@huanqiu_web1 ~]# ll /Data/logs/nginx/www.huanqiu.com/\r\n..........\r\n-rw-r--r-- 1 root root      1652 Jan  1 00:00 error.log-20170101.gz\r\n-rw-r--r-- 1 root root      1289 Jan  2 00:00 error.log-20170102.gz\r\n-rw-r--r-- 1 root root      1633 Jan  3 00:00 error.log-20170103.gz\r\n-rw-r--r-- 1 root root      3239 Jan  4 00:00 error.log-20170104.gz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f3c263757087-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f3c263757087-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/logrotate.d/nginx </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">daily</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">365</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">missingok</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">notifempty</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">compress</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">dateext</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">sharedscripts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">postrotate</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginx </span><span class=\"crayon-e\">reload</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">endscript</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-14\"> </div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-15\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /Data/logs/nginx/www.huanqiu.com/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-16\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-17\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">1652</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170101.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-18\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">1289</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170102.gz</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f3c263757087-19\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">1633</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170103.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f3c263757087-20\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">3239</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170104.gz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>———————————-系统日志切割一例———————————–</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f40152634828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_web1 ~]# cat /etc/logrotate.d/syslog \r\n/var/log/cron\r\n/var/log/maillog\r\n/var/log/messages\r\n/var/log/secure\r\n/var/log/spooler\r\n{\r\n    sharedscripts\r\n    postrotate\r\n    /bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true\r\n    endscript\r\n}\r\n\r\n[root@huanqiu_web1 ~]# ll /var/log/messages*\r\n-rw------- 1 root root 34248975 Jan 19 18:42 /var/log/messages\r\n-rw------- 1 root root 51772994 Dec 25 03:11 /var/log/messages-20161225\r\n-rw------- 1 root root 51800210 Jan  1 03:05 /var/log/messages-20170101\r\n-rw------- 1 root root 51981366 Jan  8 03:36 /var/log/messages-20170108\r\n-rw------- 1 root root 51843025 Jan 15 03:40 /var/log/messages-20170115\r\n[root@huanqiu_web1 ~]# ll /var/log/cron*\r\n-rw------- 1 root root 2155681 Jan 19 18:43 /var/log/cron\r\n-rw------- 1 root root 2932618 Dec 25 03:11 /var/log/cron-20161225\r\n-rw------- 1 root root 2939305 Jan  1 03:06 /var/log/cron-20170101\r\n-rw------- 1 root root 2951820 Jan  8 03:37 /var/log/cron-20170108\r\n-rw------- 1 root root 3203992 Jan 15 03:41 /var/log/cron-20170115\r\n[root@huanqiu_web1 ~]# ll /var/log/secure*\r\n-rw------- 1 root root  275343 Jan 19 18:36 /var/log/secure\r\n-rw------- 1 root root 2111936 Dec 25 03:06 /var/log/secure-20161225\r\n-rw------- 1 root root 2772744 Jan  1 02:57 /var/log/secure-20170101\r\n-rw------- 1 root root 1115543 Jan  8 03:26 /var/log/secure-20170108\r\n-rw------- 1 root root  731599 Jan 15 03:40 /var/log/secure-20170115\r\n[root@huanqiu_web1 ~]# ll /var/log/spooler*\r\n-rw------- 1 root root 0 Jan 15 03:41 /var/log/spooler\r\n-rw------- 1 root root 0 Dec 18 03:21 /var/log/spooler-20161225\r\n-rw------- 1 root root 0 Dec 25 03:11 /var/log/spooler-20170101\r\n-rw------- 1 root root 0 Jan  1 03:06 /var/log/spooler-20170108\r\n-rw------- 1 root root 0 Jan  8 03:37 /var/log/spooler-20170115</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f40152634828-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f40152634828-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/logrotate.d/syslog </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">cron</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">maillog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">messages</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">secure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-6\"><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">spooler</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sharedscripts</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">postrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">HUP</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">syslogd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">endscript</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-14\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /var/log/messages*</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-15\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34248975</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-16\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51772994</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20161225</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-17\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51800210</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">05</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170101</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-18\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51981366</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170108</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-19\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51843025</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170115</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-20\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /var/log/cron*</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-21\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2155681</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cron</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-22\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2932618</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cron</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20161225</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-23\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2939305</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cron</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170101</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-24\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2951820</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cron</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170108</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-25\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3203992</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cron</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170115</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-26\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /var/log/secure*</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-27\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">275343</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">secure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-28\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2111936</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">secure</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20161225</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-29\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2772744</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">57</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">secure</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170101</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-30\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1115543</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">secure</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170108</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-31\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">731599</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">secure</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170115</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-32\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_web1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /var/log/spooler*</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-33\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spooler</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-34\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spooler</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20161225</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-35\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spooler</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170101</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f40152634828-36\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spooler</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170108</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f40152634828-37\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">spooler</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20170115</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0139 seconds] -->\r\n<p>———————————-tomcat日志切割一例———————————–</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f44754648845\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu-backup ~]# cat /etc/logrotate.d/tomcat \r\n/Data/app/tomcat-7-huanqiu/logs/catalina.out { \r\nrotate 14 \r\ndaily \r\ncopytruncate \r\ncompress \r\nnotifempty \r\nmissingok \r\n} \r\n\r\n[root@huanqiu-backup ~]# ll /Data/app/tomcat-7-huanqiu/logs/catalina.*\r\n-rw-r--r--. 1 root root     0 Jan 19 19:11 /Data/app/tomcat-7-huanqiu/logs/catalina.out\r\n-rw-r--r--. 1 root root 95668 Jan 19 19:11 /Data/app/tomcat-7-huanqiu/logs/catalina.out.1.gz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f44754648845-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f44754648845-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/logrotate.d/tomcat </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tomcat</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">huanqiu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-3\"><span class=\"crayon-i\">rotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-4\"><span class=\"crayon-e\">daily </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-5\"><span class=\"crayon-e\">copytruncate </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-6\"><span class=\"crayon-e\">compress </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-7\"><span class=\"crayon-e\">notifempty </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-8\"><span class=\"crayon-i\">missingok</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-9\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-10\"> </div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-11\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ll /Data/app/tomcat-7-huanqiu/logs/catalina.*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f44754648845-12\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tomcat</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">huanqiu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f44754648845-13\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95668</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tomcat</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">huanqiu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1.gz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>———————————早期用过的nginx日志处理一例———————————-</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f48223220468\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@letv-backup ~]# vim /letv/sh/cut_nginx_log.sh\r\n#!/bin/bash\r\n# 你的日志文件存放目录\r\nlogs_path=\"/letv/logs/\"\r\n# 日志文件的名字，多个需要空格隔开\r\nlogs_names=(error access pv_access)\r\ndates=`date -d \"yesterday\" +\"%Y%m%d\"`\r\nmkdir -p ${logs_path}$dates/\r\nnum=${#logs_names[@]}\r\nfor((i=0;i&lt;num;i++));do\r\nmv ${logs_path}${logs_names[i]}.log ${logs_path}$dates/${logs_names[i]}.log\r\ndone\r\n#nginx平滑重启\r\nkill -USR1 `cat /letv/logs/nginx/nginx.pid`           \r\n \r\n结合crontab定时执行\r\n[root@letv-backup ~]# crontab -e\r\n#nginx日志切割\r\n00 00 * * * cd /letv/logs;/bin/bash /letv/sh/cut_nginx_log.sh &gt; /dev/null 2&gt;$1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f48223220468-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f48223220468-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">letv</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># vim /letv/sh/cut_nginx_log.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-2\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-3\"><span class=\"crayon-p\"># 你的日志文件存放目录</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-4\"><span class=\"crayon-v\">logs_path</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/letv/logs/\"</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-5\"><span class=\"crayon-p\"># 日志文件的名字，多个需要空格隔开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-6\"><span class=\"crayon-v\">logs_names</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">error </span><span class=\"crayon-e\">access </span><span class=\"crayon-v\">pv_access</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-7\"><span class=\"crayon-v\">dates</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"yesterday\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"%Y%m%d\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-8\"><span class=\"crayon-e\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">logs_path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dates</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-9\"><span class=\"crayon-v\">num</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-p\">#logs_names[@]}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-10\"><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-11\"><span class=\"crayon-e\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">logs_path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">logs_names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">logs_path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">dates</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">logs_names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-12\"><span class=\"crayon-v\">done</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-13\"><span class=\"crayon-p\">#nginx平滑重启</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-14\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">USR1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">letv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pid</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\">           </span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-16\">结合<span class=\"crayon-i\">crontab</span>定时执行</div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-17\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">letv</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># crontab -e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f48223220468-18\"><span class=\"crayon-p\">#nginx日志切割</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f48223220468-19\"><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">letv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logs</span><span class=\"crayon-sy\">;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">letv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cut_nginx_log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p><strong>3）尝试解决logrotate无法自动轮询日志的办法</strong></p>\n<p>现象说明：</p>\n<p>使用logrotate轮询nginx日志，配置好之后，发现nginx日志连续两天没被切割，这是为什么呢？？</p>\n<p>然后开始检查日志切割的配置文件是否有问题，检查后确定配置文件一切正常。</p>\n<p>于是怀疑是logrotate预定的cron没执行，查看了cron的日志，发现有一条Dec 7 04:02:01 www crond[18959]: (root) CMD (run-parts /etc/cron.daily)这样的日志，证明cron在04:02分时已经执行/etc/cron.daily目录下的程序。</p>\n<p>接着查看/etc /cron.daily/logrotate（这是logrotate自动轮转的脚本）的内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f4c377197988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_test ~]# cat /etc/cron.daily/logrotate\r\n#!/bin/sh\r\n \r\n/usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1\r\nEXITVALUE=$?\r\nif [ $EXITVALUE != 0 ]; then\r\n    /usr/bin/logger -t logrotate \"ALERT exited abnormally with [$EXITVALUE]\"\r\nfi\r\nexit 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f4c377197988-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f4c377197988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f4c377197988-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f4c377197988-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f4c377197988-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f4c377197988-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f4c377197988-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f4c377197988-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f4c377197988-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f4c377197988-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/cron.daily/logrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f4c377197988-2\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f4c377197988-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f4c377197988-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f4c377197988-5\"><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f4c377197988-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f4c377197988-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ALERT exited abnormally with [$EXITVALUE]\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f4c377197988-8\"><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f4c377197988-9\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>没有发现异常，配置好的日志轮转操作都是由这个脚本完成的，一切运行正常，脚本应该就没问题。</p>\n<p>直接执行命令：</p>\n<blockquote><p>[root@huanqiu_test ~]# /usr/sbin/logrotate /etc/logrotate.conf</p></blockquote>\n<p>这些系统日志是正常轮询了，但nginx日志却还是没轮询。</p>\n<p>接着强行启动记录文件维护操作，纵使logrotate指令认为没有需要，应该有可能是logroate认为nginx日志太小，不进行轮询。</p>\n<p>故需要强制轮询，即在/etc/cron.daily/logrotate脚本中将 -t 参数替换成 -f 参数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f51788413376\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_test ~]# cat /etc/cron.daily/logrotate\r\n#!/bin/sh\r\n \r\n/usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1\r\nEXITVALUE=$?\r\nif [ $EXITVALUE != 0 ]; then\r\n    /usr/bin/logger -f logrotate \"ALERT exited abnormally with [$EXITVALUE]\"\r\nfi\r\nexit 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f51788413376-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f51788413376-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f51788413376-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f51788413376-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f51788413376-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f51788413376-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f51788413376-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f51788413376-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f51788413376-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f51788413376-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># cat /etc/cron.daily/logrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f51788413376-2\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f51788413376-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f51788413376-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f51788413376-5\"><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f51788413376-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">EXITVALUE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f51788413376-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ALERT exited abnormally with [$EXITVALUE]\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f51788413376-8\"><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f51788413376-9\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>最后最后重启下cron服务：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-594f0763a3f54222377729\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@huanqiu_test ~]# /etc/init.d/crond restart\r\nStopping crond: [ OK ]\r\nStarting crond: [ OK ]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f54222377729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-594f0763a3f54222377729-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-594f0763a3f54222377729-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-594f0763a3f54222377729-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">huanqiu_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># /etc/init.d/crond restart</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-594f0763a3f54222377729-2\"><span class=\"crayon-e\">Stopping </span><span class=\"crayon-v\">crond</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">OK</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-594f0763a3f54222377729-3\"><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">crond</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">OK</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"}
